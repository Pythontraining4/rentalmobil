{"version":3,"file":"form.min.js","sources":["../../../apps/frappe/frappe/public/js/frappe/views/formview.js","../../../apps/frappe/frappe/public/js/legacy/form.js","../../../apps/frappe/frappe/public/js/legacy/client_script_helpers.js","../../../apps/frappe/frappe/public/js/frappe/form/toolbar.js","../../../apps/frappe/frappe/public/js/frappe/form/dashboard.js","../../../apps/frappe/frappe/public/js/frappe/form/document_flow.js","../../../apps/frappe/frappe/public/js/frappe/form/save.js","../../../apps/frappe/frappe/public/js/frappe/form/script_manager.js","../../../apps/frappe/frappe/public/js/frappe/form/linked_with.js","../../../apps/frappe/frappe/public/js/frappe/form/workflow.js","../../../apps/frappe/frappe/public/js/frappe/form/print.js","../../../apps/frappe/frappe/public/js/frappe/form/form_sidebar.js","../../../apps/frappe/frappe/public/js/frappe/form/user_image.js","../../../apps/frappe/frappe/public/js/frappe/form/share.js","../../../apps/frappe/frappe/public/js/frappe/form/form_viewers.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/footer.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/attachments.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/timeline.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/assign_to.js","../../../apps/frappe/frappe/public/js/frappe/form/quick_entry.js","../../../apps/frappe/frappe/public/js/frappe/form/success_action.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.views.formview');\n\nfrappe.views.FormFactory = class FormFactory extends frappe.views.Factory {\n\tmake(route) {\n\t\tvar me = this,\n\t\t\tdt = route[1];\n\n\t\tif(!frappe.views.formview[dt]) {\n\t\t\tfrappe.model.with_doctype(dt, function() {\n\t\t\t\tme.page = frappe.container.add_page(\"Form/\" + dt);\n\t\t\t\tfrappe.views.formview[dt] = me.page;\n\t\t\t\tme.page.frm = new _f.Frm(dt, me.page, true);\n\t\t\t\tme.show_doc(route);\n\t\t\t});\n\t\t} else {\n\t\t\tme.show_doc(route);\n\t\t}\n\n\n\t\tif(!this.initialized) {\n\t\t\t$(document).on(\"page-change\", function() {\n\t\t\t\tfrappe.ui.form.close_grid_form();\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"new_communication\", function(data) {\n\t\t\t\tfrappe.timeline.new_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"delete_communication\", function(data) {\n\t\t\t\tfrappe.timeline.delete_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on('update_communication', function(data) {\n\t\t\t\tfrappe.timeline.update_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"doc_viewers\", function(data) {\n\t\t\t\tfrappe.ui.form.set_viewers(data);\n\t\t\t});\n\t\t}\n\n\n\t\tthis.initialized = true;\n\t}\n\n\tshow_doc(route) {\n\t\tvar dt = route[1],\n\t\t\tdn = route.slice(2).join(\"/\"),\n\t\t\tme = this;\n\n\t\tif(frappe.model.new_names[dn]) {\n\t\t\tdn = frappe.model.new_names[dn];\n\t\t\tfrappe.set_route(\"Form\", dt, dn);\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.model.with_doc(dt, dn, function(dn, r) {\n\t\t\tif(r && r['403']) return; // not permitted\n\n\t\t\tif(!(locals[dt] && locals[dt][dn])) {\n\t\t\t\t// doc not found, but starts with New,\n\t\t\t\t// make a new doc and set it\n\t\t\t\tvar new_str = __(\"New\") + \" \";\n\t\t\t\tif(dn && dn.substr(0, new_str.length)==new_str) {\n\t\t\t\t\tvar new_name = frappe.model.make_new_doc_and_get_name(dt, true);\n\t\t\t\t\tif(new_name===dn) {\n\t\t\t\t\t\tme.load(dt, dn);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.set_route(\"Form\", dt, new_name)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.show_not_found(route);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tme.load(dt, dn);\n\t\t});\n\t}\n\n\tload(dt, dn) {\n\t\tfrappe.container.change_to(\"Form/\" + dt);\n\t\tfrappe.views.formview[dt].frm.refresh(dn);\n\t}\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\n/* Form page structure\n\n\t+ this.parent (either FormContainer or Dialog)\n\t\t+ this.wrapper\n\t\t\t+ this.toolbar\n\t\t\t+ this.form_wrapper\n\t\t\t\t\t+ this.head\n\t\t\t\t\t+ this.body\n\t\t\t\t\t\t+ this.layout\n\t\t\t\t+ this.sidebar\n\t\t\t+ this.footer\n*/\n\n/* eslint-disable no-console */\n\nfrappe.provide('_f');\nfrappe.provide('frappe.ui.form');\n\nfrappe.ui.form.Controller = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t}\n});\n\n_f.frms = {};\n\n_f.Frm = function(doctype, parent, in_form) {\n\tthis.docname = '';\n\tthis.doctype = doctype;\n\tthis.hidden = false;\n\tthis.refresh_if_stale_for = 120;\n\n\tvar me = this;\n\tthis.opendocs = {};\n\tthis.custom_buttons = {};\n\tthis.sections = [];\n\tthis.grids = [];\n\tthis.cscript = new frappe.ui.form.Controller({frm:this});\n\tthis.events = {};\n\tthis.pformat = {};\n\tthis.fetch_dict = {};\n\tthis.parent = parent;\n\tthis.tinymce_id_list = [];\n\n\tthis.setup_meta(doctype);\n\n\t// show in form instead of in dialog, when called using url (router.js)\n\tthis.in_form = in_form ? true : false;\n\n\t// notify on rename\n\t$(document).on('rename', function(event, dt, old_name, new_name) {\n\t\tif(dt==me.doctype)\n\t\t\tme.rename_notify(dt, old_name, new_name);\n\t});\n};\n\n_f.Frm.prototype.check_doctype_conflict = function(docname) {\n\tif(this.doctype=='DocType' && docname=='DocType') {\n\t\tfrappe.msgprint(__('Allowing DocType, DocType. Be careful!'));\n\t} else if(this.doctype=='DocType') {\n\t\tif (frappe.views.formview[docname] || frappe.pages['List/'+docname]) {\n\t\t\twindow.location.reload();\n\t\t\t//\tfrappe.msgprint(__(\"Cannot open {0} when its instance is open\", ['DocType']))\n\t\t\t// throw 'doctype open conflict'\n\t\t}\n\t} else {\n\t\tif (frappe.views.formview.DocType && frappe.views.formview.DocType.frm.opendocs[this.doctype]) {\n\t\t\twindow.location.reload();\n\t\t\t//\tfrappe.msgprint(__(\"Cannot open instance when its {0} is open\", ['DocType']))\n\t\t\t// throw 'doctype open conflict'\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.setup = function() {\n\tthis.fields = [];\n\tthis.fields_dict = {};\n\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.doctype);\n\n\t// wrapper\n\tthis.wrapper = this.parent;\n\tthis.$wrapper = $(this.wrapper);\n\tfrappe.ui.make_app_page({\n\t\tparent: this.wrapper,\n\t\tsingle_column: this.meta.hide_toolbar\n\t});\n\tthis.page = this.wrapper.page;\n\tthis.layout_main = this.page.main.get(0);\n\n\tthis.toolbar = new frappe.ui.form.Toolbar({\n\t\tfrm: this,\n\t\tpage: this.page\n\t});\n\n\t// print layout\n\tthis.setup_print_layout();\n\n\t// 2 column layout\n\tthis.setup_std_layout();\n\n\t// client script must be called after \"setup\" - there are no fields_dict attached to the frm otherwise\n\tthis.script_manager = new frappe.ui.form.ScriptManager({\n\t\tfrm: this\n\t});\n\tthis.script_manager.setup();\n\tthis.watch_model_updates();\n\n\tif(!this.meta.hide_toolbar) {\n\t\tthis.footer = new frappe.ui.form.Footer({\n\t\t\tfrm: this,\n\t\t\tparent: $('<div>').appendTo(this.page.main.parent())\n\t\t});\n\t\t$(\"body\").attr(\"data-sidebar\", 1);\n\t}\n\tthis.setup_drag_drop();\n\n\tthis.setup_done = true;\n};\n\n_f.Frm.prototype.setup_drag_drop = function() {\n\tvar me = this;\n\tthis.$wrapper.on('dragenter dragover', false)\n\t\t.on('drop', function(e) {\n\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\n\t\t\tif (!(dataTransfer && dataTransfer.files && dataTransfer.files.length > 0)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif(me.doc.__islocal) {\n\t\t\t\tfrappe.msgprint(__(\"Please save before attaching.\"));\n\t\t\t\tthrow \"attach error\";\n\t\t\t}\n\n\t\t\tif(me.attachments.max_reached()) {\n\t\t\t\tfrappe.msgprint(__(\"Maximum Attachment Limit for this record reached.\"));\n\t\t\t\tthrow \"attach error\";\n\t\t\t}\n\n\t\t\tfrappe.upload.make({\n\t\t\t\targs: me.attachments.get_args(),\n\t\t\t\tfiles: dataTransfer.files,\n\t\t\t\tcallback: function(attachment, r) {\n\t\t\t\t\tme.attachments.attachment_uploaded(attachment, r);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n};\n\n_f.Frm.prototype.setup_print_layout = function() {\n\tvar me = this;\n\tthis.print_preview = new frappe.ui.form.PrintPreview({\n\t\tfrm: this\n\t});\n\n\t// show edit button for print view\n\tthis.page.wrapper.on('view-change', function() {\n\t\tme.toolbar.set_primary_action();\n\t});\n};\n\n_f.Frm.prototype.print_doc = function() {\n\tif(this.print_preview.wrapper.is(\":visible\")) {\n\t\tthis.hide_print();\n\t\treturn;\n\t}\n\tif(!frappe.model.can_print(this.doc.doctype, this)) {\n\t\tfrappe.msgprint(__(\"You are not allowed to print this document\"));\n\t\treturn;\n\t}\n\n\tthis.print_preview.refresh_print_options().trigger(\"change\");\n\tthis.page.set_view(\"print\");\n\tthis.print_preview.set_user_lang();\n\tthis.print_preview.set_default_print_language();\n\tthis.print_preview.preview();\n};\n\n_f.Frm.prototype.hide_print = function() {\n\tif(this.setup_done && this.page.current_view_name===\"print\") {\n\t\tthis.page.set_view(this.page.previous_view_name===\"print\" ?\n\t\t\t\"main\" : (this.page.previous_view_name || \"main\"));\n\t}\n};\n\n_f.Frm.prototype.watch_model_updates = function() {\n\t// watch model updates\n\tvar me = this;\n\n\t// on main doc\n\tfrappe.model.on(me.doctype, \"*\", function(fieldname, value, doc) {\n\t\t// set input\n\t\tif(doc.name===me.docname) {\n\t\t\tif ((value==='' || value===null) && !doc[fieldname]) {\n\t\t\t\t// both the incoming and outgoing values are falsy\n\t\t\t\t// the texteditor, summernote, changes nulls to empty strings on render,\n\t\t\t\t// so ignore those changes\n\t\t\t} else {\n\t\t\t\tme.dirty();\n\t\t\t}\n\t\t\tme.fields_dict[fieldname]\n\t\t\t\t&& me.fields_dict[fieldname].refresh(fieldname);\n\n\t\t\tme.layout.refresh_dependency();\n\t\t\tlet object = me.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\treturn object;\n\t\t}\n\t});\n\n\t// on table fields\n\tvar table_fields = frappe.get_children(\"DocType\", me.doctype, \"fields\", {fieldtype:\"Table\"});\n\n\t// using $.each to preserve df via closure\n\t$.each(table_fields, function(i, df) {\n\t\tfrappe.model.on(df.options, \"*\", function(fieldname, value, doc) {\n\t\t\tif(doc.parent===me.docname && doc.parentfield===df.fieldname) {\n\t\t\t\tme.dirty();\n\t\t\t\tme.fields_dict[df.fieldname].grid.set_value(fieldname, value, doc);\n\t\t\t\tme.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\t}\n\t\t});\n\t});\n};\n\n_f.Frm.prototype.setup_std_layout = function() {\n\tthis.form_wrapper \t= $('<div></div>').appendTo(this.layout_main);\n\tthis.body \t\t\t= $('<div></div>').appendTo(this.form_wrapper);\n\n\t// only tray\n\tthis.meta.section_style='Simple'; // always simple!\n\n\t// layout\n\tthis.layout = new frappe.ui.form.Layout({\n\t\tparent: this.body,\n\t\tdoctype: this.doctype,\n\t\tfrm: this,\n\t\twith_dashboard: true\n\t});\n\tthis.layout.make();\n\n\tthis.fields_dict = this.layout.fields_dict;\n\tthis.fields = this.layout.fields_list;\n\n\tthis.document_flow = new frappe.ui.form.DocumentFlow({\n\t\tfrm: this\n\t});\n\n\tthis.dashboard = new frappe.ui.form.Dashboard({\n\t\tfrm: this,\n\t});\n\n\t// state\n\tthis.states = new frappe.ui.form.States({\n\t\tfrm: this\n\t});\n};\n\n// email the form\n_f.Frm.prototype.email_doc = function(message) {\n\tnew frappe.views.CommunicationComposer({\n\t\tdoc: this.doc,\n\t\tfrm: this,\n\t\tsubject: __(this.meta.name) + ': ' + this.docname,\n\t\trecipients: this.doc.email || this.doc.email_id || this.doc.contact_email,\n\t\tattach_document_print: true,\n\t\tmessage: message,\n\t\treal_name: this.doc.real_name || this.doc.contact_display || this.doc.contact_name\n\t});\n};\n\n// rename the form\n_f.Frm.prototype.rename_doc = function() {\n\tfrappe.model.rename_doc(this.doctype, this.docname);\n};\n\n_f.Frm.prototype.share_doc = function() {\n\tthis.shared.show();\n};\n\n// notify this form of renamed records\n_f.Frm.prototype.rename_notify = function(dt, old, name) {\n\t// from form\n\tif(this.meta.istable)\n\t\treturn;\n\n\tif(this.docname == old)\n\t\tthis.docname = name;\n\telse\n\t\treturn;\n\n\t// cleanup\n\tif(this && this.opendocs[old] && frappe.meta.docfield_copy[dt]) {\n\t\t// delete docfield copy\n\t\tfrappe.meta.docfield_copy[dt][name] = frappe.meta.docfield_copy[dt][old];\n\t\tdelete frappe.meta.docfield_copy[dt][old];\n\t}\n\n\tdelete this.opendocs[old];\n\tthis.opendocs[name] = true;\n\n\tif(this.meta.in_dialog || !this.in_form) {\n\t\treturn;\n\t}\n\n\tfrappe.re_route[window.location.hash] = '#Form/' + encodeURIComponent(this.doctype) + '/' + encodeURIComponent(name);\n\tfrappe.set_route('Form', this.doctype, name);\n};\n\n// SETUP\n\n_f.Frm.prototype.setup_meta = function() {\n\tthis.meta = frappe.get_doc('DocType', this.doctype);\n\tthis.perm = frappe.perm.get_perm(this.doctype); // for create\n\tif(this.meta.istable) {\n\t\tthis.meta.in_dialog = 1;\n\t}\n};\n\n_f.Frm.prototype.refresh_header = function(is_a_different_doc) {\n\t// set title\n\t// main title\n\tif(!this.meta.in_dialog || this.in_form) {\n\t\tfrappe.utils.set_title(this.meta.issingle ? this.doctype : this.docname);\n\t}\n\n\t// show / hide buttons\n\tif(this.toolbar) {\n\t\tif (is_a_different_doc) {\n\t\t\tthis.toolbar.current_status = undefined;\n\t\t}\n\n\t\tthis.toolbar.refresh();\n\t}\n\n\tthis.document_flow.refresh();\n\tthis.dashboard.refresh();\n\n\tif(this.meta.is_submittable &&\n\t\tthis.perm[0] && this.perm[0].submit &&\n\t\t!this.is_dirty() &&\n\t\t!this.is_new() &&\n\t\tthis.doc.docstatus===0) {\n\t\tthis.dashboard.add_comment(__('Submit this document to confirm'), 'orange', true);\n\t}\n\n\tthis.clear_custom_buttons();\n\n\tthis.show_web_link();\n};\n\n_f.Frm.prototype.show_web_link = function() {\n\tvar doc = this.doc, me = this;\n\tif(!doc.__islocal && doc.__onload && doc.__onload.is_website_generator) {\n\t\tme.web_link && me.web_link.remove();\n\t\tif(doc.__onload.published) {\n\t\t\tme.add_web_link(\"/\" + doc.route);\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.add_web_link = function(path, label) {\n\tlabel = label || \"See on Website\";\n\tthis.web_link = this.sidebar.add_user_action(__(label),\n\t\tfunction() {}).attr(\"href\", path || this.doc.route).attr(\"target\", \"_blank\");\n};\n\n_f.Frm.prototype.check_doc_perm = function() {\n\t// get perm\n\tvar dt = this.parent_doctype?this.parent_doctype : this.doctype;\n\tthis.perm = frappe.perm.get_perm(dt, this.doc);\n\n\tif(!this.perm[0].read) {\n\t\treturn 0;\n\t}\n\treturn 1;\n};\n\n_f.Frm.prototype.refresh = function(docname) {\n\tvar is_a_different_doc = docname ? true : false;\n\n\tif(docname) {\n\t\t// record switch\n\t\tif(this.docname != docname && (!this.meta.in_dialog || this.in_form) && !this.meta.istable) {\n\t\t\tfrappe.utils.scroll_to(0);\n\t\t\tthis.hide_print();\n\t\t}\n\t\t// reset visible columns, since column headings can change in different docs\n\t\tthis.grids.forEach(grid_obj => grid_obj.grid.visible_columns = null);\n\t\tfrappe.ui.form.close_grid_form();\n\t\tthis.docname = docname;\n\t}\n\n\tcur_frm = this;\n\n\tif(this.docname) { // document to show\n\n\t\t// set the doc\n\t\tthis.doc = frappe.get_doc(this.doctype, this.docname);\n\n\t\t// check permissions\n\t\tif(!this.check_doc_perm()) {\n\t\t\tfrappe.show_not_permitted(__(this.doctype) + \" \" + __(this.docname));\n\t\t\treturn;\n\t\t}\n\n\t\t// read only (workflow)\n\t\tthis.read_only = frappe.workflow.is_read_only(this.doctype, this.docname);\n\t\tif (this.read_only) this.set_read_only(true);\n\n\t\t// check if doctype is already open\n\t\tif (!this.opendocs[this.docname]) {\n\t\t\tthis.check_doctype_conflict(this.docname);\n\t\t} else {\n\t\t\tif(this.doc && (!this.doc.__unsaved) && this.doc.__last_sync_on &&\n\t\t\t\t(new Date() - this.doc.__last_sync_on) > (this.refresh_if_stale_for * 1000)) {\n\t\t\t\tthis.reload_doc();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// do setup\n\t\tif(!this.setup_done) {\n\t\t\tthis.setup();\n\t\t}\n\n\t\t// load the record for the first time, if not loaded (call 'onload')\n\t\tthis.cscript.is_onload = false;\n\t\tif(!this.opendocs[this.docname]) {\n\t\t\tvar me = this;\n\t\t\tthis.cscript.is_onload = true;\n\t\t\tthis.setnewdoc();\n\t\t\t$(document).trigger(\"form-load\", [this]);\n\t\t\t$(this.page.wrapper).on('hide',  function() {\n\t\t\t\t$(document).trigger(\"form-unload\", [me]);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.render_form(is_a_different_doc);\n\t\t\tif (this.doc.localname) {\n\t\t\t\t// trigger form-rename and remove .localname\n\t\t\t\tdelete this.doc.localname;\n\t\t\t\t$(document).trigger(\"form-rename\", [this]);\n\t\t\t}\n\t\t}\n\n\t\t// if print format is shown, refresh the format\n\t\tif(this.print_preview.wrapper.is(\":visible\")) {\n\t\t\tthis.print_preview.preview();\n\t\t}\n\n\t\tif(is_a_different_doc) {\n\t\t\tif(this.show_print_first && this.doc.docstatus===1) {\n\t\t\t\t// show print view\n\t\t\t\tthis.print_doc();\n\t\t\t}\n\t\t}\n\n\t\t// set status classes\n\t\tthis.$wrapper.removeClass('validated-form')\n\t\t\t.toggleClass('editable-form', this.doc.docstatus===0)\n\t\t\t.toggleClass('submitted-form', this.doc.docstatus===1)\n\t\t\t.toggleClass('cancelled-form', this.doc.docstatus===2);\n\n\t\tthis.show_if_needs_refresh();\n\t}\n};\n\n_f.Frm.prototype.show_if_needs_refresh = function() {\n\tif(this.doc.__needs_refresh) {\n\t\tif(this.doc.__unsaved) {\n\t\t\tthis.dashboard.clear_headline();\n\t\t\tthis.dashboard.set_headline_alert(__(\"This form has been modified after you have loaded it\")\n\t\t\t\t+ '<a class=\"btn btn-xs btn-primary pull-right\" onclick=\"cur_frm.reload_doc()\">'\n\t\t\t\t+ __(\"Refresh\") + '</a>', \"alert-warning\");\n\t\t} else {\n\t\t\tthis.reload_doc();\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.render_form = function(is_a_different_doc) {\n\tif(!this.meta.istable) {\n\t\tthis.layout.doc = this.doc;\n\t\tthis.layout.attach_doc_and_docfields();\n\n\t\tthis.sidebar = new frappe.ui.form.Sidebar({\n\t\t\tfrm: this,\n\t\t\tpage: this.page\n\t\t});\n\t\tthis.sidebar.make();\n\n\t\t// clear layout message\n\t\tthis.layout.show_message();\n\n\t\tfrappe.run_serially([\n\t\t\t// header must be refreshed before client methods\n\t\t\t// because add_custom_button\n\t\t\t() => this.refresh_header(is_a_different_doc),\n\t\t\t// trigger global trigger\n\t\t\t// to use this\n\t\t\t() => $(document).trigger('form-refresh', [this]),\n\t\t\t// fields\n\t\t\t() => this.refresh_fields(),\n\t\t\t// call trigger\n\t\t\t() => this.script_manager.trigger(\"refresh\"),\n\t\t\t// call onload post render for callbacks to be fired\n\t\t\t() => {\n\t\t\t\tif(this.cscript.is_onload) {\n\t\t\t\t\treturn this.script_manager.trigger(\"onload_post_render\");\n\t\t\t\t}\n\t\t\t},\n\t\t\t() => this.dashboard.after_refresh()\n\t\t]);\n\t\t// focus on first input\n\n\t\tif(this.is_new()) {\n\t\t\tvar first = this.form_wrapper.find('.form-layout input:first');\n\t\t\tif(!in_list([\"Date\", \"Datetime\"], first.attr(\"data-fieldtype\"))) {\n\t\t\t\tfirst.focus();\n\t\t\t}\n\t\t}\n\t} else {\n\t\tthis.refresh_header(is_a_different_doc);\n\t}\n\n\tthis.$wrapper.trigger('render_complete');\n\n\tif(!this.hidden) {\n\t\tthis.layout.show_empty_form_message();\n\t}\n\n\tthis.scroll_to_element();\n};\n\n_f.Frm.prototype.refresh_field = function(fname) {\n\tif(this.fields_dict[fname] && this.fields_dict[fname].refresh) {\n\t\tthis.fields_dict[fname].refresh();\n\t\tthis.layout.refresh_dependency();\n\t}\n};\n\n_f.Frm.prototype.refresh_fields = function() {\n\tthis.layout.refresh(this.doc);\n\tthis.layout.primary_button = this.$wrapper.find(\".btn-primary\");\n\n\t// cleanup activities after refresh\n\tthis.cleanup_refresh(this);\n};\n\n\n_f.Frm.prototype.cleanup_refresh = function() {\n\tvar me = this;\n\tif(me.fields_dict['amended_from']) {\n\t\tif (me.doc.amended_from) {\n\t\t\tunhide_field('amended_from');\n\t\t\tif (me.fields_dict['amendment_date']) unhide_field('amendment_date');\n\t\t} else {\n\t\t\thide_field('amended_from');\n\t\t\tif (me.fields_dict['amendment_date']) hide_field('amendment_date');\n\t\t}\n\t}\n\n\tif(me.fields_dict['trash_reason']) {\n\t\tif(me.doc.trash_reason && me.doc.docstatus == 2) {\n\t\t\tunhide_field('trash_reason');\n\t\t} else {\n\t\t\thide_field('trash_reason');\n\t\t}\n\t}\n\n\tif(me.meta.autoname && me.meta.autoname.substr(0,6)=='field:' && !me.doc.__islocal) {\n\t\tvar fn = me.meta.autoname.substr(6);\n\n\t\tif (me.doc[fn]) {\n\t\t\tme.toggle_display(fn, false);\n\t\t}\n\t}\n\n\tif(me.meta.autoname==\"naming_series:\" && !me.doc.__islocal) {\n\t\tme.toggle_display(\"naming_series\", false);\n\t}\n};\n\n_f.Frm.prototype.setnewdoc = function() {\n\t// moved this call to refresh function\n\t// this.check_doctype_conflict(docname);\n\tvar me = this;\n\n\t// hide any open grid\n\tthis.script_manager.trigger(\"before_load\", this.doctype, this.docname)\n\t\t.then(() => {\n\t\t\tme.script_manager.trigger(\"onload\");\n\t\t\tme.opendocs[me.docname] = true;\n\t\t\tme.render_form();\n\n\t\t\tfrappe.after_ajax(function() {\n\t\t\t\tme.trigger_link_fields();\n\t\t\t});\n\n\t\t\tfrappe.breadcrumbs.add(me.meta.module, me.doctype);\n\t\t});\n\n\t// update seen\n\tif(this.meta.track_seen) {\n\t\t$('.list-id[data-name=\"'+ me.docname +'\"]').addClass('seen');\n\t}\n};\n\n_f.Frm.prototype.trigger_link_fields = function() {\n\t// trigger link fields which have default values set\n\tif (this.is_new() && this.doc.__run_link_triggers) {\n\t\t$.each(this.fields_dict, function(fieldname, field) {\n\t\t\tif (field.df.fieldtype==\"Link\" && this.doc[fieldname]) {\n\t\t\t\t// triggers add fetch, sets value in model and runs triggers\n\t\t\t\tfield.set_value(this.doc[fieldname]);\n\t\t\t}\n\t\t});\n\n\t\tdelete this.doc.__run_link_triggers;\n\t}\n};\n\n_f.Frm.prototype.runscript = function(scriptname, callingfield, onrefresh) {\n\tvar me = this;\n\tif(this.docname) {\n\t\t// send to run\n\t\tif(callingfield)\n\t\t\t$(callingfield.input).set_working();\n\n\t\tfrappe.call({\n\t\t\tmethod: \"runserverobj\",\n\t\t\targs: {'docs':this.doc, 'method':scriptname },\n\t\t\tbtn: callingfield.$input,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tif(onrefresh) {\n\t\t\t\t\t\tonrefresh(r);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.refresh_fields();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\n_f.Frm.prototype.copy_doc = function(onload, from_amend) {\n\tthis.validate_form_action(\"Create\");\n\tvar newdoc = frappe.model.copy_doc(this.doc, from_amend);\n\n\tnewdoc.idx = null;\n\tnewdoc.__run_link_triggers = false;\n\tif(onload) {\n\t\tonload(newdoc);\n\t}\n\tfrappe.set_route('Form', newdoc.doctype, newdoc.name);\n};\n\n_f.Frm.prototype.reload_doc = function() {\n\tthis.check_doctype_conflict(this.docname);\n\n\tvar me = this;\n\n\tif(!me.doc.__islocal) {\n\t\tfrappe.model.remove_from_locals(me.doctype, me.docname);\n\t\tfrappe.model.with_doc(me.doctype, me.docname, function() {\n\t\t\tme.refresh();\n\t\t});\n\t}\n};\n\nfrappe.validated = 0;\n// Proxy for frappe.validated\nObject.defineProperty(window, 'validated', {\n\tget: function() {\n\t\tconsole.warn('Please use `frappe.validated` instead of `validated`. It will be deprecated soon.');\n\t\treturn frappe.validated;\n\t},\n\tset: function(value) {\n\t\tconsole.warn('Please use `frappe.validated` instead of `validated`. It will be deprecated soon.');\n\t\tfrappe.validated = value;\n\t\treturn frappe.validated;\n\t}\n});\n\n_f.Frm.prototype.save = function(save_action, callback, btn, on_error) {\n\tlet me = this;\n\treturn new Promise((resolve, reject) => {\n\t\tbtn && $(btn).prop(\"disabled\", true);\n\t\t$(document.activeElement).blur();\n\n\t\tfrappe.ui.form.close_grid_form();\n\t\t// let any pending js process finish\n\t\tsetTimeout(function() {\n\t\t\tme._save(save_action, callback, btn, on_error, resolve, reject);\n\t\t}, 100);\n\t}).then(() => {\n\t\tme.show_success_action();\n\t}).catch((e) => {\n\t\tconsole.error(e);\n\t});\n};\n\n_f.Frm.prototype._save = function(save_action, callback, btn, on_error, resolve, reject) {\n\tvar me = this;\n\tif(!save_action) save_action = \"Save\";\n\tthis.validate_form_action(save_action, resolve);\n\n\tif((!this.meta.in_dialog || this.in_form) && !this.meta.istable) {\n\t\tfrappe.utils.scroll_to(0);\n\t}\n\tvar after_save = function(r) {\n\t\tif(!r.exc) {\n\t\t\tif ([\"Save\", \"Update\", \"Amend\"].indexOf(save_action)!==-1) {\n\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t}\n\n\t\t\tme.script_manager.trigger(\"after_save\");\n\t\t\tme.refresh();\n\t\t} else {\n\t\t\tif(on_error) {\n\t\t\t\ton_error();\n\t\t\t\treject();\n\t\t\t}\n\t\t}\n\t\tcallback && callback(r);\n\t\tresolve();\n\t};\n\n\tvar fail = () => {\n\t\tbtn && $(btn).prop(\"disabled\", false);\n\t\tif(on_error) {\n\t\t\ton_error();\n\t\t\treject();\n\t\t}\n\t};\n\n\tif(save_action != \"Update\") {\n\t\t// validate\n\t\tfrappe.validated = true;\n\t\tfrappe.run_serially([\n\t\t\t() => this.script_manager.trigger(\"validate\"),\n\t\t\t() => this.script_manager.trigger(\"before_save\"),\n\t\t\t() => {\n\t\t\t\tif(!frappe.validated) {\n\t\t\t\t\tfail();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t\t\t}\n\t\t]).catch(fail);\n\t} else {\n\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t}\n};\n\n\n_f.Frm.prototype.savesubmit = function(btn, callback, on_error) {\n\tvar me = this;\n\n\tlet handle_fail = () => {\n\t\t$(btn).prop('disabled', false);\n\t\tif (on_error) {\n\t\t\ton_error();\n\t\t}\n\t};\n\n\treturn new Promise(resolve => {\n\t\tthis.validate_form_action(\"Submit\");\n\t\tfrappe.confirm(__(\"Permanently Submit {0}?\", [this.docname]), function() {\n\t\t\tfrappe.validated = true;\n\t\t\tme.script_manager.trigger(\"before_submit\").then(function() {\n\t\t\t\tif(!frappe.validated) {\n\t\t\t\t\thandle_fail();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tme.save('Submit', function(r) {\n\t\t\t\t\tif(r.exc) {\n\t\t\t\t\t\thandle_fail();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\tcallback && callback();\n\t\t\t\t\t\tme.script_manager.trigger(\"on_submit\")\n\t\t\t\t\t\t\t.then(() => resolve(me));\n\t\t\t\t\t}\n\t\t\t\t}, btn, () => handle_fail(), resolve);\n\t\t\t});\n\t\t}, () => handle_fail() );\n\t});\n};\n\n_f.Frm.prototype.savecancel = function(btn, callback, on_error) {\n\tvar me = this;\n\n\tlet handle_fail = () => {\n\t\t$(btn).prop('disabled', false);\n\t\tif (on_error) {\n\t\t\ton_error();\n\t\t}\n\t};\n\n\tthis.validate_form_action('Cancel');\n\tfrappe.confirm(__(\"Permanently Cancel {0}?\", [this.docname]), function() {\n\t\tfrappe.validated = true;\n\t\tme.script_manager.trigger(\"before_cancel\").then(function() {\n\t\t\tif(!frappe.validated) {\n\t\t\t\thandle_fail();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar after_cancel = function(r) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\thandle_fail();\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\t\t\tme.refresh();\n\t\t\t\t\tcallback && callback();\n\t\t\t\t\tme.script_manager.trigger(\"after_cancel\");\n\t\t\t\t}\n\t\t\t};\n\t\t\tfrappe.ui.form.save(me, \"cancel\", after_cancel, btn);\n\t\t});\n\t}, () => handle_fail());\n};\n\n// delete the record\n_f.Frm.prototype.savetrash = function() {\n\tthis.validate_form_action(\"Delete\");\n\tfrappe.model.delete_doc(this.doctype, this.docname, function() {\n\t\twindow.history.back();\n\t});\n};\n\n_f.Frm.prototype.amend_doc = function() {\n\tif(!this.fields_dict['amended_from']) {\n\t\talert('\"amended_from\" field must be present to do an amendment.');\n\t\treturn;\n\t}\n\tthis.validate_form_action(\"Amend\");\n\tvar me = this;\n\tvar fn = function(newdoc) {\n\t\tnewdoc.amended_from = me.docname;\n\t\tif(me.fields_dict && me.fields_dict['amendment_date'])\n\t\t\tnewdoc.amendment_date = frappe.datetime.obj_to_str(new Date());\n\t};\n\tthis.copy_doc(fn, 1);\n\tfrappe.utils.play_sound(\"click\");\n};\n\n_f.Frm.prototype.disable_save = function() {\n\t// IMPORTANT: this function should be called in refresh event\n\tthis.save_disabled = true;\n\tthis.toolbar.current_status = null;\n\tthis.page.clear_primary_action();\n};\n\n_f.Frm.prototype.enable_save = function() {\n\tthis.save_disabled = false;\n\tthis.toolbar.set_primary_action();\n};\n\n_f.Frm.prototype.save_or_update = function() {\n\tif(this.save_disabled) return;\n\n\tif(this.doc.docstatus===0) {\n\t\tthis.save();\n\t} else if(this.doc.docstatus===1 && this.doc.__unsaved) {\n\t\tthis.save(\"Update\");\n\t}\n};\n\n_f.Frm.prototype.dirty = function() {\n\tthis.doc.__unsaved = 1;\n\tthis.$wrapper.trigger('dirty');\n};\n\n_f.Frm.prototype.get_docinfo = function() {\n\treturn frappe.model.docinfo[this.doctype][this.docname];\n};\n\n_f.Frm.prototype.is_dirty = function() {\n\treturn this.doc.__unsaved;\n};\n\n_f.Frm.prototype.is_new = function() {\n\treturn this.doc.__islocal;\n};\n\n\n_f.Frm.prototype.reload_docinfo = function(callback) {\n\tvar me = this;\n\tfrappe.call({\n\t\tmethod: \"frappe.desk.form.load.get_docinfo\",\n\t\targs: {\n\t\t\tdoctype: me.doctype,\n\t\t\tname: me.doc.name\n\t\t},\n\t\tcallback: function(r) {\n\t\t\t// docinfo will be synced\n\t\t\tif(callback) callback(r.docinfo);\n\t\t\tme.timeline.refresh();\n\t\t\tme.assign_to.refresh();\n\t\t\tme.attachments.refresh();\n\t\t}\n\t});\n};\n\n\n_f.Frm.prototype.get_perm = function(permlevel, access_type) {\n\treturn this.perm[permlevel] ? this.perm[permlevel][access_type] : null;\n};\n\n\n_f.Frm.prototype.set_intro = function(txt) {\n\tthis.dashboard.set_headline_alert(txt);\n};\n\n_f.Frm.prototype.set_footnote = function(txt) {\n\tthis.footnote_area = frappe.utils.set_footnote(this.footnote_area, this.body, txt);\n};\n\n\n_f.Frm.prototype.add_custom_button = function(label, fn, group) {\n\t// temp! old parameter used to be icon\n\tif(group && group.indexOf(\"fa fa-\")!==-1) group = null;\n\tvar btn = this.page.add_inner_button(label, fn, group);\n\tif(btn) {\n\t\tthis.custom_buttons[label] = btn;\n\t}\n\treturn btn;\n};\n\n//Remove all custom buttons\n_f.Frm.prototype.clear_custom_buttons = function() {\n\tthis.page.clear_inner_toolbar();\n\tthis.page.clear_user_actions();\n\tthis.custom_buttons = {};\n};\n\n//Remove specific custom button by button Label\n_f.Frm.prototype.remove_custom_button = function(label, group) {\n\tthis.page.remove_inner_button(label, group);\n};\n\n_f.Frm.prototype.add_fetch = function(link_field, src_field, tar_field) {\n\tif(!this.fetch_dict[link_field]) {\n\t\tthis.fetch_dict[link_field] = {'columns':[], 'fields':[]};\n\t}\n\tthis.fetch_dict[link_field].columns.push(src_field);\n\tthis.fetch_dict[link_field].fields.push(tar_field);\n};\n\n_f.Frm.prototype.set_print_heading = function(txt) {\n\tthis.pformat[this.docname] = txt;\n};\n\n_f.Frm.prototype.action_perm_type_map = {\n\t\"Create\": \"create\",\n\t\"Save\": \"write\",\n\t\"Submit\": \"submit\",\n\t\"Update\": \"submit\",\n\t\"Cancel\": \"cancel\",\n\t\"Amend\": \"amend\",\n\t\"Delete\": \"delete\"\n};\n\n_f.Frm.prototype.validate_form_action = function(action, resolve) {\n\tvar perm_to_check = this.action_perm_type_map[action];\n\tvar allowed_for_workflow = false;\n\tvar perms = frappe.perm.get_perm(this.doc.doctype)[0];\n\n\t// Allow submit, write, cancel and create permissions for read only documents that are assigned by\n\t// workflows if the user already have those permissions. This is to allow for users to\n\t// continue through the workflow states and to allow execution of functions like Duplicate.\n\tif ((frappe.workflow.is_read_only(this.doctype, this.docname) && (perms[\"write\"] ||\n\t\tperms[\"create\"] || perms[\"submit\"] || perms[\"cancel\"])) || !frappe.workflow.is_read_only(this.doctype, this.docname)) {\n\t\tallowed_for_workflow = true;\n\t}\n\n\tif (!this.perm[0][perm_to_check] && !allowed_for_workflow) {\n\t\tif(resolve) {\n\t\t\t// re-enable buttons\n\t\t\tresolve();\n\t\t}\n\t\tfrappe.throw (__(\"No permission to '{0}' {1}\", [__(action), __(this.doc.doctype)]));\n\t}\n};\n\n_f.Frm.prototype.has_perm = function(ptype) {\n\treturn frappe.perm.has_perm(this.doctype, 0, ptype, this.doc);\n};\n\n_f.Frm.prototype.scroll_to_element = function() {\n\tif (frappe.route_options && frappe.route_options.scroll_to) {\n\t\tvar scroll_to = frappe.route_options.scroll_to;\n\t\tdelete frappe.route_options.scroll_to;\n\n\t\tvar selector = [];\n\t\tfor (var key in scroll_to) {\n\t\t\tvar value = scroll_to[key];\n\t\t\tselector.push(repl('[data-%(key)s=\"%(value)s\"]', {key: key, value: value}));\n\t\t}\n\n\t\tselector = $(selector.join(\" \"));\n\t\tif (selector.length) {\n\t\t\tfrappe.utils.scroll_to(selector);\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.show_success_action = function() {\n\tconst route = frappe.get_route();\n\tif (route[0] !== 'Form') return;\n\tif (this.meta.is_submittable && this.doc.docstatus !== 1) return;\n\n\tconst success_action = new frappe.ui.form.SuccessAction(this);\n\tsuccess_action.show();\n};\n\n_f.Frm.prototype.is_first_creation = function() {\n\tlet { modified, creation } = this.doc;\n\n\t// strip out milliseconds\n\tmodified = modified.split('.')[0];\n\tcreation = creation.split('.')[0];\n\n\treturn modified === creation;\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n/* eslint-disable no-console */\n\nwindow.get_server_fields = function(method, arg, table_field, doc, dt, dn, allow_edit, call_back) {\n\tconsole.warn(\"This function 'get_server_fields' has been deprecated and will be removed soon.\");\n\tfrappe.dom.freeze();\n\tif($.isPlainObject(arg)) arg = JSON.stringify(arg);\n\treturn $c('runserverobj', {'method': method, 'docs': JSON.stringify(doc), 'arg': arg },\n\t\tfunction(r) {\n\t\t\tfrappe.dom.unfreeze();\n\t\t\tif (r.message)  {\n\t\t\t\tvar d = locals[dt][dn];\n\t\t\t\tvar field_dict = r.message;\n\t\t\t\tfor(var key in field_dict) {\n\t\t\t\t\td[key] = field_dict[key];\n\t\t\t\t\tif (table_field)\n\t\t\t\t\t\trefresh_field(key, d.name, table_field);\n\t\t\t\t\telse\n\t\t\t\t\t\trefresh_field(key);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(call_back){\n\t\t\t\tdoc = locals[doc.doctype][doc.name];\n\t\t\t\tcall_back(doc, dt, dn);\n\t\t\t}\n\t\t});\n};\n\n\nwindow.set_multiple = function(dt, dn, dict, table_field) {\n\tvar d = locals[dt][dn];\n\tfor(var key in dict) {\n\t\td[key] = dict[key];\n\t\tif (table_field)\n\t\t\trefresh_field(key, d.name, table_field);\n\t\telse\n\t\t\trefresh_field(key);\n\t}\n};\n\nwindow.refresh_many = function(flist, dn, table_field) {\n\tfor(var i in flist) {\n\t\tif (table_field)\n\t\t\trefresh_field(flist[i], dn, table_field);\n\t\telse\n\t\t\trefresh_field(flist[i]);\n\t}\n};\n\nwindow.set_field_tip = function(n,txt) {\n\tvar df = frappe.meta.get_docfield(cur_frm.doctype, n, cur_frm.docname);\n\tif(df)df.description = txt;\n\n\tif(cur_frm && cur_frm.fields_dict) {\n\t\tif(cur_frm.fields_dict[n])\n\t\t\tcur_frm.fields_dict[n].comment_area.innerHTML = frappe.utils.replace_newlines(txt);\n\t\telse\n\t\t\tconsole.log('[set_field_tip] Unable to set field tip: ' + n);\n\t}\n};\n\nwindow.refresh_field = function(n, docname, table_field) {\n\t// multiple\n\tif(typeof n==typeof [])\n\t\trefresh_many(n, docname, table_field);\n\n\tif (n && typeof n==='string' && table_field){\n\t\tvar grid = cur_frm.fields_dict[table_field].grid,\n\t\t\tfield = frappe.utils.filter_dict(grid.docfields, {fieldname: n});\n\t\tif (field && field.length){\n\t\t\tfield = field[0];\n\t\t\tvar meta = frappe.meta.get_docfield(field.parent, field.fieldname, docname);\n\t\t\t$.extend(field, meta);\n\t\t\tif (docname){\n\t\t\t\tcur_frm.fields_dict[table_field].grid.grid_rows_by_docname[docname].refresh_field(n);\n\t\t\t} else {\n\t\t\t\tcur_frm.fields_dict[table_field].grid.refresh();\n\t\t\t}\n\t\t}\n\t} else if(cur_frm) {\n\t\tcur_frm.refresh_field(n);\n\t}\n};\n\nwindow.set_field_options = function(n, txt) {\n\tcur_frm.set_df_property(n, 'options', txt);\n};\n\nwindow.set_field_permlevel = function(n, level) {\n\tcur_frm.set_df_property(n, 'permlevel', level);\n};\n\nwindow.toggle_field = function(n, hidden) {\n\tvar df = frappe.meta.get_docfield(cur_frm.doctype, n, cur_frm.docname);\n\tif(df) {\n\t\tdf.hidden = hidden;\n\t\trefresh_field(n);\n\t} else {\n\t\tconsole.log((hidden ? \"hide_field\" : \"unhide_field\") + \" cannot find field \" + n);\n\t}\n};\n\nwindow.hide_field = function(n) {\n\tif(cur_frm) {\n\t\tif(n.substr) toggle_field(n, 1);\n\t\telse {\n\t\t\tfor(var i in n) toggle_field(n[i], 1);\n\t\t}\n\t}\n};\n\nwindow.unhide_field = function(n) {\n\tif(cur_frm) {\n\t\tif(n.substr) toggle_field(n, 0);\n\t\telse {\n\t\t\tfor(var i in n) toggle_field(n[i], 0);\n\t\t}\n\t}\n};\n\nwindow.get_field_obj = function(fn) {\n\treturn cur_frm.fields_dict[fn];\n};\n\n_f.Frm.prototype.get_doc = function() {\n\treturn locals[this.doctype][this.docname];\n};\n\n_f.Frm.prototype.set_currency_labels = function(fields_list, currency, parentfield) {\n\t// To set the currency in the label\n\t// For example Total Cost(INR), Total Cost(USD)\n\n\tvar me = this;\n\tvar doctype = parentfield ? this.fields_dict[parentfield].grid.doctype : this.doc.doctype;\n\tvar field_label_map = {};\n\tvar grid_field_label_map = {};\n\n\t$.each(fields_list, function(i, fname) {\n\t\tvar docfield = frappe.meta.docfield_map[doctype][fname];\n\t\tif(docfield) {\n\t\t\tvar label = __(docfield.label || \"\").replace(/\\([^\\)]*\\)/g, \"\"); // eslint-disable-line\n\t\t\tif(parentfield) {\n\t\t\t\tgrid_field_label_map[doctype + \"-\" + fname] =\n\t\t\t\t\tlabel.trim() + \" (\" + __(currency) + \")\";\n\t\t\t} else {\n\t\t\t\tfield_label_map[fname] = label.trim() + \" (\" + currency + \")\";\n\t\t\t}\n\t\t}\n\t});\n\n\t$.each(field_label_map, function(fname, label) {\n\t\tme.fields_dict[fname].set_label(label);\n\t});\n\n\t$.each(grid_field_label_map, function(fname, label) {\n\t\tfname = fname.split(\"-\");\n\t\tvar df = frappe.meta.get_docfield(fname[0], fname[1], me.doc.name);\n\t\tif(df) df.label = label;\n\t});\n};\n\n_f.Frm.prototype.field_map = function(fnames, fn) {\n\tif(typeof fnames==='string') {\n\t\tif(fnames == '*') {\n\t\t\tfnames = Object.keys(this.fields_dict);\n\t\t} else {\n\t\t\tfnames = [fnames];\n\t\t}\n\t}\n\tfor (var i=0, l=fnames.length; i<l; i++) {\n\t\tvar fieldname = fnames[i];\n\t\tvar field = frappe.meta.get_docfield(cur_frm.doctype, fieldname, this.docname);\n\t\tif(field) {\n\t\t\tfn(field);\n\t\t\tthis.refresh_field(fieldname);\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.get_docfield = function(fieldname1, fieldname2) {\n\tif(fieldname2) {\n\t\t// for child\n\t\tvar doctype = this.get_docfield(fieldname1).options;\n\t\treturn frappe.meta.get_docfield(doctype, fieldname2, this.docname);\n\t} else {\n\t\t// for parent\n\t\treturn frappe.meta.get_docfield(this.doctype, fieldname1, this.docname);\n\t}\n};\n\n_f.Frm.prototype.set_df_property = function(fieldname, property, value, docname, table_field) {\n\tvar df;\n\tif (!docname && !table_field){\n\t\tdf = this.get_docfield(fieldname);\n\t} else {\n\t\tvar grid = this.fields_dict[table_field].grid,\n\t\t\tfname = frappe.utils.filter_dict(grid.docfields, {'fieldname': fieldname});\n\t\tif (fname && fname.length)\n\t\t\tdf = frappe.meta.get_docfield(fname[0].parent, fieldname, docname);\n\t}\n\tif(df && df[property] != value) {\n\t\tdf[property] = value;\n\t\trefresh_field(fieldname, table_field);\n\t}\n};\n\n_f.Frm.prototype.toggle_enable = function(fnames, enable) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.read_only = enable ? 0 : 1;\n\t});\n};\n\n_f.Frm.prototype.toggle_reqd = function(fnames, mandatory) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.reqd = mandatory ? true : false;\n\t});\n};\n\n_f.Frm.prototype.toggle_display = function(fnames, show) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.hidden = show ? 0 : 1;\n\t});\n};\n\n_f.Frm.prototype.call_server = function(method, args, callback) {\n\treturn $c_obj(this.doc, method, args, callback);\n};\n\n_f.Frm.prototype.get_files = function() {\n\treturn this.attachments\n\t\t? frappe.utils.sort(this.attachments.get_attachments(), \"file_name\", \"string\")\n\t\t: [] ;\n};\n\n_f.Frm.prototype.set_query = function(fieldname, opt1, opt2) {\n\tif(opt2) {\n\t\t// on child table\n\t\t// set_query(fieldname, parent fieldname, query)\n\t\tthis.fields_dict[opt1].grid.get_field(fieldname).get_query = opt2;\n\t} else {\n\t\t// on parent table\n\t\t// set_query(fieldname, query)\n\t\tif(this.fields_dict[fieldname]) {\n\t\t\tthis.fields_dict[fieldname].get_query = opt1;\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.set_value_if_missing = function(field, value) {\n\treturn this.set_value(field, value, true);\n};\n\n_f.Frm.prototype.clear_table = function(fieldname) {\n\tfrappe.model.clear_table(this.doc, fieldname);\n};\n\n_f.Frm.prototype.add_child = function(fieldname, values) {\n\tvar doc = frappe.model.add_child(this.doc, frappe.meta.get_docfield(this.doctype, fieldname).options, fieldname);\n\tif(values) {\n\t\t// Values of unique keys should not be overridden\n\t\tvar d = {};\n\t\tvar unique_keys = [\"idx\", \"name\"];\n\n\t\tObject.keys(values).map((key) => {\n\t\t\tif(!unique_keys.includes(key)) {\n\t\t\t\td[key] = values[key];\n\t\t\t}\n\t\t});\n\n\t\t$.extend(doc, d);\n\t}\n\treturn doc;\n};\n\n_f.Frm.prototype.set_value = function(field, value, if_missing) {\n\tvar me = this;\n\tvar _set = function(f, v) {\n\t\tvar fieldobj = me.fields_dict[f];\n\t\tif(fieldobj) {\n\t\t\tif(!if_missing || !frappe.model.has_value(me.doctype, me.doc.name, f)) {\n\t\t\t\tif(fieldobj.df.fieldtype===\"Table\" && $.isArray(v)) {\n\n\t\t\t\t\tfrappe.model.clear_table(me.doc, fieldobj.df.fieldname);\n\n\t\t\t\t\tfor (var i=0, j=v.length; i < j; i++) {\n\t\t\t\t\t\tvar d = v[i];\n\t\t\t\t\t\tvar child = frappe.model.add_child(me.doc, fieldobj.df.options,\n\t\t\t\t\t\t\tfieldobj.df.fieldname, i+1);\n\t\t\t\t\t\t$.extend(child, d);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.refresh_field(f);\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t} else {\n\t\t\t\t\treturn frappe.model.set_value(me.doctype, me.doc.name, f, v);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfrappe.msgprint(__(\"Field {0} not found.\",[f]));\n\t\t\tthrow \"frm.set_value\";\n\t\t}\n\t};\n\n\tif(typeof field==\"string\") {\n\t\treturn _set(field, value);\n\t} else if($.isPlainObject(field)) {\n\t\tlet tasks = [];\n\t\tfor (let f in field) {\n\t\t\tlet v = field[f];\n\t\t\tif(me.get_field(f)) {\n\t\t\t\ttasks.push(() => _set(f, v));\n\t\t\t}\n\t\t}\n\t\treturn frappe.run_serially(tasks);\n\t}\n};\n\n_f.Frm.prototype.call = function(opts, args, callback) {\n\tvar me = this;\n\tif(typeof opts==='string') {\n\t\t// called as frm.call('do_this', {with_arg: 'arg'});\n\t\topts = {\n\t\t\tmethod: opts,\n\t\t\tdoc: this.doc,\n\t\t\targs: args,\n\t\t\tcallback: callback\n\t\t};\n\t}\n\tif(!opts.doc) {\n\t\tif(opts.method.indexOf(\".\")===-1)\n\t\t\topts.method = frappe.model.get_server_module_name(me.doctype) + \".\" + opts.method;\n\t\topts.original_callback = opts.callback;\n\t\topts.callback = function(r) {\n\t\t\tif($.isPlainObject(r.message)) {\n\t\t\t\tif(opts.child) {\n\t\t\t\t\t// update child doc\n\t\t\t\t\topts.child = locals[opts.child.doctype][opts.child.name];\n\n\t\t\t\t\tvar std_field_list = [\"doctype\"].concat(frappe.model.std_fields_list);\n\t\t\t\t\tfor (var key in r.message) {\n\t\t\t\t\t\tif (std_field_list.indexOf(key)===-1) {\n\t\t\t\t\t\t\topts.child[key] = r.message[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tme.fields_dict[opts.child.parentfield].refresh();\n\t\t\t\t} else {\n\t\t\t\t\t// update parent doc\n\t\t\t\t\tme.set_value(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t\topts.original_callback && opts.original_callback(r);\n\t\t};\n\t} else {\n\t\topts.original_callback = opts.callback;\n\t\topts.callback = function(r) {\n\t\t\tif(!r.exc) me.refresh_fields();\n\n\t\t\topts.original_callback && opts.original_callback(r);\n\t\t};\n\n\t}\n\treturn frappe.call(opts);\n};\n\n_f.Frm.prototype.get_field = function(field) {\n\treturn this.fields_dict[field];\n};\n\n\n_f.Frm.prototype.set_read_only = function() {\n\tvar perm = [];\n\tvar docperms = frappe.perm.get_perm(this.doc.doctype);\n\tfor (var i=0, l=docperms.length; i<l; i++) {\n\t\tvar p = docperms[i];\n\t\tperm[p.permlevel || 0] = {read:1, print:1, cancel:1};\n\t}\n\tthis.perm = perm;\n};\n\n_f.Frm.prototype.trigger = function(event) {\n\treturn this.script_manager.trigger(event);\n};\n\n_f.Frm.prototype.get_formatted = function(fieldname) {\n\treturn frappe.format(this.doc[fieldname],\n\t\tfrappe.meta.get_docfield(this.doctype, fieldname, this.docname),\n\t\t{no_icon:true}, this.doc);\n};\n\n_f.Frm.prototype.open_grid_row = function() {\n\treturn frappe.ui.form.get_open_grid_form();\n};\n\n_f.Frm.prototype.is_new = function() {\n\treturn this.doc.__islocal;\n};\n\n_f.Frm.prototype.get_title = function() {\n\tif(this.meta.title_field) {\n\t\treturn this.doc[this.meta.title_field];\n\t} else {\n\t\treturn this.doc.name;\n\t}\n};\n\n_f.Frm.prototype.get_selected = function() {\n\t// returns list of children that are selected. returns [parentfield, name] for each\n\tvar selected = {}, me = this;\n\tfrappe.meta.get_table_fields(this.doctype).forEach(function(df) {\n\t\tvar _selected = me.fields_dict[df.fieldname].grid.get_selected();\n\t\tif(_selected.length) {\n\t\t\tselected[df.fieldname] = _selected;\n\t\t}\n\t});\n\treturn selected;\n};\n\n_f.Frm.prototype.has_mapper = function() {\n\t// hackalert!\n\t// if open_mapped_doc is mentioned in the custom script, then mapper exists\n\tif(this._has_mapper === undefined) {\n\t\tthis._has_mapper = (this.meta.__js && this.meta.__js.search('open_mapped_doc')!==-1) ?\n\t\t\ttrue: false;\n\t}\n\treturn this._has_mapper;\n};\n\n_f.Frm.prototype.set_indicator_formatter = function(fieldname, get_color, get_text) {\n\t// get doctype from parent\n\tvar doctype;\n\tif(frappe.meta.docfield_map[this.doctype][fieldname]) {\n\t\tdoctype = this.doctype;\n\t} else {\n\t\tfrappe.meta.get_table_fields(this.doctype).every(function(df) {\n\t\t\tif(frappe.meta.docfield_map[df.options][fieldname]) {\n\t\t\t\tdoctype = df.options;\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\n\tfrappe.meta.docfield_map[doctype][fieldname].formatter =\n\t\tfunction(value, df, options, doc) {\n\t\t\tif(value) {\n\t\t\t\tvar label;\n\t\t\t\tif(get_text) {\n\t\t\t\t\tlabel = get_text(doc);\n\t\t\t\t} else if(frappe.form.link_formatters[df.options]) {\n\t\t\t\t\tlabel = frappe.form.link_formatters[df.options](value, doc);\n\t\t\t\t} else {\n\t\t\t\t\tlabel = value;\n\t\t\t\t}\n\n\t\t\t\tconst escaped_name = encodeURIComponent(value);\n\t\t\t\treturn repl('<a class=\"indicator %(color)s\" href=\"#Form/%(doctype)s/%(name)s\">%(label)s</a>', {\n\t\t\t\t\tcolor: get_color(doc || {}),\n\t\t\t\t\tdoctype: df.options,\n\t\t\t\t\tname: escaped_name,\n\t\t\t\t\tlabel: label\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t};\n};\n\n_f.Frm.prototype.can_create = function(doctype) {\n\t// return true or false if the user can make a particlar doctype\n\t// will check permission, `can_make_methods` if exists, or will decided on\n\t// basis of whether the document is submittable\n\tif(!frappe.model.can_create(doctype)) {\n\t\treturn false;\n\t}\n\n\tif(this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\t// custom buttons are translated and so are the keys\n\t\tconst key = __(this.custom_make_buttons[doctype]);\n\t\t// if the button is present, then show make\n\t\treturn !!this.custom_buttons[key];\n\t}\n\n\tif(this.can_make_methods && this.can_make_methods[doctype]) {\n\t\treturn this.can_make_methods[doctype](this);\n\t} else {\n\t\tif(this.meta.is_submittable && !this.doc.docstatus==1) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.make_new = function(doctype) {\n\t// make new doctype from the current form\n\t// will handover to `make_methods` if defined\n\t// or will create and match link fields\n\tvar me = this;\n\tif(this.make_methods && this.make_methods[doctype]) {\n\t\treturn this.make_methods[doctype](this);\n\t} else if(this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\tthis.custom_buttons[__(this.custom_make_buttons[doctype])].trigger('click');\n\t} else {\n\t\tfrappe.model.with_doctype(doctype, function() {\n\t\t\tvar new_doc = frappe.model.get_new_doc(doctype);\n\n\t\t\t// set link fields (if found)\n\t\t\tfrappe.get_meta(doctype).fields.forEach(function(df) {\n\t\t\t\tif(df.fieldtype==='Link' && df.options===me.doctype) {\n\t\t\t\t\tnew_doc[df.fieldname] = me.doc.name;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t\t// frappe.set_route('Form', doctype, new_doc.name);\n\t\t});\n\t}\n};\n\n_f.Frm.prototype.update_in_all_rows = function(table_fieldname, fieldname, value) {\n\t// update the child value in all tables where it is missing\n\tif(!value) return;\n\tvar cl = this.doc[table_fieldname] || [];\n\tfor(var i = 0; i < cl.length; i++){\n\t\tif(!cl[i][fieldname]) cl[i][fieldname] = value;\n\t}\n\trefresh_field(\"items\");\n};\n\n_f.Frm.prototype.get_sum = function(table_fieldname, fieldname) {\n\tlet sum = 0;\n\tfor (let d of (this.doc[table_fieldname] || [])) {\n\t\tsum += d[fieldname];\n\t}\n\treturn sum;\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\nfrappe.ui.form.Toolbar = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.refresh();\n\t\tthis.add_update_button_on_dirty();\n\t\tthis.setup_editable_title();\n\t},\n\trefresh: function() {\n\t\tthis.make_menu();\n\t\tthis.set_title();\n\t\tthis.page.clear_user_actions();\n\t\tthis.show_title_as_dirty();\n\t\tthis.set_primary_action();\n\n\t\tif(this.frm.meta.hide_toolbar) {\n\t\t\tthis.page.hide_menu();\n\t\t} else {\n\t\t\tif(this.frm.doc.__islocal) {\n\t\t\t\tthis.page.hide_menu();\n\t\t\t\tthis.print_icon && this.print_icon.addClass(\"hide\");\n\t\t\t} else {\n\t\t\t\tthis.page.show_menu();\n\t\t\t\tthis.print_icon && this.print_icon.removeClass(\"hide\");\n\t\t\t}\n\t\t}\n\t},\n\tset_title: function() {\n\t\tif(this.frm.meta.title_field) {\n\t\t\tvar title = strip_html((this.frm.doc[this.frm.meta.title_field] || \"\").trim() || this.frm.docname);\n\t\t\tif(this.frm.doc.__islocal || title === this.frm.docname || this.frm.meta.autoname===\"hash\") {\n\t\t\t\tthis.page.set_title_sub(\"\");\n\t\t\t} else {\n\t\t\t\tthis.page.set_title_sub(this.frm.docname);\n\t\t\t}\n\t\t} else {\n\t\t\tvar title = this.frm.docname;\n\t\t}\n\n\t\tvar me = this;\n\t\ttitle = __(title);\n\t\tthis.page.set_title(title);\n\t\tif(this.frm.meta.title_field) {\n\t\t\tfrappe.utils.set_title(title + \" - \" + this.frm.docname);\n\t\t}\n\t\tthis.page.$title_area.toggleClass(\"editable-title\",\n\t\t\t!!(this.is_title_editable() || this.can_rename()));\n\n\t\tthis.set_indicator();\n\t},\n\tis_title_editable: function() {\n\t\tif (this.frm.meta.title_field===\"title\"\n\t\t\t&& this.frm.perm[0].write\n\t\t\t&& !this.frm.get_docfield(\"title\").options\n\t\t\t&& !this.frm.doc.__islocal) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t},\n\tcan_rename: function() {\n\t\treturn this.frm.perm[0].write && this.frm.meta.allow_rename && !this.frm.doc.__islocal;\n\t},\n\tsetup_editable_title: function() {\n\t\tvar me = this;\n\t\tthis.page.$title_area.find(\".title-text\").on(\"click\", function() {\n\t\t\tif(me.is_title_editable()) {\n\t\t\t\tfrappe.prompt({fieldname: \"title\", fieldtype:\"Data\",\n\t\t\t\t\tlabel: __(\"Title\"), reqd: 1, \"default\": me.frm.doc.title },\n\t\t\t\t\tfunction(data) {\n\t\t\t\t\t\tif(data.title) {\n\t\t\t\t\t\t\tme.frm.set_value(\"title\", data.title);\n\t\t\t\t\t\t\tif(!me.frm.doc.__islocal) {\n\t\t\t\t\t\t\t\tme.frm.save_or_update();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.set_title();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, __(\"Edit Title\"), __(\"Update\"));\n\t\t\t}\n\t\t\tif(me.can_rename()) {\n\t\t\t\tme.frm.rename_doc();\n\t\t\t}\n\t\t});\n\t},\n\tget_dropdown_menu: function(label) {\n\t\treturn this.page.add_dropdown(label);\n\t},\n\tset_indicator: function() {\n\t\tif(this.frm.save_disabled)\n\t\t\treturn;\n\n\t\tvar indicator = frappe.get_indicator(this.frm.doc);\n\t\tif(indicator) {\n\t\t\tthis.page.set_indicator(indicator[0], indicator[1]);\n\t\t} else {\n\t\t\tthis.page.clear_indicator();\n\t\t}\n\t},\n\tmake_menu: function() {\n\t\tthis.page.clear_icons();\n\t\tthis.page.clear_menu();\n\t\tvar me = this;\n\t\tvar p = this.frm.perm[0];\n\t\tvar docstatus = cint(this.frm.doc.docstatus);\n\t\tvar is_submittable = frappe.model.is_submittable(this.frm.doc.doctype)\n\t\tvar issingle = this.frm.meta.issingle;\n\t\tvar print_settings = frappe.model.get_doc(\":Print Settings\", \"Print Settings\")\n\t\tvar allow_print_for_draft = cint(print_settings.allow_print_for_draft);\n\t\tvar allow_print_for_cancelled = cint(print_settings.allow_print_for_cancelled);\n\n\t\t// Print\n\t\tif(!is_submittable || docstatus == 1  ||\n\t\t\t(allow_print_for_cancelled && docstatus == 2)||\n\t\t\t(allow_print_for_draft && docstatus == 0)) {\n\t\t\tif(frappe.model.can_print(null, me.frm) && !issingle) {\n\t\t\t\tthis.page.add_menu_item(__(\"Print\"), function() {\n\t\t\t\t\tme.frm.print_doc();}, true);\n\t\t\t\tthis.print_icon = this.page.add_action_icon(\"fa fa-print\", function() {\n\t\t\t\t\tme.frm.print_doc();});\n\t\t\t}\n\t\t}\n\n\t\t// email\n\t\tif(frappe.model.can_email(null, me.frm) && me.frm.doc.docstatus < 2) {\n\t\t\tthis.page.add_menu_item(__(\"Email\"), function() {\n\t\t\t\tme.frm.email_doc();}, true);\n\t\t}\n\n\t\t// Linked With\n\t\tif(!me.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__('Links'), function() {\n\t\t\t\tme.show_linked_with();\n\t\t\t}, true)\n\t\t}\n\n\t\t// copy\n\t\tif(in_list(frappe.boot.user.can_create, me.frm.doctype) && !me.frm.meta.allow_copy) {\n\t\t\tthis.page.add_menu_item(__(\"Duplicate\"), function() {\n\t\t\t\tme.frm.copy_doc();}, true);\n\t\t}\n\n\t\t// rename\n\t\tif(this.can_rename()) {\n\t\t\tthis.page.add_menu_item(__(\"Rename\"), function() {\n\t\t\t\tme.frm.rename_doc();}, true);\n\t\t}\n\n\t\t// reload\n\t\tthis.page.add_menu_item(__(\"Reload\"), function() {\n\t\t\tme.frm.reload_doc();}, true);\n\n\t\t// add to desktop\n\t\tif(me.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__('Add to Desktop'), function () {\n\t\t\t\tfrappe.add_to_desktop(me.frm.doctype, me.frm.doctype);\n\t\t\t}, true);\n\t\t}\n\n\t\t// delete\n\t\tif((cint(me.frm.doc.docstatus) != 1) && !me.frm.doc.__islocal\n\t\t\t&& frappe.model.can_delete(me.frm.doctype)) {\n\t\t\tthis.page.add_menu_item(__(\"Delete\"), function() {\n\t\t\t\tme.frm.savetrash();}, true);\n\t\t}\n\n\t\tif(frappe.user_roles.includes(\"System Manager\")) {\n\t\t\tthis.page.add_menu_item(__(\"Customize\"), function() {\n\t\t\t\tfrappe.set_route(\"Form\", \"Customize Form\", {\n\t\t\t\t\tdoc_type: me.frm.doctype\n\t\t\t\t})\n\t\t\t}, true);\n\n\t\t\tif (frappe.boot.developer_mode===1 && me.frm.meta.issingle) {\n\t\t\t\t// edit doctype\n\t\t\t\tthis.page.add_menu_item(__(\"Edit DocType\"), function() {\n\t\t\t\t\tfrappe.set_route('Form', 'DocType', me.frm.doctype);\n\t\t\t\t}, true);\n\t\t\t}\n\t\t}\n\n\t\t// feedback\n\t\tif(!this.frm.doc.__unsaved) {\n\t\t\tif(is_submittable && docstatus == 1) {\n\t\t\t\tthis.page.add_menu_item(__(\"Request Feedback\"), function() {\n\t\t\t\t\tvar feedback = new frappe.utils.Feedback();\n\t\t\t\t\tfeedback.manual_feedback_request(me.frm.doc);\n\t\t\t\t}, true)\n\t\t\t}\n\t\t}\n\n\t\t// New\n\t\tif(p[CREATE] && !this.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__(\"New {0} (Ctrl+B)\", [__(me.frm.doctype)]), function() {\n\t\t\t\tfrappe.new_doc(me.frm.doctype, true);}, true);\n\t\t}\n\t},\n\tcan_save: function() {\n\t\treturn this.get_docstatus()===0;\n\t},\n\tcan_submit: function() {\n\t\treturn this.get_docstatus()===0\n\t\t\t&& !this.frm.doc.__islocal\n\t\t\t&& !this.frm.doc.__unsaved\n\t\t\t&& this.frm.perm[0].submit\n\t\t\t&& !this.has_workflow();\n\t},\n\tcan_update: function() {\n\t\treturn this.get_docstatus()===1\n\t\t\t&& !this.frm.doc.__islocal\n\t\t\t&& this.frm.perm[0].submit\n\t\t\t&& this.frm.doc.__unsaved\n\t},\n\tcan_cancel: function() {\n\t\treturn this.get_docstatus()===1\n\t\t\t&& this.frm.perm[0].cancel\n\t\t\t&& !this.read_only;\n\t},\n\tcan_amend: function() {\n\t\treturn this.get_docstatus()===2\n\t\t\t&& this.frm.perm[0].amend\n\t\t\t&& !this.read_only;\n\t},\n\thas_workflow: function() {\n\t\tif(this._has_workflow === undefined)\n\t\t\tthis._has_workflow = frappe.get_list(\"Workflow\", {document_type: this.frm.doctype}).length;\n\t\treturn this._has_workflow;\n\t},\n\tget_docstatus: function() {\n\t\treturn cint(this.frm.doc.docstatus);\n\t},\n\tshow_linked_with: function() {\n\t\tif(!this.frm.linked_with) {\n\t\t\tthis.frm.linked_with = new frappe.ui.form.LinkedWith({\n\t\t\t\tfrm: this.frm\n\t\t\t});\n\t\t}\n\t\tthis.frm.linked_with.show();\n\t},\n\tset_primary_action: function(dirty) {\n\t\tif (!dirty) {\n\t\t\t// don't clear actions menu if dirty\n\t\t\tthis.page.clear_user_actions();\n\t\t}\n\n\t\tvar status = this.get_action_status();\n\t\tif (status) {\n\t\t\tif (status !== this.current_status) {\n\t\t\t\tthis.set_page_actions(status);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.page.clear_actions();\n\t\t\tthis.current_status = null\n\t\t}\n\t},\n\tget_action_status: function() {\n\t\tvar status = null;\n\t\tif (this.frm.page.current_view_name==='print' || this.frm.hidden) {\n\t\t\tstatus = \"Edit\";\n\t\t} else if (this.can_submit()) {\n\t\t\tstatus = \"Submit\";\n\t\t} else if (this.can_save()) {\n\t\t\tif (!this.frm.save_disabled) {\n\t\t\t\t//Show the save button if there is no workflow or if there is a workflow and there are changes\n\t\t\t\tif (this.has_workflow() ? this.frm.doc.__unsaved : true) {\n\t\t\t\t\tstatus = \"Save\";\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (this.can_update()) {\n\t\t\tstatus = \"Update\";\n\t\t} else if (this.can_cancel()) {\n\t\t\tstatus = \"Cancel\";\n\t\t} else if (this.can_amend()) {\n\t\t\tstatus = \"Amend\";\n\t\t}\n\t\treturn status;\n\t},\n\tset_page_actions: function(status) {\n\t\tvar me = this;\n\t\tthis.page.clear_actions();\n\n\t\tif(status!== 'Edit') {\n\t\t\tvar perm_to_check = this.frm.action_perm_type_map[status];\n\t\t\tif(!this.frm.perm[0][perm_to_check]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif(status === \"Edit\") {\n\t\t\tthis.page.set_primary_action(__(\"Edit\"), function() {\n\t\t\t\tme.frm.page.set_view('main');\n\t\t\t}, 'octicon octicon-pencil');\n\t\t} else if(status === \"Cancel\") {\n\t\t\tthis.page.set_secondary_action(__(status), function() {\n\t\t\t\tme.frm.savecancel(this);\n\t\t\t}, \"octicon octicon-circle-slash\");\n\t\t} else {\n\t\t\tvar click = {\n\t\t\t\t\"Save\": function() {\n\t\t\t\t\treturn me.frm.save('Save', null, this);\n\t\t\t\t},\n\t\t\t\t\"Submit\": function() {\n\t\t\t\t\treturn me.frm.savesubmit(this);\n\t\t\t\t},\n\t\t\t\t\"Update\": function() {\n\t\t\t\t\treturn me.frm.save('Update', null, this);\n\t\t\t\t},\n\t\t\t\t\"Amend\": function() {\n\t\t\t\t\treturn me.frm.amend_doc();\n\t\t\t\t}\n\t\t\t}[status];\n\n\t\t\tvar icon = {\n\t\t\t\t\"Save\": \"octicon octicon-check\",\n\t\t\t\t\"Submit\": \"octicon octicon-lock\",\n\t\t\t\t\"Update\": \"octicon octicon-check\",\n\t\t\t\t\"Amend\": \"octicon octicon-split\"\n\t\t\t}[status];\n\n\t\t\tthis.page.set_primary_action(__(status), click, icon);\n\t\t}\n\n\t\tthis.current_status = status;\n\t},\n\tmake_cancel_amend_button: function() {\n\t\tvar me = this;\n\t\tvar docstatus = cint(this.frm.doc.docstatus);\n\t\tvar p = this.frm.perm[0];\n\t\tvar has_workflow = this.has_workflow();\n\n\t\tif(has_workflow) {\n\t\t\treturn;\n\t\t} else if(docstatus==1 && p[CANCEL]) {\n\t\t\tthis.page.set_secondary_action(__('Cancel'), function() {\n\t\t\t\tme.frm.savecancel(this) }, 'fa fa-ban-circle');\n\t\t} else if(docstatus==2 && p[AMEND]) {\n\t\t\tthis.page.set_secondary_action(__('Amend'), function() {\n\t\t\t\tme.frm.amend_doc() }, 'fa fa-pencil', true);\n\t\t}\n\t},\n\tadd_update_button_on_dirty: function() {\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).on(\"dirty\", function() {\n\t\t\tme.show_title_as_dirty();\n\n\t\t\t// clear workflow actions\n\t\t\tme.frm.page.clear_actions_menu();\n\n\t\t\t// enable save action\n\t\t\tif(!me.frm.save_disabled) {\n\t\t\t\tme.set_primary_action(true);\n\t\t\t}\n\t\t});\n\t},\n\tshow_title_as_dirty: function() {\n\t\tif(this.frm.save_disabled)\n\t\t\treturn;\n\n\t\tif(this.frm.doc.__unsaved) {\n\t\t\tthis.page.set_indicator(__(\"Not Saved\"), \"orange\");\n\t\t}\n\n\t\t$(this.frm.wrapper).attr(\"data-state\", this.frm.doc.__unsaved ? \"dirty\" : \"clean\");\n\t}\n})\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Dashboard = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.section = this.frm.fields_dict._form_dashboard.wrapper;\n\t\tthis.parent = this.section.find('.section-body');\n\t\tthis.wrapper = $(frappe.render_template('form_dashboard',\n\t\t\t{frm: this.frm})).appendTo(this.parent);\n\n\t\tthis.progress_area = this.wrapper.find(\".progress-area\");\n\t\tthis.heatmap_area = this.wrapper.find('.form-heatmap');\n\t\tthis.chart_area = this.wrapper.find('.form-graph');\n\t\tthis.stats_area = this.wrapper.find('.form-stats');\n\t\tthis.stats_area_row = this.stats_area.find('.row');\n\t\tthis.links_area = this.wrapper.find('.form-links');\n\t\tthis.transactions_area = this.links_area.find('.transactions');\n\n\t},\n\treset: function() {\n\t\tthis.section.addClass('hidden');\n\t\tthis.clear_headline();\n\n\t\t// clear progress\n\t\tthis.progress_area.empty().addClass('hidden');\n\n\t\t// clear links\n\t\tthis.links_area.addClass('hidden');\n\t\tthis.links_area.find('.count, .open-notification').addClass('hidden');\n\n\t\t// clear stats\n\t\tthis.stats_area.addClass('hidden')\n\t\tthis.stats_area_row.empty();\n\n\t\t// clear custom\n\t\tthis.wrapper.find('.custom').remove();\n\t},\n\tset_headline: function(html) {\n\t\tthis.frm.layout.show_message(html);\n\t},\n\tclear_headline: function() {\n\t\tthis.frm.layout.show_message();\n\t},\n\n\tadd_comment: function(text, alert_class, permanent) {\n\t\tvar me = this;\n\t\tthis.set_headline_alert(text, alert_class);\n\t\tif(!permanent) {\n\t\t\tsetTimeout(function() {\n\t\t\t\tme.clear_headline();\n\t\t\t}, 10000);\n\t\t}\n\t},\n\n\tclear_comment: function() {\n\t\tthis.clear_headline();\n\t},\n\n\tset_headline_alert: function(text, indicator_color) {\n\t\tif (!indicator_color) {\n\t\t\tindicator_color = 'orange';\n\t\t}\n\t\tif(text) {\n\t\t\tthis.set_headline(`<div><span class=\"indicator ${indicator_color}\">${text}</span></div>`);\n\t\t} else {\n\t\t\tthis.clear_headline();\n\t\t}\n\t},\n\n\tadd_section: function(html) {\n\t\treturn $('<div class=\"form-dashboard-section custom\">'+html+'</div>').appendTo(this.wrapper);\n\t},\n\n\tadd_progress: function(title, percent, message) {\n\t\tvar progress_chart = this.make_progress_chart(title);\n\n\t\tif(!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\n\t\tvar progress = $('<div class=\"progress\"></div>').appendTo(progress_chart);\n\t\t$.each(percent, function(i, opts) {\n\t\t\t$(repl('<div class=\"progress-bar %(progress_class)s\" style=\"width: %(width)s\" \\\n\t\t\t\ttitle=\"%(title)s\"></div>', opts)).appendTo(progress);\n\t\t});\n\n\t\tif (!message) message = '';\n\t\t$(`<p class=\"progress-message text-muted small\">${message}</p>`).appendTo(progress_chart);\n\n\t\tthis.show();\n\n\t\treturn progress_chart;\n\t},\n\n\tshow_progress: function(title, percent, message) {\n\t\tthis._progress_map = this._progress_map || {};\n\t\tif (!this._progress_map[title]) {\n\t\t\tconst progress_chart = this.add_progress(title, percent, message);\n\t\t\tthis._progress_map[title] = progress_chart;\n\t\t}\n\t\tlet progress_chart = this._progress_map[title];\n\t\tif (!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\t\tprogress_chart.find('.progress-bar').each((i, progress_bar) => {\n\t\t\tconst { progress_class, width } = percent[i];\n\t\t\t$(progress_bar).css('width', width)\n\t\t\t\t.removeClass('progress-bar-danger progress-bar-success')\n\t\t\t\t.addClass(progress_class);\n\t\t});\n\n\t\tif (!message) message = '';\n\t\tprogress_chart.find('.progress-message').text(message);\n\t},\n\n\thide_progress: function(title) {\n\t\tif (title){\n\t\t\tthis._progress_map[title].remove();\n\t\t\tdelete this._progress_map[title];\n\t\t} else {\n\t\t\tthis._progress_map = {};\n\t\t\tthis.progress_area.empty();\n\t\t}\n\t},\n\n\tformat_percent: function(title, percent) {\n\t\tvar width = cint(percent) < 1 ? 1 : cint(percent);\n\t\tvar progress_class = \"\";\n\t\tif(width < 10)\n\t\t\tprogress_class = \"progress-bar-danger\";\n\t\tif(width > 99.9)\n\t\t\tprogress_class = \"progress-bar-success\";\n\n\t\treturn [{\n\t\t\ttitle: title,\n\t\t\twidth: width + '%',\n\t\t\tprogress_class: progress_class\n\t\t}];\n\t},\n\tmake_progress_chart: function(title) {\n\t\tvar progress_chart = $('<div class=\"progress-chart\" title=\"'+(title || '')+'\"></div>')\n\t\t\t.appendTo(this.progress_area.removeClass('hidden'));\n\t\treturn progress_chart;\n\t},\n\n\trefresh: function() {\n\t\tthis.reset();\n\t\tif(this.frm.doc.__islocal) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tvar show = false;\n\n\t\tif(this.data && (this.data.transactions || []).length) {\n\t\t\tif(this.data.docstatus && this.frm.doc.docstatus !== this.data.docstatus) {\n\t\t\t\t// limited docstatus\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.render_links();\n\t\t\tthis.set_open_count();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(this.data.heatmap) {\n\t\t\tthis.render_heatmap();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(this.data.graph) {\n\t\t\tthis.setup_graph();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(show) {\n\t\t\tthis.show();\n\t\t}\n\t},\n\n\tafter_refresh: function() {\n\t\tvar me = this;\n\t\t// show / hide new buttons (if allowed)\n\t\tthis.links_area.find('.btn-new').each(function() {\n\t\t\tif(me.frm.can_create($(this).attr('data-doctype'))) {\n\t\t\t\t$(this).removeClass('hidden');\n\t\t\t}\n\t\t});\n\t},\n\n\tinit_data: function() {\n\t\tthis.data = this.frm.meta.__dashboard || {};\n\t\tif(!this.data.transactions) this.data.transactions = [];\n\t\tif(!this.data.internal_links) this.data.internal_links = {};\n\t\tthis.filter_permissions();\n\t},\n\n\tadd_transactions: function(opts) {\n\t\t// add additional data on dashboard\n\t\tlet group_added = [];\n\n\t\tif(!Array.isArray(opts)) opts=[opts];\n\n\t\tif(!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tif(this.data && (this.data.transactions || []).length) {\n\t\t\t// check if label already exists, add items to it\n\t\t\tthis.data.transactions.map(group => {\n\t\t\t\topts.map(d => {\n\t\t\t\t\tif(d.label == group.label) {\n\t\t\t\t\t\tgroup_added.push(d.label);\n\t\t\t\t\t\tgroup.items.push(...d.items);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// if label not already present, add new label and items under it\n\t\t\topts.map(d => {\n\t\t\t\tif(!group_added.includes(d.label)) {\n\t\t\t\t\tthis.data.transactions.push(d);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.filter_permissions();\n\t\t}\n\t},\n\n\tfilter_permissions: function() {\n\t\t// filter out transactions for which the user\n\t\t// does not have permission\n\t\tvar transactions = [];\n\t\t(this.data.transactions || []).forEach(function(group) {\n\t\t\tvar items = [];\n\t\t\tgroup.items.forEach(function(doctype) {\n\t\t\t\tif(frappe.model.can_read(doctype)) {\n\t\t\t\t\titems.push(doctype);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// only add thie group, if there is atleast\n\t\t\t// one item with permission\n\t\t\tif(items.length) {\n\t\t\t\tgroup.items = items;\n\t\t\t\ttransactions.push(group);\n\t\t\t}\n\t\t});\n\t\tthis.data.transactions = transactions;\n\t},\n\trender_links: function() {\n\t\tvar me = this;\n\t\tthis.links_area.removeClass('hidden');\n\t\tthis.links_area.find('.btn-new').addClass('hidden');\n\t\tif(this.data_rendered) {\n\t\t\treturn;\n\t\t}\n\n\t\t//this.transactions_area.empty();\n\n\t\tthis.data.frm = this.frm;\n\n\t\t$(frappe.render_template('form_links', this.data))\n\t\t\t.appendTo(this.transactions_area)\n\n\t\t// bind links\n\t\tthis.transactions_area.find(\".badge-link\").on('click', function() {\n\t\t\tme.open_document_list($(this).parent());\n\t\t});\n\n\t\t// bind open notifications\n\t\tthis.transactions_area.find('.open-notification').on('click', function() {\n\t\t\tme.open_document_list($(this).parent(), true);\n\t\t});\n\n\t\t// bind new\n\t\tthis.transactions_area.find('.btn-new').on('click', function() {\n\t\t\tme.frm.make_new($(this).attr('data-doctype'));\n\t\t});\n\n\t\tthis.data_rendered = true;\n\t},\n\topen_document_list: function($link, show_open) {\n\t\t// show document list with filters\n\t\tvar doctype = $link.attr('data-doctype'),\n\t\t\tnames = $link.attr('data-names') || [];\n\n\t\tif(this.data.internal_links[doctype]) {\n\t\t\tif(names.length) {\n\t\t\t\tfrappe.route_options = {'name': ['in', names]};\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else if(this.data.fieldname) {\n\t\t\tfrappe.route_options = this.get_document_filter(doctype);\n\t\t\tif(show_open) {\n\t\t\t\tfrappe.ui.notifications.show_open_count_list(doctype);\n\t\t\t}\n\t\t}\n\n\t\tfrappe.set_route(\"List\", doctype, \"List\");\n\t},\n\tget_document_filter: function(doctype) {\n\t\t// return the default filter for the given document\n\t\t// like {\"customer\": frm.doc.name}\n\t\tvar filter = {};\n\t\tvar fieldname = this.data.non_standard_fieldnames\n\t\t\t? (this.data.non_standard_fieldnames[doctype] || this.data.fieldname)\n\t\t\t: this.data.fieldname;\n\t\tfilter[fieldname] = this.frm.doc.name;\n\t\treturn filter;\n\t},\n\tset_open_count: function() {\n\t\tif(!this.data.transactions || !this.data.fieldname) {\n\t\t\treturn;\n\t\t}\n\n\t\t// list all items from the transaction list\n\t\tvar items = [],\n\t\t\tme = this;\n\n\t\tthis.data.transactions.forEach(function(group) {\n\t\t\tgroup.items.forEach(function(item) { items.push(item); });\n\t\t});\n\n\t\tvar method = this.data.method || 'frappe.desk.notifications.get_open_count';\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.doc.name,\n\t\t\t\titems: items\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message.timeline_data) {\n\t\t\t\t\tme.update_heatmap(r.message.timeline_data);\n\t\t\t\t}\n\n\t\t\t\t// update badges\n\t\t\t\t$.each(r.message.count, function(i, d) {\n\t\t\t\t\tme.frm.dashboard.set_badge_count(d.name, cint(d.open_count), cint(d.count));\n\t\t\t\t});\n\n\t\t\t\t// update from internal links\n\t\t\t\t$.each(me.data.internal_links, function(doctype, link) {\n\t\t\t\t\tvar table_fieldname = link[0], link_fieldname = link[1];\n\t\t\t\t\tvar names = [];\n\t\t\t\t\t(me.frm.doc[table_fieldname] || []).forEach(function(d) {\n\t\t\t\t\t\tvar value = d[link_fieldname];\n\t\t\t\t\t\tif(value && names.indexOf(value)===-1) {\n\t\t\t\t\t\t\tnames.push(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tme.frm.dashboard.set_badge_count(doctype, 0, names.length, names);\n\t\t\t\t});\n\n\t\t\t\tme.frm.dashboard_data = r.message;\n\t\t\t\tme.frm.trigger('dashboard_update');\n\t\t\t}\n\t\t});\n\n\t},\n\tset_badge_count: function(doctype, open_count, count, names) {\n\t\tvar $link = $(this.transactions_area)\n\t\t\t.find('.document-link[data-doctype=\"'+doctype+'\"]');\n\n\t\tif(open_count) {\n\t\t\t$link.find('.open-notification')\n\t\t\t\t.removeClass('hidden')\n\t\t\t\t.html((open_count > 99) ? '99+' : open_count);\n\t\t}\n\n\t\tif(count) {\n\t\t\t$link.find('.count')\n\t\t\t\t.removeClass('hidden')\n\t\t\t\t.html((count > 99) ? '99+' : count);\n\t\t}\n\n\t\tif(this.data.internal_links[doctype]) {\n\t\t\tif(names && names.length) {\n\t\t\t\t$link.attr('data-names', names ? names.join(',') : '');\n\t\t\t} else {\n\t\t\t\t$link.find('a').attr('disabled', true);\n\t\t\t}\n\t\t}\n\t},\n\n\tupdate_heatmap: function(data) {\n\t\tif(this.heatmap) {\n\t\t\tthis.heatmap.update(data);\n\t\t}\n\t},\n\n\t// heatmap\n\trender_heatmap: function() {\n\t\tif(!this.heatmap) {\n\t\t\tthis.heatmap = new Chart(\"#heatmap-\" + frappe.model.scrub(this.frm.doctype), {\n\t\t\t\ttype: 'heatmap',\n\t\t\t\theight: 120,\n\t\t\t\tstart: new Date(moment().subtract(1, 'year').toDate()),\n\t\t\t\tcount_label: \"interactions\",\n\t\t\t\tdiscreteDomains: 0,\n\t\t\t\tdata: {}\n\t\t\t});\n\n\t\t\t// center the heatmap\n\t\t\tthis.heatmap_area.removeClass('hidden').find('svg').css({'margin': 'auto'});\n\n\t\t\t// message\n\t\t\tvar heatmap_message = this.heatmap_area.find('.heatmap-message');\n\t\t\tif(this.data.heatmap_message) {\n\t\t\t\theatmap_message.removeClass('hidden').html(this.data.heatmap_message);\n\t\t\t} else {\n\t\t\t\theatmap_message.addClass('hidden');\n\t\t\t}\n\t\t}\n\t},\n\n\tadd_indicator: function(label, color) {\n\t\tthis.show();\n\t\tthis.stats_area.removeClass('hidden');\n\n\n\t\t// set colspan\n\t\tvar indicators = this.stats_area_row.find('.indicator-column');\n\t\tvar n_indicators = indicators.length + 1;\n\t\tvar colspan;\n\t\tif(n_indicators > 4) { colspan = 3 }\n\t\telse { colspan = 12 / n_indicators; }\n\n\t\t// reset classes in existing indicators\n\t\tif(indicators.length) {\n\t\t\tindicators.removeClass().addClass('col-sm-'+colspan).addClass('indicator-column');\n\t\t}\n\n\t\tvar indicator = $('<div class=\"col-sm-'+colspan+' indicator-column\"><span class=\"indicator '+color+'\">'\n\t\t\t+label+'</span></div>').appendTo(this.stats_area_row);\n\n\t\treturn indicator;\n\t},\n\n\t// graphs\n\tsetup_graph: function() {\n\t\tvar me = this;\n\t\tvar method = this.data.graph_method;\n\t\tvar args = {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.doc.name,\n\t\t};\n\t\t$.extend(args, this.data.graph_method_args);\n\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: args,\n\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tme.render_graph(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\trender_graph: function(args) {\n\t\tvar me = this;\n\t\tthis.chart_area.empty().removeClass('hidden');\n\t\t$.extend(args, {\n\t\t\ttype: 'line',\n\t\t\tcolors: ['green']\n\t\t});\n\t\tthis.show();\n\n\t\tthis.chart = new Chart('.form-graph', args);\n\t\tif(!this.chart) {\n\t\t\tthis.hide();\n\t\t}\n\t},\n\n\tshow: function() {\n\t\tthis.section.removeClass('hidden');\n\t},\n\n\thide: function() {\n\t\tthis.section.addClass('hidden');\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.document_flow');\n\nfrappe.ui.form.DocumentFlow = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\n\t\tthis.module = frappe.get_meta(this.frm.doctype).module\n\t\tif (!frappe.document_flow || !frappe.document_flow[this.module]) {\n\t\t\treturn;\n\t\t}\n\t\tthis.doctypes = frappe.document_flow[this.module][this.frm.doctype];\n\t\tif (!this.doctypes) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.wrapper = $('<div class=\"document-flow-wrapper hidden\"></div>').prependTo(this.frm.layout.wrapper);\n\t},\n\n\trefresh: function() {\n\t\tif(this.doctypes) {\n\t\t\tthis.reset();\n\t\t\tthis.render();\n\t\t}\n\t},\n\n\treset: function() {\n\t\tthis.wrapper.empty().addClass('hidden');\n\t\tthis.linked_with = {};\n\t},\n\n\trender: function() {\n\t\tvar me = this;\n\n\t\t$(frappe.render_template('form_document_flow', {\n\t\t\tfrm: this.frm,\n\t\t\tdoctypes: this.doctypes,\n\t\t})).appendTo(this.wrapper.removeClass('hidden'));\n\n\t\tthis.wrapper.on('click', '.document-flow-link', function() {\n\t\t\tvar doctype = $(this).attr(\"data-doctype\");\n\t\t\tif (me.frm.doctype != doctype) {\n\t\t\t\tme.get_linked_docs(doctype);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif (!this.frm.doc.__islocal) {\n\t\t\tthis.mark_completed_flow()\n\t\t}\n\n\t},\n\n\tget_linked_docs: function(for_doctype) {\n\t\tif(!this.linked_with[for_doctype]) {\n\t\t\tthis.linked_with[for_doctype] = new frappe.ui.form.LinkedWith({\n\t\t\t\tfrm: this.frm,\n\t\t\t\tfor_doctype: for_doctype\n\t\t\t});\n\t\t}\n\n\t\tthis.linked_with[for_doctype].show();\n\t},\n\n\tmark_completed_flow: function() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.desk.form.document_flow.get_document_completion_status\",\n\t\t\targs: {\n\t\t\t\tdoctypes: me.doctypes,\n\t\t\t\tfrm_doctype: me.frm.doctype,\n\t\t\t\tfrm_docname: me.frm.docname\n\t\t\t},\n\t\t\tcallback: function(r){\n\t\t\t\tif(!r.message) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$.each(me.doctypes, function(i, doctype) {\n\t\t\t\t\tif (r.message[doctype] && me.frm.doctype!=doctype) {\n\t\t\t\t\t\tme.wrapper.find(\"[data-doctype='\"+doctype+\"']a .indicator\")\n\t\t\t\t\t\t\t.removeClass(\"darkgrey\")\n\t\t\t\t\t\t\t.addClass(\"black\")\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.save = function (frm, action, callback, btn) {\n\t$(btn).prop(\"disabled\", true);\n\n\t// specified here because there are keyboard shortcuts to save\n\tvar working_label = {\n\t\t\"Save\": __(\"Saving\"),\n\t\t\"Submit\": __(\"Submitting\"),\n\t\t\"Update\": __(\"Updating\"),\n\t\t\"Amend\": __(\"Amending\"),\n\t\t\"Cancel\": __(\"Cancelling\")\n\t}[toTitle(action)];\n\n\tvar freeze_message = working_label ? __(working_label) : \"\";\n\n\tvar save = function () {\n\t\tremove_empty_rows();\n\n\t\t$(frm.wrapper).addClass('validated-form');\n\t\tif (check_mandatory()) {\n\t\t\t_call({\n\t\t\t\tmethod: \"frappe.desk.form.save.savedocs\",\n\t\t\t\targs: { doc: frm.doc, action: action },\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\terror: function (r) {\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\tbtn: btn,\n\t\t\t\tfreeze_message: freeze_message\n\t\t\t});\n\t\t} else {\n\t\t\t$(btn).prop(\"disabled\", false);\n\t\t}\n\t};\n\n\tvar remove_empty_rows = function() {\n\t\t/**\n\t\tThis function removes empty rows. Note that in this function, a row is considered\n\t\tempty if the fields with `in_list_view: 1` are undefined or falsy because that's\n\t\twhat users also consider to be an empty row\n\t\t */\n\t\tconst docs = frappe.model.get_all_docs(frm.doc);\n\n\t\t// we should only worry about table data\n\t\tconst tables = docs.filter(function(d){\n\t\t\treturn frappe.model.is_table(d.doctype);\n\t\t});\n\n\t\ttables.map(\n\t\t\tfunction(doc){\n\t\t\t\tconst cells = frappe.meta.docfield_list[doc.doctype] || [];\n\n\t\t\t\tconst in_list_view_cells = cells.filter(function(df) {\n\t\t\t\t\treturn cint(df.in_list_view) === 1;\n\t\t\t\t});\n\n\t\t\t\tvar is_empty_row = function(cells) {\n\t\t\t\t\tfor (var i=0; i < cells.length; i++){\n\t\t\t\t\t\tif(locals[doc.doctype][doc.name][cells[i].fieldname]){\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (is_empty_row(in_list_view_cells)) {\n\t\t\t\t\tfrappe.model.clear_doc(doc.doctype, doc.name);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t};\n\n\tvar cancel = function () {\n\t\tvar args = {\n\t\t\tdoctype: frm.doc.doctype,\n\t\t\tname: frm.doc.name\n\t\t};\n\n\t\t// update workflow state value if workflow exists\n\t\tvar workflow_state_fieldname = frappe.workflow.get_state_fieldname(frm.doctype);\n\t\tif (workflow_state_fieldname) {\n\t\t\t$.extend(args, {\n\t\t\t\tworkflow_state_fieldname: workflow_state_fieldname,\n\t\t\t\tworkflow_state: frm.doc[workflow_state_fieldname]\n\n\t\t\t});\n\t\t}\n\n\t\t_call({\n\t\t\tmethod: \"frappe.desk.form.save.cancel\",\n\t\t\targs: args,\n\t\t\tcallback: function (r) {\n\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\tcallback(r);\n\t\t\t},\n\t\t\tbtn: btn,\n\t\t\tfreeze_message: freeze_message\n\t\t});\n\t};\n\n\tvar check_mandatory = function () {\n\t\tvar me = this;\n\t\tvar has_errors = false;\n\t\tfrm.scroll_set = false;\n\n\t\tif (frm.doc.docstatus == 2) return true; // don't check for cancel\n\n\t\t$.each(frappe.model.get_all_docs(frm.doc), function (i, doc) {\n\t\t\tvar error_fields = [];\n\t\t\tvar folded = false;\n\n\t\t\t$.each(frappe.meta.docfield_list[doc.doctype] || [], function (i, docfield) {\n\t\t\t\tif (docfield.fieldname) {\n\t\t\t\t\tvar df = frappe.meta.get_docfield(doc.doctype,\n\t\t\t\t\t\tdocfield.fieldname, frm.doc.name);\n\n\t\t\t\t\tif (df.fieldtype === \"Fold\") {\n\t\t\t\t\t\tfolded = frm.layout.folded;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (df.reqd && !frappe.model.has_value(doc.doctype, doc.name, df.fieldname)) {\n\t\t\t\t\t\thas_errors = true;\n\t\t\t\t\t\terror_fields[error_fields.length] = __(df.label);\n\t\t\t\t\t\t// scroll to field\n\t\t\t\t\t\tif (!frm.scroll_set) {\n\t\t\t\t\t\t\tscroll_to(doc.parentfield || df.fieldname);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (folded) {\n\t\t\t\t\t\t\tfrm.layout.unfold();\n\t\t\t\t\t\t\tfolded = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (error_fields.length) {\n\t\t\t\tif (doc.parenttype) {\n\t\t\t\t\tvar message = __('Mandatory fields required in table {0}, Row {1}',\n\t\t\t\t\t\t[__(frappe.meta.docfield_map[doc.parenttype][doc.parentfield].label).bold(), doc.idx]);\n\t\t\t\t} else {\n\t\t\t\t\tvar message = __('Mandatory fields required in {0}', [__(doc.doctype)]);\n\n\t\t\t\t}\n\t\t\t\tmessage = message + '<br><br><ul><li>' + error_fields.join('</li><li>') + \"</ul>\";\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\ttitle: __('Missing Fields')\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn !has_errors;\n\t};\n\n\tvar scroll_to = function (fieldname) {\n\t\tvar f = cur_frm.fields_dict[fieldname];\n\t\tif (f) {\n\t\t\t$(document).scrollTop($(f.wrapper).offset().top - 60);\n\t\t}\n\t\tfrm.scroll_set = true;\n\t};\n\n\tvar _call = function (opts) {\n\t\t// opts = {\n\t\t// \tmethod: \"some server method\",\n\t\t// \targs: {args to be passed},\n\t\t// \tcallback: callback,\n\t\t// \tbtn: btn\n\t\t// }\n\n\t\tif (frappe.ui.form.is_saving) {\n\t\t\t// this is likely to happen if the user presses the shortcut cmd+s for a longer duration or uses double click\n\t\t\t// no need to show this to user, as they can see \"Saving\" in freeze message\n\t\t\tconsole.log(\"Already saving. Please wait a few moments.\")\n\t\t\tthrow \"saving\";\n\t\t}\n\n\t\tfrappe.ui.form.remove_old_form_route();\n\t\tfrappe.ui.form.is_saving = true;\n\n\t\treturn frappe.call({\n\t\t\tfreeze: true,\n\t\t\t// freeze_message: opts.freeze_message,\n\t\t\tmethod: opts.method,\n\t\t\targs: opts.args,\n\t\t\tbtn: opts.btn,\n\t\t\tcallback: function (r) {\n\t\t\t\topts.callback && opts.callback(r);\n\t\t\t},\n\t\t\terror: opts.error,\n\t\t\talways: function (r) {\n\t\t\t\t$(btn).prop(\"disabled\", false);\n\t\t\t\tfrappe.ui.form.is_saving = false;\n\t\t\t\tif (r) {\n\t\t\t\t\tvar doc = r.docs && r.docs[0];\n\t\t\t\t\tif (doc) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(doc);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t};\n\n\tif (action === \"cancel\") {\n\t\tcancel();\n\t} else {\n\t\tsave();\n\t}\n}\n\nfrappe.ui.form.remove_old_form_route = () => {\n\tlet index = -1;\n\tlet current_route = frappe.get_route();\n\tfrappe.route_history.map((arr, i) => {\n\t\tif (arr.join(\"/\") === current_route.join(\"/\")) {\n\t\t\tindex = i;\n\t\t}\n\t});\n\tfrappe.route_history.splice(index, 1);\n}\n\nfrappe.ui.form.update_calling_link = (newdoc) => {\n\tif (frappe._from_link && newdoc.doctype === frappe._from_link.df.options) {\n\t\tvar doc = frappe.get_doc(frappe._from_link.doctype, frappe._from_link.docname);\n\t\t// set value\n\t\tif (doc && doc.parentfield) {\n\t\t\t//update values for child table\n\t\t\t$.each(frappe._from_link.frm.fields_dict[doc.parentfield].grid.grid_rows, function (index, field) {\n\t\t\t\tif (field.doc && field.doc.name === frappe._from_link.docname) {\n\t\t\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t}\n\n\t\t// refresh field\n\t\tfrappe._from_link.refresh();\n\n\t\t// if from form, switch\n\t\tif (frappe._from_link.frm) {\n\t\t\tfrappe.set_route(\"Form\",\n\t\t\t\tfrappe._from_link.frm.doctype, frappe._from_link.frm.docname)\n\t\t\t\t.then(() => {\n\t\t\t\t\tfrappe.utils.scroll_to(frappe._from_link_scrollY);\n\t\t\t\t});\n\t\t}\n\n\t\tfrappe._from_link = null;\n\t}\n}\n\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form.handlers\");\n\nfrappe.ui.form.get_event_handler_list = function(doctype, fieldname) {\n\tif(!frappe.ui.form.handlers[doctype]) {\n\t\tfrappe.ui.form.handlers[doctype] = {};\n\t}\n\tif(!frappe.ui.form.handlers[doctype][fieldname]) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\treturn frappe.ui.form.handlers[doctype][fieldname];\n}\n\nfrappe.ui.form.on = frappe.ui.form.on_change = function(doctype, fieldname, handler) {\n\tvar add_handler = function(fieldname, handler) {\n\t\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\t\thandler_list.push(handler);\n\n\t\t// add last handler to events so it can be called as\n\t\t// frm.events.handler(frm)\n\t\tif(cur_frm && cur_frm.doctype===doctype) {\n\t\t\tcur_frm.events[fieldname] = handler;\n\t\t}\n\t}\n\n\tif (!handler && $.isPlainObject(fieldname)) {\n\t\t// a dict of handlers {fieldname: handler, ...}\n\t\tfor (var key in fieldname) {\n\t\t\tvar fn = fieldname[key];\n\t\t\tif (typeof fn === \"function\") {\n\t\t\t\tadd_handler(key, fn);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tadd_handler(fieldname, handler);\n\t}\n}\n\n// remove standard event handlers\nfrappe.ui.form.off = function(doctype, fieldname, handler) {\n\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\tif(handler_list.length) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\n\tif(cur_frm && cur_frm.doctype===doctype && cur_frm.events[fieldname]) {\n\t\tdelete cur_frm.events[fieldname];\n\t}\n\n\tif(cur_frm && cur_frm.cscript && cur_frm.cscript[fieldname]) {\n\t\tdelete cur_frm.cscript[fieldname];\n\t}\n}\n\n\nfrappe.ui.form.trigger = function(doctype, fieldname) {\n\tcur_frm.script_manager.trigger(fieldname, doctype);\n}\n\nfrappe.ui.form.ScriptManager = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\tmake: function(ControllerClass) {\n\t\tthis.frm.cscript = $.extend(this.frm.cscript,\n\t\t\tnew ControllerClass({frm: this.frm}));\n\t},\n\ttrigger: function(event_name, doctype, name) {\n\t\t// trigger all the form level events that\n\t\t// are bound to this event_name\n\t\tlet me = this;\n\t\tdoctype = doctype || this.frm.doctype;\n\t\tname = name || this.frm.docname;\n\n\t\tlet tasks = [];\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\n\t\t// helper for child table\n\t\tthis.frm.selected_doc = frappe.get_doc(doctype, name);\n\n\t\tlet runner = (_function, is_old_style) => {\n\t\t\tlet _promise = null;\n\t\t\tif(is_old_style) {\n\t\t\t\t// old style arguments (doc, cdt, cdn)\n\t\t\t\t_promise = me.frm.cscript[_function](me.frm.doc, doctype, name);\n\t\t\t} else {\n\t\t\t\t// new style (frm, doctype, name)\n\t\t\t\t_promise = _function(me.frm, doctype, name);\n\t\t\t}\n\n\t\t\t// if the trigger returns a promise, return it,\n\t\t\t// or use the default promise frappe.after_ajax\n\t\t\tif (_promise && _promise.then) {\n\t\t\t\treturn _promise;\n\t\t\t} else {\n\t\t\t\treturn frappe.after_server_call();\n\t\t\t}\n\t\t};\n\n\t\t// make list of functions to be run serially\n\t\thandlers.new_style.forEach((_function) => {\n\t\t\tif(event_name==='setup') {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, false);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, false));\n\t\t\t}\n\t\t});\n\n\t\thandlers.old_style.forEach((_function) => {\n\t\t\tif(event_name==='setup') {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, true);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, true));\n\t\t\t}\n\t\t});\n\n\t\t// run them serially\n\t\treturn frappe.run_serially(tasks);\n\t},\n\thas_handlers: function(event_name, doctype) {\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\t\treturn handlers && (handlers.old_style.length || handlers.new_style.length);\n\t},\n\tget_handlers: function(event_name, doctype) {\n\t\t// returns list of all functions to be called (old style and new style)\n\t\tlet me = this;\n\t\tlet handlers = {\n\t\t\told_style: [],\n\t\t\tnew_style: []\n\t\t};\n\t\tif(frappe.ui.form.handlers[doctype] && frappe.ui.form.handlers[doctype][event_name]) {\n\t\t\t$.each(frappe.ui.form.handlers[doctype][event_name], function(i, fn) {\n\t\t\t\thandlers.new_style.push(fn);\n\t\t\t});\n\t\t}\n\t\tif(this.frm.cscript[event_name]) {\n\t\t\thandlers.old_style.push(event_name);\n\t\t}\n\t\tif(this.frm.cscript[\"custom_\" + event_name]) {\n\t\t\thandlers.old_style.push(\"custom_\" + event_name);\n\t\t}\n\t\treturn handlers;\n\t},\n\tsetup: function() {\n\t\tvar doctype = this.frm.meta;\n\t\tvar me = this;\n\n\t\t// js\n\t\tvar cs = doctype.__js;\n\t\tif(cs) {\n\t\t\tvar tmp = eval(cs);\n\t\t}\n\n\t\tif(doctype.__custom_js) {\n\t\t\ttry {\n\t\t\t\teval(doctype.__custom_js);\n\t\t\t} catch(e) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Error in Custom Script'),\n\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\tmessage: '<pre class=\"small\"><code>' + e.stack  + '</code></pre>'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction setup_add_fetch(df) {\n\t\t\tif((['Data', 'Read Only', 'Text', 'Small Text', 'Currency',\n\t\t\t\t'Text Editor', 'Code', 'Link', 'Float', 'Int', 'Date'].includes(df.fieldtype) || df.read_only==1)\n\t\t\t\t&& df.fetch_from && df.fetch_from.indexOf(\".\")!=-1) {\n\t\t\t\tvar parts = df.fetch_from.split(\".\");\n\t\t\t\tme.frm.add_fetch(parts[0], parts[1], df.fieldname);\n\t\t\t}\n\t\t}\n\n\t\t// setup add fetch\n\t\t$.each(this.frm.fields, function(i, field) {\n\t\t\tsetup_add_fetch(field.df);\n\t\t\tif(field.df.fieldtype===\"Table\") {\n\t\t\t\t$.each(frappe.meta.get_docfields(field.df.options, me.frm.docname), function(i, df) {\n\t\t\t\t\tsetup_add_fetch(df);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// css\n\t\tdoctype.__css && frappe.dom.set_style(doctype.__css);\n\n\t\tthis.trigger('setup');\n\t},\n\tlog_error: function(caller, e) {\n\t\tfrappe.show_alert(\"Error in Client Script.\");\n\t\tconsole.group && console.group();\n\t\tconsole.log(\"----- error in client script -----\");\n\t\tconsole.log(\"method: \" + caller);\n\t\tconsole.log(e);\n\t\tconsole.log(\"error message: \" + e.message);\n\t\tconsole.trace && console.trace();\n\t\tconsole.log(\"----- end of error message -----\");\n\t\tconsole.group && console.groupEnd();\n\t},\n\tcopy_from_first_row: function(parentfield, current_row, fieldnames) {\n\t\tvar data = this.frm.doc[parentfield];\n\t\tif(data.length===1 || data[0]===current_row) return;\n\n\t\tif(typeof fieldnames==='string') {\n\t\t\tfieldnames = [fieldnames];\n\t\t}\n\n\t\t$.each(fieldnames, function(i, fieldname) {\n\t\t\tfrappe.model.set_value(current_row.doctype, current_row.name, fieldname,\n\t\t\t\tdata[0][fieldname]);\n\t\t});\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.LinkedWith = class LinkedWith {\n\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\tshow() {\n\t\tif(!this.dialog)\n\t\t\tthis.make_dialog();\n\n\t\t$(this.dialog.body).html(\n\t\t\t`<div class=\"text-muted text-center\" style=\"padding: 30px 0px\">\n\t\t\t\t${__(\"Loading\")}...\n\t\t\t</div>`);\n\n\t\tthis.dialog.show();\n\t}\n\n\tmake_dialog() {\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\thide_on_page_refresh: true,\n\t\t\ttitle: __(\"Linked With\")\n\t\t});\n\n\t\tthis.dialog.on_page_show = () => {\n\t\t\t// execute ajax calls sequentially\n\t\t\t// 1. get linked doctypes\n\t\t\t// 2. load all doctypes\n\t\t\t// 3. load linked docs\n\t\t\tthis.get_linked_doctypes()\n\t\t\t\t.then(() => this.load_doctypes())\n\t\t\t\t.then(() => this.links_not_permitted_or_missing())\n\t\t\t\t.then(() => this.get_linked_docs())\n\t\t\t\t.then(() => this.make_html());\n\t\t};\n\t}\n\n\tmake_html() {\n\t\tconst linked_docs = this.frm.__linked_docs;\n\n\t\tlet html = '';\n\n\t\tconst linked_doctypes = Object.keys(linked_docs);\n\n\t\tif (linked_doctypes.length === 0) {\n\t\t\thtml = __(\"Not Linked to any record\");\n\t\t} else {\n\t\t\thtml = linked_doctypes.map(doctype => {\n\t\t\t\tconst docs = linked_docs[doctype];\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"list-item-table margin-bottom\">\n\t\t\t\t\t\t${this.make_doc_head(doctype)}\n\t\t\t\t\t\t${docs.map(doc => this.make_doc_row(doc, doctype)).join('')}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}).join('');\n\t\t}\n\n\t\t$(this.dialog.body).html(html);\n\t}\n\n\tload_doctypes() {\n\t\tconst already_loaded = Object.keys(locals.DocType);\n\t\tlet doctypes_to_load = [];\n\n\t\tif (this.frm.__linked_doctypes) {\n\t\t\tdoctypes_to_load =\n\t\t\t\tObject.keys(this.frm.__linked_doctypes)\n\t\t\t\t\t.filter(doctype => !already_loaded.includes(doctype));\n\t\t}\n\n\t\t// load all doctypes asynchronously using with_doctype\n\t\tconst promises = doctypes_to_load.map(dt => {\n\t\t\treturn frappe.model.with_doctype(dt, () => {\n\t\t\t\tif(frappe.listview_settings[dt]) {\n\t\t\t\t\t// add additional fields to __linked_doctypes\n\t\t\t\t\tthis.frm.__linked_doctypes[dt].add_fields =\n\t\t\t\t\t\tfrappe.listview_settings[dt].add_fields;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn Promise.all(promises);\n\t}\n\n\tlinks_not_permitted_or_missing() {\n\t\tlet links = null;\n\n\t\tif (this.frm.__linked_doctypes) {\n\t\t\tlinks =\n\t\t\t\tObject.keys(this.frm.__linked_doctypes)\n\t\t\t\t\t.filter(frappe.model.can_get_report);\n\t\t}\n\n\t\tlet flag;\n\t\tif(!links) {\n\t\t\t$(this.dialog.body).html(`${this.frm.__linked_doctypes\n\t\t\t\t? __(\"Not enough permission to see links\")\n\t\t\t\t: __(\"Not Linked to any record\")}`);\n\t\t\tflag = true;\n\t\t}\n\t\tflag = false;\n\n\t\t// reject Promise if not_permitted or missing\n\t\treturn new Promise(\n\t\t\t(resolve, reject) => flag ? reject() : resolve()\n\t\t);\n\t}\n\n\tget_linked_doctypes() {\n\t\treturn new Promise((resolve) => {\n\t\t\tif (this.frm.__linked_doctypes) {\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.form.linked_with.get_linked_doctypes\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.frm.doctype\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tthis.frm.__linked_doctypes = r.message;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget_linked_docs() {\n\t\treturn frappe.call({\n\t\t\tmethod: \"frappe.desk.form.linked_with.get_linked_docs\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname,\n\t\t\t\tlinkinfo: this.frm.__linked_doctypes,\n\t\t\t\tfor_doctype: this.for_doctype\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tthis.frm.__linked_docs = r.message || {};\n\t\t\t}\n\t\t});\n\t}\n\n\tmake_doc_head(heading) {\n\t\treturn `\n\t\t\t<header class=\"level list-row list-row-head text-muted small\">\n\t\t\t\t<div>${__(heading)}</div>\n\t\t\t</header>\n\t\t`;\n\t}\n\n\tmake_doc_row(doc, doctype) {\n\t\treturn `<div class=\"list-row-container\">\n\t\t\t<div class=\"level list-row small\">\n\t\t\t\t<div class=\"level-left bold\">\n\t\t\t\t\t<a href=\"#Form/${doctype}/${doc.name}\">${doc.name}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.States = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.frm.doctype);\n\n\t\t// no workflow?\n\t\tif(!this.state_fieldname)\n\t\t\treturn;\n\n\t\tthis.update_fields = frappe.workflow.get_update_fields(this.frm.doctype);\n\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).bind(\"render_complete\", function() {\n\t\t\tme.refresh();\n\t\t});\n\t},\n\n\tsetup_help: function() {\n\t\tvar me = this;\n\t\tthis.frm.page.add_action_item(__(\"Help\"), function() {\n\t\t\tfrappe.workflow.setup(me.frm.doctype);\n\t\t\tvar state = me.get_state();\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: \"Workflow: \"\n\t\t\t\t\t+ frappe.workflow.workflows[me.frm.doctype].name\n\t\t\t});\n\n\t\t\tfrappe.workflow.get_transitions(me.frm.doc).then((transitions) => {\n\t\t\t\tvar next_html = $.map(transitions,\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\treturn d.action.bold() + __(\" by Role \") + d.allowed;\n\t\t\t\t\t}).join(\", \") || __(\"None: End of Workflow\").bold();\n\n\t\t\t\t$(d.body).html(\"<p>\"+__(\"Current status\")+\": \" + state.bold() + \"</p>\"\n\t\t\t\t\t+ \"<p>\"+__(\"Document is only editable by users of role\")+\": \"\n\t\t\t\t\t\t+ frappe.workflow.get_document_state(me.frm.doctype,\n\t\t\t\t\t\t\tstate).allow_edit.bold() + \"</p>\"\n\t\t\t\t\t+ \"<p>\"+__(\"Next actions\")+\": \"+ next_html +\"</p>\"\n\t\t\t\t\t+ (me.frm.doc.__islocal ? (\"<div class='alert alert-info'>\"\n\t\t\t\t\t\t+__(\"Workflow will start after saving.\")+\"</div>\") : \"\")\n\t\t\t\t\t+ \"<p class='help'>\"+__(\"Note: Other permission rules may also apply\")+\"</p>\"\n\t\t\t\t).css({padding: '15px'});\n\t\t\t\td.show();\n\t\t\t});\n\t\t}, true);\n\t},\n\n\trefresh: function() {\n\t\tconst me = this;\n\t\t// hide if its not yet saved\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.set_default_state();\n\t\t\treturn;\n\t\t}\n\n\t\t// state text\n\t\tconst state = this.get_state();\n\n\t\tlet doctype = this.frm.doctype;\n\n\t\tif(state) {\n\t\t\t// show actions from that state\n\t\t\tthis.show_actions(state);\n\t\t}\n\t},\n\n\tshow_actions: function() {\n\t\tvar added = false,\n\t\t\tme = this;\n\n\t\tthis.frm.page.clear_actions_menu();\n\n\t\t// if the loaded doc is dirty, don't show workflow buttons\n\t\tif (this.frm.doc.__unsaved===1) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction has_approval_access(transition) {\n\t\t\tlet approval_access = false;\n\t\t\tconst user = frappe.session.user;\n\t\t\tif (user === 'Administrator'\n\t\t\t\t|| transition.allow_self_approval\n\t\t\t\t|| user !== me.frm.doc.owner) {\n\t\t\t\tapproval_access = true;\n\t\t\t}\n\t\t\treturn approval_access;\n\t\t}\n\n\t\tfrappe.workflow.get_transitions(this.frm.doc).then(transitions => {\n\t\t\t$.each(transitions, function(i, d) {\n\t\t\t\tif(frappe.user_roles.includes(d.allowed) && has_approval_access(d)) {\n\t\t\t\t\tadded = true;\n\t\t\t\t\tme.frm.page.add_action_item(__(d.action), function() {\n\t\t\t\t\t\tfrappe.xcall('frappe.model.workflow.apply_workflow',\n\t\t\t\t\t\t\t{doc: me.frm.doc, action: d.action})\n\t\t\t\t\t\t\t.then((doc) => {\n\t\t\t\t\t\t\t\tfrappe.model.sync(doc);\n\t\t\t\t\t\t\t\tme.frm.refresh();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tif(added) {\n\t\t\tthis.frm.page.btn_primary.addClass(\"hide\");\n\t\t\tthis.frm.toolbar.current_status = \"\";\n\t\t\tthis.setup_help();\n\t\t}\n\t},\n\n\tset_default_state: function() {\n\t\tvar default_state = frappe.workflow.get_default_state(this.frm.doctype, this.frm.doc.docstatus);\n\t\tif(default_state) {\n\t\t\tthis.frm.set_value(this.state_fieldname, default_state);\n\t\t}\n\t},\n\n\tget_state: function() {\n\t\tif(!this.frm.doc[this.state_fieldname]) {\n\t\t\tthis.set_default_state();\n\t\t}\n\t\treturn this.frm.doc[this.state_fieldname];\n\t}\n});\n","frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.PrintPreview = Class.extend({\n\tinit: function (opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.bind_events();\n\t},\n\tmake: function () {\n\t\tthis.wrapper = this.frm.page.add_view(\"print\", frappe.render_template(\"print_layout\", {}));\n\n\t\t// only system manager can edit\n\t\tthis.wrapper.find(\".btn-print-edit\").toggle(frappe.user.has_role(\"System Manager\"));\n\t},\n\tbind_events: function () {\n\t\tvar me = this;\n\t\tthis.wrapper.find(\".btn-print-close\").click(function () {\n\t\t\tme.frm.hide_print();\n\t\t});\n\n\t\t// hide print view on pressing escape, only if there is no focus on any input\n\t\t$(document).on(\"keydown\", function (e) {\n\t\t\tif (e.which === 27 && me.frm && e.target === document.body) {\n\t\t\t\tme.frm.hide_print();\n\t\t\t}\n\t\t});\n\n\t\tthis.print_formats = frappe.meta.get_print_formats(this.frm.meta.name);\n\t\tthis.print_letterhead = this.wrapper\n\t\t\t.find(\".print-letterhead\")\n\t\t\t.on(\"change\", function () { me.print_sel.trigger(\"change\"); })\n\t\t\t.prop(\"checked\", cint(\n\t\t\t\t(frappe.model.get_doc(\":Print Settings\", \"Print Settings\")\n\t\t\t\t\t|| { with_letterhead: 1 }).with_letterhead) ? true : false);\n\t\tthis.print_sel = this.wrapper\n\t\t\t.find(\".print-preview-select\")\n\t\t\t.on(\"change\", function () {\n\t\t\t\tme.set_default_print_language();\n\t\t\t\tme.multilingual_preview();\n\t\t\t});\n\n\t\t//On selection of language get code and pass it to preview method\n\t\tthis.language_sel = this.wrapper\n\t\t\t.find(\".languages\")\n\t\t\t.on(\"change\", function () {\n\t\t\t\tme.lang_code = me.language_sel.val()\n\t\t\t\tme.multilingual_preview()\n\t\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-print\").click(function () {\n\t\t\tif (me.is_old_style()) {\n\t\t\t\tme.print_old_style();\n\t\t\t} else {\n\t\t\t\tme.printit();\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-preview\").click(function () {\n\t\t\tif (me.is_old_style()) {\n\t\t\t\tme.new_page_preview_old_style();\n\t\t\t} else {\n\t\t\t\tme.new_page_preview();\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-download-pdf\").click(function () {\n\t\t\tif (!me.is_old_style()) {\n\t\t\t\tvar w = window.open(\n\t\t\t\t\tfrappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n\t\t\t\t\t\t+ \"doctype=\" + encodeURIComponent(me.frm.doc.doctype)\n\t\t\t\t\t\t+ \"&name=\" + encodeURIComponent(me.frm.doc.name)\n\t\t\t\t\t\t+ \"&format=\" + me.selected_format()\n\t\t\t\t\t\t+ \"&no_letterhead=\" + (me.with_letterhead() ? \"0\" : \"1\")\n\t\t\t\t\t\t+ (me.lang_code ? (\"&_lang=\" + me.lang_code) : \"\"))\n\t\t\t\t);\n\t\t\t\tif (!w) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please enable pop-ups\")); return;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-edit\").on(\"click\", function () {\n\t\t\tlet print_format = me.get_print_format();\n\t\t\tif (print_format && print_format.name) {\n\t\t\t\tif (print_format.print_format_builder) {\n\t\t\t\t\tfrappe.set_route(\"print-format-builder\", print_format.name);\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.set_route(\"Form\", \"Print Format\", print_format.name);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// start a new print format\n\t\t\t\tfrappe.prompt({\n\t\t\t\t\tfieldname: \"print_format_name\", fieldtype: \"Data\", reqd: 1,\n\t\t\t\t\tlabel: \"New Print Format Name\"\n\t\t\t\t}, function (data) {\n\t\t\t\t\tfrappe.route_options = {\n\t\t\t\t\t\tmake_new: true,\n\t\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\t\tname: data.print_format_name\n\t\t\t\t\t};\n\t\t\t\t\tfrappe.set_route(\"print-format-builder\");\n\t\t\t\t}, __(\"New Custom Print Format\"), __(\"Start\"));\n\t\t\t}\n\t\t});\n\t},\n\tset_user_lang: function () {\n\t\tthis.lang_code = this.frm.doc.language;\n\t\t// Load all languages in the field\n\t\tthis.language_sel.empty()\n\t\t\t.add_options([{value:'', label:__(\"Select Language...\")}]\n\t\t\t\t.concat(frappe.get_languages()))\n\t\t\t.val(this.lang_code);\n\t\tthis.preview();\n\t},\n\tset_default_print_language: function () {\n \t\tvar print_format = this.get_print_format();\n\n \t\tif (print_format.default_print_language) {\n \t\t\tthis.lang_code = print_format.default_print_language;\n \t\t\tthis.language_sel.val(this.lang_code);\n \t\t} else {\n\t\t\tthis.language_sel.val(frappe.boot.lang);\n\t\t}\n \t},\n\tmultilingual_preview: function () {\n\t\tvar me = this;\n\t\tif (this.is_old_style()) {\n\t\t\tme.wrapper.find(\".btn-download-pdf\").toggle(false);\n\t\t\tme.set_style();\n\t\t\tme.preview_old_style();\n\t\t} else {\n\t\t\tme.wrapper.find(\".btn-download-pdf\").toggle(true);\n\t\t\tme.preview();\n\t\t}\n\t},\n\tpreview: function () {\n\t\tvar me = this;\n\t\tthis.get_print_html(function (out) {\n\t\t\tme.wrapper.find(\".print-format\").html(out.html);\n\t\t\tme.show_footer();\n\t\t\tme.set_style(out.style);\n\t\t});\n\t},\n\tshow_footer: function() {\n\t\t// footer is hidden by default as reqd by pdf generation\n\t\t// simple hack to show it in print preview\n\t\tthis.wrapper.find('.page-break').css({\n\t\t\t'display': 'flex',\n\t\t\t'flex-direction': 'column'\n\t\t});\n\t\tthis.wrapper.find('#footer-html').attr('style', `\n\t\t\tdisplay: block !important;\n\t\t\torder: 1;\n\t\t\tmargin-top: 20px;\n\t\t`);\n\t},\n\tprintit: function () {\n\t\tlet print_server ;\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.printing.doctype.print_settings.print_settings.is_print_server_enabled\",\n\t\t\tcallback: function (data) {\n\t\t\t\tif (data.message) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\"method\": \"frappe.utils.print_format.print_by_server\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\t\tprint_format:  me.selected_format(),\n\t\t\t\t\t\t\tno_letterhead: me.with_letterhead()\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function (data) {\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tme.new_page_preview(true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tnew_page_preview: function (printit) {\n\t\tvar me = this;\n\t\tvar w = window.open(frappe.urllib.get_full_url(\"/printview?\"\n\t\t\t+ \"doctype=\" + encodeURIComponent(me.frm.doc.doctype)\n\t\t\t+ \"&name=\" + encodeURIComponent(me.frm.doc.name)\n\t\t\t+ (printit ? \"&trigger_print=1\" : \"\")\n\t\t\t+ \"&format=\" + me.selected_format()\n\t\t\t+ \"&no_letterhead=\" + (me.with_letterhead() ? \"0\" : \"1\")\n\t\t\t+ (me.lang_code ? (\"&_lang=\" + me.lang_code) : \"\")));\n\t\tif (!w) {\n\t\t\tfrappe.msgprint(__(\"Please enable pop-ups\")); return;\n\t\t}\n\t},\n\tget_print_html: function (callback) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.www.printview.get_html_and_style\",\n\t\t\targs: {\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tprint_format: this.selected_format(),\n\t\t\t\tno_letterhead: !this.with_letterhead() ? 1 : 0,\n\t\t\t\t_lang: this.lang_code\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tcallback(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tpreview_old_style: function () {\n\t\tvar me = this;\n\t\tthis.with_old_style({\n\t\t\tformat: me.print_sel.val(),\n\t\t\tcallback: function (html) {\n\t\t\t\tme.wrapper.find(\".print-format\").html('<div class=\"alert alert-warning\">'\n\t\t\t\t\t+ __(\"Warning: This Print Format is in old style and cannot be generated via the API.\")\n\t\t\t\t\t+ '</div>'\n\t\t\t\t\t+ html);\n\t\t\t},\n\t\t\tno_letterhead: !this.with_letterhead(),\n\t\t\tonly_body: true,\n\t\t\tno_heading: true\n\t\t});\n\t},\n\trefresh_print_options: function () {\n\t\tthis.print_formats = frappe.meta.get_print_formats(this.frm.doctype);\n\t\treturn this.print_sel\n\t\t\t.empty().add_options(this.print_formats);\n\n\t},\n\twith_old_style: function (opts) {\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(opts.format, opts.callback, opts.no_letterhead, opts.only_body, opts.no_heading);\n\t\t});\n\t},\n\tprint_old_style: function () {\n\t\tvar me = this;\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(me.print_sel.val(), _p.go,\n\t\t\t\t!me.with_letterhead());\n\t\t});\n\t},\n\tnew_page_preview_old_style: function () {\n\t\tvar me = this;\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(me.print_sel.val(), _p.preview, !me.with_letterhead());\n\t\t});\n\t},\n\tselected_format: function () {\n\t\treturn this.print_sel.val() || this.frm.meta.default_print_format || \"Standard\";\n\t},\n\tis_old_style: function (format) {\n\t\treturn this.get_print_format(format).print_format_type === \"Client\";\n\t},\n\tget_print_format: function (format) {\n\t\tif (!format) {\n\t\t\tformat = this.selected_format();\n\t\t}\n\n\t\tif (locals[\"Print Format\"] && locals[\"Print Format\"][format]) {\n\t\t\treturn locals[\"Print Format\"][format]\n\t\t} else {\n\t\t\treturn {}\n\t\t}\n\t},\n\twith_letterhead: function () {\n\t\treturn this.print_letterhead.is(\":checked\") ? 1 : 0;\n\t},\n\tset_style: function (style) {\n\t\tfrappe.dom.set_style(style || frappe.boot.print_css, \"print-style\");\n\t}\n});\n\nfrappe.ui.get_print_settings = function (pdf, callback, letter_head) {\n\tvar print_settings = locals[\":Print Settings\"][\"Print Settings\"];\n\n\tvar default_letter_head = locals[\":Company\"] && frappe.defaults.get_default('company')\n\t\t? locals[\":Company\"][frappe.defaults.get_default('company')][\"default_letter_head\"]\n\t\t: '';\n\n\tvar columns = [{\n\t\tfieldtype: \"Check\",\n\t\tfieldname: \"with_letter_head\",\n\t\tlabel: __(\"With Letter head\")\n\t}, {\n\t\tfieldtype: \"Select\",\n\t\tfieldname: \"letter_head\",\n\t\tlabel: __(\"Letter Head\"),\n\t\tdepends_on: \"with_letter_head\",\n\t\toptions: $.map(frappe.boot.letter_heads, function (i, d) { return d }),\n\t\tdefault: letter_head || default_letter_head\n\t}, {\n\t\tfieldtype: \"Select\",\n\t\tfieldname: \"orientation\",\n\t\tlabel: __(\"Orientation\"),\n\t\toptions: \"Landscape\\nPortrait\",\n\t\tdefault: \"Landscape\"\n\t}];\n\n\tfrappe.prompt(columns, function (data) {\n\t\tvar data = $.extend(print_settings, data);\n\t\tif (!data.with_letter_head) {\n\t\t\tdata.letter_head = null;\n\t\t}\n\t\tif (data.letter_head) {\n\t\t\tdata.letter_head = frappe.boot.letter_heads[print_settings.letter_head];\n\t\t}\n\t\tcallback(data);\n\t}, __(\"Print Settings\"));\n}\n","frappe.provide(\"frappe.ui.form\");\nfrappe.ui.form.Sidebar = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\n\tmake: function() {\n\t\tvar sidebar_content = frappe.render_template(\"form_sidebar\", {doctype: this.frm.doctype, frm:this.frm});\n\n\t\tthis.sidebar = $('<div class=\"form-sidebar overlay-sidebar hidden-xs hidden-sm\"></div>')\n\t\t\t.html(sidebar_content)\n\t\t\t.appendTo(this.page.sidebar.empty());\n\n\t\tthis.ratings = this.sidebar.find(\".sidebar-rating\");\n\t\tthis.comments = this.sidebar.find(\".sidebar-comments\");\n\t\tthis.user_actions = this.sidebar.find(\".user-actions\");\n\t\tthis.image_section = this.sidebar.find(\".sidebar-image-section\");\n\t\tthis.image_wrapper = this.image_section.find('.sidebar-image-wrapper');\n\n\t\tthis.make_assignments();\n\t\tthis.make_attachments();\n\t\tthis.make_shared();\n\t\tthis.make_viewers();\n\t\tthis.make_tags();\n\t\tthis.make_like();\n\n\t\tthis.bind_events();\n\t\tfrappe.ui.form.setup_user_image_event(this.frm);\n\n\t\tthis.refresh();\n\n\t},\n\n\tbind_events: function() {\n\t\tvar me = this;\n\n\t\t// scroll to comments\n\t\tthis.comments.on(\"click\", function() {\n\t\t\tfrappe.utils.scroll_to(me.frm.footer.wrapper.find(\".form-comments\"), true);\n\t\t});\n\n\t\tthis.like_icon.on(\"click\", function() {\n\t\t\tfrappe.ui.toggle_like(me.like_icon, me.frm.doctype, me.frm.doc.name, function() {\n\t\t\t\tme.refresh_like();\n\t\t\t});\n\t\t})\n\t},\n\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.sidebar.toggle(false);\n\t\t} else {\n\t\t\tthis.sidebar.toggle(true);\n\t\t\tthis.frm.assign_to.refresh();\n\t\t\tthis.frm.attachments.refresh();\n\t\t\tthis.frm.shared.refresh();\n\t\t\tthis.frm.viewers.refresh();\n\t\t\tthis.frm.tags && this.frm.tags.refresh(this.frm.doc._user_tags);\n\t\t\tthis.sidebar.find(\".modified-by\").html(__(\"{0} edited this {1}\",\n\t\t\t\t[\"<strong>\" + frappe.user.full_name(this.frm.doc.modified_by) + \"</strong>\",\n\t\t\t\t\t\"<br>\" + comment_when(this.frm.doc.modified)]));\n\t\t\tthis.sidebar.find(\".created-by\").html(__(\"{0} created this {1}\",\n\t\t\t\t[\"<strong>\" + frappe.user.full_name(this.frm.doc.owner) + \"</strong>\",\n\t\t\t\t\t\"<br>\" + comment_when(this.frm.doc.creation)]));\n\n\t\t\tthis.refresh_like();\n\t\t\tthis.setup_ratings();\n\t\t\tfrappe.ui.form.set_user_image(this.frm);\n\t\t}\n\t},\n\n\trefresh_comments: function() {\n\t\t$.map(this.frm.timeline.get_communications(), function(c) {\n\t\t\treturn (c.communication_type===\"Communication\" || (c.communication_type==\"Comment\" && c.comment_type===\"Comment\")) ? c : null;\n\t\t});\n\t\tthis.comments.find(\".n-comments\").html(this.frm.get_docinfo().total_comments);\n\t},\n\n\tmake_tags: function() {\n\t\tvar me = this;\n\t\tif (this.frm.meta.issingle) {\n\t\t\tthis.sidebar.find(\".form-tags\").toggle(false);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.frm.tags = new frappe.ui.TagEditor({\n\t\t\tparent: this.sidebar.find(\".tag-area\"),\n\t\t\tfrm: this.frm,\n\t\t\ton_change: function(user_tags) {\n\t\t\t\tme.frm.doc._user_tags = user_tags;\n\t\t\t}\n\t\t});\n\t},\n\tmake_attachments: function() {\n\t\tvar me = this;\n\t\tthis.frm.attachments = new frappe.ui.form.Attachments({\n\t\t\tparent: me.sidebar.find(\".form-attachments\"),\n\t\t\tfrm: me.frm\n\t\t});\n\t},\n\tmake_assignments: function() {\n\t\tthis.frm.assign_to = new frappe.ui.form.AssignTo({\n\t\t\tparent: this.sidebar.find(\".form-assignments\"),\n\t\t\tfrm: this.frm\n\t\t});\n\t},\n\tmake_shared: function() {\n\t\tthis.frm.shared = new frappe.ui.form.Share({\n\t\t\tfrm: this.frm,\n\t\t\tparent: this.sidebar.find(\".form-shared\")\n\t\t});\n\t},\n\tmake_viewers: function() {\n\t\tthis.frm.viewers = new frappe.ui.form.Viewers({\n\t\t\tfrm: this.frm,\n\t\t\tparent: this.sidebar.find(\".form-viewers\")\n\t\t});\n\t},\n\tadd_user_action: function(label, click) {\n\t\treturn $('<a>').html(label).appendTo($('<li class=\"user-action-row\">')\n\t\t\t.appendTo(this.user_actions.removeClass(\"hidden\"))).on(\"click\", click);\n\t},\n\tclear_user_actions: function() {\n\t\tthis.user_actions.addClass(\"hidden\")\n\t\tthis.user_actions.find(\".user-action-row\").remove();\n\t},\n\n\tmake_like: function() {\n\t\tthis.like_wrapper = this.sidebar.find(\".liked-by\");\n\t\tthis.like_icon = this.sidebar.find(\".liked-by .octicon-heart\");\n\t\tthis.like_count = this.sidebar.find(\".liked-by .likes-count\");\n\t\tfrappe.ui.setup_like_popover(this.sidebar.find(\".liked-by-parent\"), \".liked-by\");\n\t},\n\n\trefresh_like: function() {\n\t\tif (!this.like_icon) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.like_wrapper.attr(\"data-liked-by\", this.frm.doc._liked_by);\n\n\t\tthis.like_icon.toggleClass(\"text-extra-muted not-liked\",\n\t\t\t!frappe.ui.is_liked(this.frm.doc))\n\t\t\t.attr(\"data-doctype\", this.frm.doctype)\n\t\t\t.attr(\"data-name\", this.frm.doc.name);\n\n\t\tthis.like_count.text(JSON.parse(this.frm.doc._liked_by || \"[]\").length);\n\t},\n\n\trefresh_image: function() {\n\t},\n\n\tsetup_ratings: function() {\n\t\tvar _ratings = this.frm.get_docinfo().rating || 0;\n\n\t\tif(_ratings) {\n\t\t\tthis.ratings.removeClass(\"hide\");\n\t\t\tvar rating_icons = frappe.render_template(\"rating_icons\", {rating: _ratings, show_label: false});\n\t\t\tthis.ratings.find(\".rating-icons\").html(rating_icons);\n\t\t}\n\t}\n});\n","frappe.ui.form.set_user_image = function(frm) {\n\n\tvar image_section = frm.sidebar.image_section;\n\tvar image_field = frm.meta.image_field;\n\tvar image = frm.doc[image_field];\n\tvar title_image = frm.page.$title_area.find('.title-image');\n\n\n\timage_section.toggleClass('hide', image_field ? false : true);\n\ttitle_image.toggleClass('hide', image_field ? false : true);\n\n\tif(!image_field) {\n\t\treturn;\n\t}\n\n\t// if image field has value\n\tif (image) {\n\t\timage = (window.cordova && image.indexOf('http')===-1) ?\n\t\t\tfrappe.base_url + image : image;\n\n\t\timage_section\n\t\t\t.find(\".sidebar-image\")\n\t\t\t.css(\"background-image\", 'url(\"' + image + '\")')\n\t\t\t.removeClass(\"hide\");\n\n\t\timage_section\n\t\t\t.find('.sidebar-standard-image')\n\t\t\t.addClass('hide');\n\n\t\ttitle_image\n\t\t\t.css('background-color', '')\n\t\t\t.css(\"background-image\", 'url(\"' + image + '\")')\n\t\t\t.html('');\n\n\t} else {\n\t\timage_section\n\t\t\t.find(\".sidebar-image\")\n\t\t\t.css(\"background-image\", null)\n\t\t\t.addClass(\"hide\");\n\n\t\tvar title = frm.get_title();\n\n\t\timage_section\n\t\t\t.find('.sidebar-standard-image')\n\t\t\t.removeClass('hide')\n\t\t\t.find('.standard-image')\n\t\t\t.css({'background-color': frappe.get_palette(title)})\n\t\t\t.html(frappe.get_abbr(title));\n\n\t\ttitle_image.css(\"background-image\", '')\n\t\t\t.css({'background-color': frappe.get_palette(title)})\n\t\t\t.html(frappe.get_abbr(title));\n\n\t}\n\n}\n\nfrappe.ui.form.setup_user_image_event = function(frm) {\n\t// re-draw image on change of user image\n\tif(frm.meta.image_field) {\n\t\tfrappe.ui.form.on(frm.doctype, frm.meta.image_field, function(frm) {\n\t\t\tfrappe.ui.form.set_user_image(frm);\n\t\t});\n\t}\n\n\t// bind click on image_wrapper\n\tfrm.sidebar.image_wrapper.on('click', function() {\n\t\tvar field = frm.get_field(frm.meta.image_field);\n\t\tif(!field.$input) {\n\t\t\tfield.make_input();\n\t\t}\n\t\tfield.$input.trigger('click');\n\t});\n}","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Share = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\trefresh: function() {\n\t\tthis.render_sidebar();\n\t},\n\trender_sidebar: function() {\n\t\tvar me = this;\n\t\tthis.parent.empty();\n\n\t\tvar shared = this.shared || this.frm.get_docinfo().shared;\n\t\tshared = shared.filter(function(d) { return d });\n\t\tvar users = [];\n\t\tfor (var i=0, l=shared.length; i < l; i++) {\n\t\t\tvar s = shared[i];\n\n\t\t\tif (s.everyone) {\n\t\t\t\tusers.push({\n\t\t\t\t\ticon: \"octicon octicon-megaphone text-muted\",\n\t\t\t\t\tavatar_class: \"avatar-empty share-doc-btn shared-with-everyone\",\n\t\t\t\t\ttitle: __(\"Shared with everyone\")\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvar user_info = frappe.user_info(s.user);\n\t\t\t\tusers.push({\n\t\t\t\t\timage: user_info.image,\n\t\t\t\t\tfullname: user_info.fullname,\n\t\t\t\t\tabbr: user_info.abbr,\n\t\t\t\t\tcolor: user_info.color,\n\t\t\t\t\ttitle: __(\"Shared with {0}\", [user_info.fullname])\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!me.frm.doc.__islocal) {\n\t\t\tusers.push({\n\t\t\t\ticon: \"octicon octicon-plus text-muted\",\n\t\t\t\tavatar_class: \"avatar-empty share-doc-btn\",\n\t\t\t\ttitle: __(\"Share\")\n\t\t\t});\n\t\t}\n\n\t\tthis.parent.append(frappe.render_template(\"users_in_sidebar\", {\"users\": users}));\n\t\tthis.parent.find(\".avatar\").on(\"click\", function() {\n\t\t\tme.frm.share_doc();\n\t\t});\n\t},\n\tshow: function() {\n\t\tvar me = this;\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Share {0} with\", [this.frm.doc.name]),\n\t\t});\n\n\t\tthis.dialog = d;\n\t\tthis.dirty = false;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.share.get_users\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.doc.name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.render_shared(r.message || []);\n\t\t\t}\n\t\t});\n\n\t\t$(d.body).html('<p class=\"text-muted\">' + __(\"Loading...\") + '</p>');\n\n\t\td.onhide = function() {\n\t\t\t// reload comments\n\t\t\tif(me.dirty) me.frm.reload_docinfo();\n\t\t}\n\n\t\td.show();\n\t},\n\trender_shared: function(shared) {\n\t\tif(shared)\n\t\t\tthis.shared = shared;\n\t\tvar d = this.dialog;\n\t\t$(d.body).empty();\n\n\t\tvar everyone = {};\n\t\t$.each(this.shared, function(i, s) {\n\t\t\t// pullout everyone record from shared list\n\t\t\tif (s && s.everyone) {\n\t\t\t\teveryone = s;\n\t\t\t}\n\t\t});\n\n\t\t$(frappe.render_template(\"set_sharing\", {frm: this.frm, shared: this.shared, everyone: everyone}))\n\t\t\t.appendTo(d.body);\n\n\t\tif(frappe.model.can_share(null, this.frm)) {\n\t\t\tthis.make_user_input();\n\t\t\tthis.add_share_button();\n\t\t\tthis.set_edit_share_events();\n\t\t} else {\n\t\t\t// if cannot share, disable sharing settings.\n\t\t\t$(d.body).find(\".edit-share\").prop(\"disabled\", true);\n\t\t}\n\t},\n\tmake_user_input: function() {\n\t\t// make add-user input\n\t\tthis.dialog.share_with = frappe.ui.form.make_control({\n\t\t\tparent: $(this.dialog.body).find(\".input-wrapper-add-share\"),\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: __(\"Share With\"),\n\t\t\t\tfieldname: \"share_with\",\n\t\t\t\toptions: \"User\",\n\t\t\t\tfilters: {\n\t\t\t\t\t\"user_type\": \"System User\",\n\t\t\t\t\t\"name\": [\"!=\", frappe.session.user]\n\t\t\t\t}\n\t\t\t},\n\t\t\tonly_input: true,\n\t\t\trender_input: true\n\t\t});\n\n\t},\n\tadd_share_button: function() {\n\t\tvar me = this, d = this.dialog;\n\t\t$(d.body).find(\".btn-add-share\").on(\"click\", function() {\n\t\t\tvar user = d.share_with.get_value();\n\t\t\tif(!user) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.share.add\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tuser: user,\n\t\t\t\t\tread: $(d.body).find(\".add-share-read\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\twrite: $(d.body).find(\".add-share-write\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tshare: $(d.body).find(\".add-share-share\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tnotify: $(d.body).find(\".add-share-notify\").prop(\"checked\") ? 1 : 0\n\t\t\t\t},\n\t\t\t\tbtn: this,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\t$.each(me.shared, function(i, s) {\n\t\t\t\t\t\tif(s && s.user===r.message.user) {\n\t\t\t\t\t\t\t// re-adding / remove the old share rule.\n\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tme.dirty = true;\n\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\tme.render_shared();\n\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\tset_edit_share_events: function() {\n\t\tvar me = this, d = this.dialog;\n\t\t$(d.body).find(\".edit-share\").on(\"click\", function() {\n\t\t\tvar user = $(this).parents(\".shared-user:first\").attr(\"data-user\") || \"\",\n\t\t\t\tvalue = $(this).prop(\"checked\") ? 1 : 0,\n\t\t\t\tproperty = $(this).attr(\"name\"),\n\t\t\t\teveryone = cint($(this).parents(\".shared-user:first\").attr(\"data-everyone\"));\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.share.set_permission\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tuser: user,\n\t\t\t\t\tpermission_to: property,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\teveryone: everyone\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tvar found = null;\n\t\t\t\t\t$.each(me.shared, function(i, s) {\n\t\t\t\t\t\t// update shared object\n\t\t\t\t\t\tif(s && (s.user===user || (everyone && s.everyone===1))) {\n\t\t\t\t\t\t\tif(!r.message) {\n\t\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.shared[i] = $.extend(s, r.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!found) {\n\t\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.dirty = true;\n\t\t\t\t\tme.render_shared();\n\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n});\n","frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Viewers = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\tget_viewers: function() {\n\t\tlet docinfo = this.frm.get_docinfo();\n\t\tif (docinfo) {\n\t\t\treturn docinfo.viewers || {};\n\t\t} else {\n\t\t\treturn {};\n\t\t}\n\t},\n\trefresh: function(data_updated) {\n\t\tthis.parent.empty();\n\n\t\tvar viewers = this.get_viewers();\n\n\t\tvar users = [];\n\t\tvar new_users = [];\n\t\tfor (var i=0, l=(viewers.current || []).length; i < l; i++) {\n\t\t\tvar username = viewers.current[i];\n\t\t\tif (username===frappe.session.user) {\n\t\t\t\t// current user\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar user_info = frappe.user_info(username);\n\t\t\tusers.push({\n\t\t\t\timage: user_info.image,\n\t\t\t\tfullname: user_info.fullname,\n\t\t\t\tabbr: user_info.abbr,\n\t\t\t\tcolor: user_info.color,\n\t\t\t\ttitle: __(\"{0} is currently viewing this document\", [user_info.fullname])\n\t\t\t});\n\n\t\t\tif (viewers.new.indexOf(username)!==-1) {\n\t\t\t\tnew_users.push(user_info.fullname);\n\t\t\t}\n\t\t}\n\n\t\tif (users.length) {\n\t\t\tthis.parent.parent().removeClass(\"hidden\");\n\t\t\tthis.parent.append(frappe.render_template(\"users_in_sidebar\", {\"users\": users}));\n\t\t} else {\n\t\t\tthis.parent.parent().addClass(\"hidden\");\n\t\t}\n\n\t\tif (data_updated && new_users.length) {\n\t\t\t// new user viewing this document, who wasn't viewing in the past\n\t\t\tif (new_users.length===1) {\n\t\t\t\tfrappe.show_alert(__(\"{0} is currently viewing this document\", [new_users[0]]));\n\t\t\t} else {\n\t\t\t\tfrappe.show_alert(__(\"{0} are currently viewing this document\", [frappe.utils.comma_and(new_users)]));\n\t\t\t}\n\n\t\t}\n\t}\n});\n\nfrappe.ui.form.set_viewers = function(data) {\n\tvar doctype = data.doctype;\n\tvar docname = data.docname;\n\tvar docinfo = frappe.model.get_docinfo(doctype, docname);\n\tvar past_viewers = ((docinfo && docinfo.viewers) || {}).past || [];\n\tvar viewers = data.viewers || [];\n\n\tvar new_viewers = viewers.filter(viewer => !past_viewers.includes(viewer));\n\n\tfrappe.model.set_docinfo(doctype, docname, \"viewers\", {\n\t\tpast: past_viewers.concat(new_viewers),\n\t\tnew: new_viewers,\n\t\tcurrent: viewers\n\t});\n\n\tif (cur_frm && cur_frm.doc && cur_frm.doc.doctype===doctype && cur_frm.doc.name==docname) {\n\t\tcur_frm.viewers.refresh(true);\n\t}\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Footer = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.make_comments();\n\t\t// render-complete\n\t\t$(this.frm.wrapper).on(\"render_complete\", function() {\n\t\t\tme.refresh();\n\t\t});\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\t\tthis.wrapper = $(frappe.render_template(\"form_footer\", {}))\n\t\t\t.appendTo(this.parent);\n\t\tthis.wrapper.find(\".btn-save\").click(function() {\n\t\t\tme.frm.save('Save', null, this);\n\t\t})\n\n\t},\n\tmake_comments: function() {\n\t\tthis.frm.timeline = new frappe.ui.form.Timeline({\n\t\t\tparent: this.wrapper.find(\".form-comments\"),\n\t\t\tfrm: this.frm\n\t\t});\n\t},\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.addClass(\"hide\");\n\t\t} else {\n\t\t\tthis.parent.removeClass(\"hide\");\n\t\t\tthis.frm.timeline.refresh();\n\t\t}\n\t},\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Attachments = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\t\tthis.parent.find(\".add-attachment\").click(function() {\n\t\t\tme.new_attachment();\n\t\t});\n\t\tthis.add_attachment_wrapper = this.parent.find(\".add_attachment\").parent();\n\t\tthis.attachments_label = this.parent.find(\".attachments-label\");\n\t},\n\tmax_reached: function() {\n\t\t// no of attachments\n\t\tvar n = Object.keys(this.get_attachments()).length;\n\n\t\t// button if the number of attachments is less than max\n\t\tif(n < this.frm.meta.max_attachments || !this.frm.meta.max_attachments) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\trefresh: function() {\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.parent.find(\".attachment-row\").remove();\n\n\t\tvar max_reached = this.max_reached();\n\t\tthis.add_attachment_wrapper.toggleClass(\"hide\", !max_reached);\n\n\t\t// add attachment objects\n\t\tvar attachments = this.get_attachments();\n\t\tif(attachments.length) {\n\t\t\tattachments.forEach(function(attachment) {\n\t\t\t\tme.add_attachment(attachment)\n\t\t\t});\n\t\t} else {\n\t\t\tthis.attachments_label.removeClass(\"has-attachments\");\n\t\t}\n\n\t},\n\tget_attachments: function() {\n\t\treturn this.frm.get_docinfo().attachments;\n\t},\n\tadd_attachment: function(attachment) {\n\t\tvar file_name = attachment.file_name;\n\t\tvar file_url = this.get_file_url(attachment);\n\t\tvar fileid = attachment.name;\n\t\tif (!file_name) {\n\t\t\tfile_name = file_url;\n\t\t}\n\n\t\tvar me = this;\n\n\t\tvar $attach = $(frappe.render_template(\"attachment\", { \n\t\t\t\"file_path\": \"/desk#Form/File/\" + fileid,\n\t\t\t\"icon\": attachment.is_private ? \"fa fa-lock\" : \"fa fa-unlock-alt\",\n\t\t\t\"file_name\": file_name,\n\t\t\t\"file_url\": frappe.urllib.get_full_url(file_url)\n\t\t})).insertAfter(this.attachments_label.addClass(\"has-attachments\"));\t\t\t\n\n\t\tvar $close =\n\t\t\t$attach.find(\".close\")\n\t\t\t.data(\"fileid\", fileid)\n\t\t\t.click(function() {\n\t\t\t\tvar remove_btn = this;\n\t\t\t\tfrappe.confirm(__(\"Are you sure you want to delete the attachment?\"),\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tme.remove_attachment($(remove_btn).data(\"fileid\"))\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\treturn false\n\t\t\t});\n\n\t\tif(!frappe.model.can_write(this.frm.doctype, this.frm.name)) {\n\t\t\t$close.remove();\n\t\t}\n\t},\n\tget_file_url: function(attachment) {\n\t\tvar file_url = attachment.file_url;\n\t\tif (!file_url) {\n\t\t\tif (attachment.file_name.indexOf('files/') === 0) {\n\t\t\t\tfile_url = '/' + attachment.file_name;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfile_url = '/files/' + attachment.file_name;\n\t\t\t}\n\t\t}\n\t\t// hash is not escaped, https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI\n\t\treturn encodeURI(file_url).replace(/#/g, '%23');\n\t},\n\tget_file_id_from_file_url: function(file_url) {\n\t\tvar fid;\n\t\t$.each(this.get_attachments(), function(i, attachment) {\n\t\t\tif (attachment.file_url === file_url) {\n\t\t\t\tfid = attachment.name;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn fid;\n\t},\n\tremove_attachment_by_filename: function(filename, callback) {\n\t\tthis.remove_attachment(this.get_file_id_from_file_url(filename), callback);\n\t},\n\tremove_attachment: function(fileid, callback) {\n\t\tif (!fileid) {\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.form.utils.remove_attach',\n\t\t\targs: {\n\t\t\t\tfid: fileid,\n\t\t\t\tdt: me.frm.doctype,\n\t\t\t\tdn: me.frm.docname\n\t\t\t},\n\t\t\tcallback: function(r,rt) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\tif(!r._server_messages)\n\t\t\t\t\t\tfrappe.msgprint(__(\"There were errors\"));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tme.remove_fileid(fileid);\n\t\t\t\tme.frm.get_docinfo().communications.push(r.message);\n\t\t\t\tme.frm.timeline && me.frm.timeline.refresh();\n\t\t\t\tif (callback) callback();\n\t\t\t}\n\t\t});\n\t},\n\tnew_attachment: function(fieldname) {\n\t\tvar me = this;\n\t\tif (this.dialog) {\n\t\t\t// remove upload dialog\n\t\t\tthis.dialog.$wrapper.remove();\n\t\t}\n\n\t\t// make upload dialog\n\t\tthis.dialog = frappe.ui.get_upload_dialog({\n\t\t\t\"args\": me.get_args(),\n\t\t\t\"callback\": function(attachment, r) { me.attachment_uploaded(attachment, r) },\n\t\t\t\"max_width\": me.frm.cscript ? me.frm.cscript.attachment_max_width : null,\n\t\t\t\"max_height\": me.frm.cscript ? me.frm.cscript.attachment_max_height : null\n\t\t});\n\t},\n\tget_args: function() {\n\t\treturn {\n\t\t\tfrom_form: 1,\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.docname,\n\t\t}\n\t},\n\tattachment_uploaded:  function(attachment, r) {\n\t\tthis.dialog && this.dialog.hide();\n\t\tthis.update_attachment(attachment, r.message.comment);\n\n\t\tif(this.fieldname) {\n\t\t\tthis.frm.set_value(this.fieldname, attachment.file_url);\n\t\t}\n\t},\n\tupdate_attachment: function(attachment, comment) {\n\t\tif(attachment.name) {\n\t\t\tthis.add_to_attachments(attachment);\n\t\t\tthis.refresh();\n\t\t\tif(comment) {\n\t\t\t\tthis.frm.get_docinfo().communications.push(comment);\n\t\t\t\tthis.frm.timeline.refresh();\n\t\t\t}\n\t\t}\n\t},\n\tadd_to_attachments: function (attachment) {\n\t\tvar form_attachments = this.get_attachments();\n\t\tfor(var i in form_attachments) {\n\t\t\t// prevent duplicate\n\t\t\tif(form_attachments[i][\"name\"] === attachment.name) return;\n\t\t}\n\t\tform_attachments.push(attachment);\n\t},\n\tremove_fileid: function(fileid) {\n\t\tvar attachments = this.get_attachments();\n\t\tvar new_attachments = [];\n\t\t$.each(attachments, function(i, attachment) {\n\t\t\tif(attachment.name!=fileid) {\n\t\t\t\tnew_attachments.push(attachment);\n\t\t\t}\n\t\t});\n\t\tthis.frm.get_docinfo().attachments = new_attachments;\n\t\tthis.refresh();\n\t}\n});\n\nfrappe.ui.get_upload_dialog = function(opts){\n\tvar dialog = new frappe.ui.Dialog({\n\t\ttitle: __('Upload Attachment'),\n\t\tno_focus: true,\n\t\tfields: [\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Section Break\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Link\" ,\n\t\t\t\t\"fieldname\": \"file\" ,\n\t\t\t\t\"label\": __(\"Select uploaded file\"),\n\t\t\t\t\"options\": \"File\",\n\t\t\t\tonchange: function() {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t'method': 'frappe.client.get_value',\n\t\t\t\t\t\t'args': {\n\t\t\t\t\t\t\t'doctype': 'File',\n\t\t\t\t\t\t\t'fieldname': ['file_url','file_name','is_private'],\n\t\t\t\t\t\t\t'filters': {\n\t\t\t\t\t\t\t\t'name': dialog.get_value(\"file\")\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r){\n\t\t\t\t\t\t\tif(!r.message) {\n\t\t\t\t\t\t\t\tdialog.$wrapper.find('[name=\"file_url\"]').val(\"\");\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdialog.$wrapper.find('[name=\"file_url\"]').val(r.message.file_url);\n\t\t\t\t\t\t\tdialog.$wrapper.find('.private-file input').prop('checked', r.message.is_private);\n\t\t\t\t\t\t\topts.args.filename = r.message.file_name;\n\t\t\t\t\t\t\topts.args.is_private = r.message.is_private;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"hidden\": !opts.args.doctype || !frappe.boot.gsuite_enabled,\n\t\t\t\t\"fieldtype\": \"Section Break\",\n\t\t\t\t\"label\": __(\"GSuite Document\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Link\" ,\n\t\t\t\t\"fieldname\": \"gs_template\" ,\n\t\t\t\t\"label\": __(\"Select template\"),\n\t\t\t\t\"options\": \"GSuite Templates\",\n\t\t\t\t\"reqd\" : false,\n\t\t\t\t\"filters\": {\n\t\t\t\t\t'related_doctype': opts.args.doctype\n\t\t\t\t},\n\t\t\t\tonchange: function(){\n\t\t\t\t\topts.args.gs_template = this.get_value();\n\t\t\t\t}\n\t\t\t},\n\t\t],\n\t});\n\n\n\n\n\tvar btn = dialog.set_primary_action(__(\"Attach\"));\n\tbtn.removeClass(\"btn-primary\").addClass(\"btn-default\");\n\n\tdialog.show();\n\tvar upload_area = $('<div></div>').prependTo(dialog.body);\n\n\t\n\n\tfrappe.upload.make({\n\t\tparent: upload_area,\n\t\targs: opts.args,\n\t\tcallback: function(attachment, r) {\n\t\t\tdialog.hide();\n\t\t\tif(opts.callback){\n\t\t\t\topts.callback(attachment, r);\n\t\t\t}\n\t\t},\n\t\ton_select: function() {\n\t\t\tbtn.removeClass(\"btn-default\").addClass(\"btn-primary\");\n\t\t},\n\t\tonerror: function() {\n\t\t\tdialog.hide();\n\t\t},\n\t\tbtn: btn,\n\t\tmax_width: opts.max_width,\n\t\tmax_height: opts.max_height,\n\t});\n\n\treturn dialog;\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.timeline');\nfrappe.separator_element = '<div>---</div>';\n\nfrappe.ui.form.Timeline = class Timeline {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tvar me = this;\n\t\tthis.wrapper = $(frappe.render_template(\"timeline\",\n\t\t\t{doctype: me.frm.doctype, allow_events_in_timeline: me.frm.meta.allow_events_in_timeline})).appendTo(me.parent);\n\n\t\tthis.list = this.wrapper.find(\".timeline-items\");\n\n\t\tthis.comment_area = frappe.ui.form.make_control({\n\t\t\tparent: this.wrapper.find('.timeline-head'),\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Comment',\n\t\t\t\tfieldname: 'comment',\n\t\t\t\tlabel: 'Comment'\n\t\t\t},\n\t\t\tmentions: this.get_names_for_mentions(),\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\ton_submit: (val) => {\n\t\t\t\tval && this.insert_comment(\"Comment\", val, this.comment_area.button);\n\t\t\t}\n\t\t});\n\n\t\tthis.setup_email_button();\n\t\tthis.setup_interaction_button();\n\n\t\tthis.list.on(\"click\", \".toggle-blockquote\", function() {\n\t\t\t$(this).parent().siblings(\"blockquote\").toggleClass(\"hidden\");\n\t\t});\n\n\t\tthis.setup_comment_like();\n\n\t\tthis.list.on(\"click\", \".btn-more\", function() {\n\t\t\tvar communications = me.get_communications();\n\t\t\tfrappe.call({\n\t\t\t\tbtn: this,\n\t\t\t\tmethod: \"frappe.desk.form.load.get_communications\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tstart: communications.length\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\tvar new_communications = r.message;\n\t\t\t\t\t\t\tvar communications = me.get_communications().concat(new_communications);\n\t\t\t\t\t\t\tfrappe.model.set_docinfo(me.frm.doc.doctype, me.frm.doc.name, \"communications\", communications);\n\n\t\t\t\t\t\t\tif (new_communications.length < 20) {\n\t\t\t\t\t\t\t\tme.more = false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.more = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t}\n\n\tsetup_email_button() {\n\t\tvar me = this;\n\t\tvar selector = this.frm.doctype === \"Communication\"? \".btn-reply-email\": \".btn-new-email\";\n\t\tthis.email_button = this.wrapper.find(selector)\n\t\t\t.on(\"click\", function() {\n\t\t\t\tconst $btn = $(this);\n\t\t\t\tlet is_a_reply = true;\n\t\t\t\tif ($btn.is('.btn-new-email')) {\n\t\t\t\t\tis_a_reply = false;\n\t\t\t\t}\n\n\t\t\t\tvar args = {\n\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\tfrm: me.frm,\n\t\t\t\t\trecipients: me.get_recipient(),\n\t\t\t\t\tis_a_reply\n\t\t\t\t}\n\n\t\t\t\tif(me.frm.doctype === \"Communication\") {\n\t\t\t\t\t$.extend(args, {\n\t\t\t\t\t\ttxt: \"\",\n\t\t\t\t\t\tlast_email: me.frm.doc,\n\t\t\t\t\t\trecipients: me.frm.doc.sender,\n\t\t\t\t\t\tsubject: __(\"Re: {0}\", [me.frm.doc.subject]),\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst comment_value = frappe.markdown(me.comment_area.get_value());\n\t\t\t\t\t$.extend(args, {\n\t\t\t\t\t\ttxt: strip_html(comment_value) ? comment_value : ''\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tnew frappe.views.CommunicationComposer(args)\n\t\t\t});\n\t}\n\n\tsetup_interaction_button() {\n\t\tvar me = this;\n\t\tvar selector = \".btn-new-interaction\";\n\t\tthis.activity_button = this.wrapper.find(selector)\n\t\t\t.on(\"click\", function() {\n\t\t\t\tvar args = {\n\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\tfrm: me.frm,\n\t\t\t\t\trecipients: me.get_recipient()\n\t\t\t\t}\n\t\t\t\t$.extend(args, {\n\t\t\t\t\ttxt: frappe.markdown(me.comment_area.get_value())\n\t\t\t\t});\n\t\t\t\tnew frappe.views.InteractionComposer(args);\n\t\t\t});\n\t}\n\n\tsetup_editing_area() {\n\t\tthis.$editing_area = $('<div class=\"timeline-editing-area\">');\n\n\t\tthis.editing_area = new frappe.ui.CommentArea({\n\t\t\tparent: this.$editing_area,\n\t\t\tmentions: this.get_names_for_mentions(),\n\t\t\tno_wrapper: true\n\t\t});\n\n\t\tthis.editing_area.destroy();\n\t}\n\n\trefresh(scroll_to_end) {\n\t\tvar me = this;\n\t\tthis.last_type = \"Comment\";\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.wrapper.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.wrapper.toggle(true);\n\t\tthis.list.empty();\n\t\tthis.comment_area.set_value('');\n\t\tlet communications = this.get_communications(true);\n\t\tvar views = this.get_view_logs();\n\n\t\tvar timeline = communications.concat(views);\n\t\ttimeline\n\t\t\t.filter(a => a.content)\n\t\t\t.sort((b, c) => me.compare_dates(b, c))\n\t\t\t.forEach(d => {\n\t\t\t\td.frm = me.frm;\n\t\t\t\tme.render_timeline_item(d);\n\t\t\t});\n\n\n\n\t\t// more btn\n\t\tif (this.more===undefined && timeline.length===20) {\n\t\t\tthis.more = true;\n\t\t}\n\n\t\tif (this.more) {\n\t\t\t$('<div class=\"timeline-item\">\\\n\t\t\t\t<button class=\"btn btn-default btn-xs btn-more\">More</button>\\\n\t\t\t</div>').appendTo(me.list);\n\t\t}\n\n\t\t// created\n\t\tme.render_timeline_item({\n\t\t\tcontent: __(\"created\"),\n\t\t\tcomment_type: \"Created\",\n\t\t\tcommunication_type: \"Comment\",\n\t\t\tsender: this.frm.doc.owner,\n\t\t\tcommunication_date: this.frm.doc.creation,\n\t\t\tcreation: this.frm.doc.creation,\n\t\t\tfrm: this.frm\n\t\t});\n\n\t\tthis.wrapper.find(\".is-email\").prop(\"checked\", this.last_type===\"Email\").change();\n\n\t\tthis.frm.sidebar.refresh_comments();\n\n\t\tthis.frm.trigger('timeline_refresh');\n\t}\n\n\tcompare_dates(b, c) {\n\t\tlet b_date = b.communication_date ? b.communication_date : b.creation;\n\t\tlet c_date = c.communication_date ? c.communication_date : c.creation;\n\t\tlet comparison = new Date(b_date) > new Date(c_date) ? -1 : 1;\n\t\treturn comparison;\n\t}\n\n\tmake_editing_area(container) {\n\t\treturn frappe.ui.form.make_control({\n\t\t\tparent: container,\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Comment',\n\t\t\t\tfieldname: 'comment',\n\t\t\t\tlabel: 'Comment'\n\t\t\t},\n\t\t\tmentions: this.get_names_for_mentions(),\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\tno_wrapper: true\n\t\t});\n\t}\n\n\trender_timeline_item(c) {\n\t\tvar me = this;\n\t\tthis.prepare_timeline_item(c);\n\t\tvar $timeline_item = $(frappe.render_template(\"timeline_item\", {data:c, frm:this.frm}))\n\t\t\t.appendTo(me.list)\n\t\t\t.on(\"click\", \".delete-comment\", function() {\n\t\t\t\tvar name = $timeline_item.data('name');\n\t\t\t\tme.delete_comment(name);\n\t\t\t\treturn false;\n\t\t\t})\n\t\t\t.on('click', '.edit-comment', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tvar name = $timeline_item.data('name');\n\n\t\t\t\tif($timeline_item.hasClass('is-editing')) {\n\t\t\t\t\tme.current_editing_area.submit();\n\t\t\t\t} else {\n\t\t\t\t\tconst $edit_btn = $(this);\n\t\t\t\t\tconst $timeline_content = $timeline_item.find('.timeline-item-content');\n\t\t\t\t\tconst $timeline_edit = $timeline_item.find('.timeline-item-edit');\n\t\t\t\t\tconst content = $timeline_content.html();\n\n\t\t\t\t\t// update state\n\t\t\t\t\t$edit_btn\n\t\t\t\t\t\t.text(__(\"Save\"))\n\t\t\t\t\t\t.find('i')\n\t\t\t\t\t\t.removeClass('octicon-pencil')\n\t\t\t\t\t\t.addClass('octicon-check');\n\t\t\t\t\t$timeline_content.hide();\n\t\t\t\t\t$timeline_item.addClass('is-editing');\n\n\t\t\t\t\t// initialize editing area\n\t\t\t\t\tme.current_editing_area = me.make_editing_area($timeline_edit);\n\t\t\t\t\tme.current_editing_area.set_value(content);\n\n\t\t\t\t\t// submit handler\n\t\t\t\t\tme.current_editing_area.on_submit = (value) => {\n\t\t\t\t\t\t$timeline_edit.empty();\n\t\t\t\t\t\t$timeline_content.show();\n\n\t\t\t\t\t\t// set content to new val so that on save and refresh the new content is shown\n\t\t\t\t\t\tc.content = value;\n\t\t\t\t\t\tfrappe.timeline.update_communication(c);\n\t\t\t\t\t\tme.update_comment(name, value);\n\t\t\t\t\t\t// all changes to the timeline_item for editing are reset after calling refresh\n\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\n\n\t\tif(c.communication_type==\"Communication\" && c.communication_medium===\"Email\") {\n\t\t\tthis.last_type = c.communication_medium;\n\t\t\tthis.add_reply_btn_event($timeline_item, c);\n\t\t}\n\n\t}\n\n\tadd_reply_btn_event($timeline_item, c) {\n\t\tvar me = this;\n\t\t$timeline_item.find(\".reply-link\").on(\"click\", function() {\n\t\t\tvar name = $(this).attr(\"data-name\");\n\t\t\tvar last_email = null;\n\n\t\t\t// find the email tor reply to\n\t\t\tme.get_communications().forEach(function(c) {\n\t\t\t\tif(c.name==name) {\n\t\t\t\t\tlast_email = c;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// make the composer\n\t\t\tnew frappe.views.CommunicationComposer({\n\t\t\t\tdoc: me.frm.doc,\n\t\t\t\ttxt: \"\",\n\t\t\t\ttitle: __('Reply'),\n\t\t\t\tfrm: me.frm,\n\t\t\t\tlast_email: last_email,\n\t\t\t\tis_a_reply: true\n\t\t\t});\n\t\t});\n\t}\n\n\tprepare_timeline_item(c) {\n\t\tif(!c.sender) c.sender = c.owner;\n\n\t\tif(c.sender && c.sender.indexOf(\"<\")!==-1) {\n\t\t\tc.sender = c.sender.split(\"<\")[1].split(\">\")[0];\n\t\t}\n\n\t\tc.user_info = frappe.user_info(c.sender);\n\n\t\tc[\"delete\"] = \"\";\n\t\tc[\"edit\"] = \"\";\n\t\tif(c.communication_type==\"Comment\" && (c.comment_type || \"Comment\") === \"Comment\") {\n\t\t\tif(frappe.model.can_delete(\"Communication\")) {\n\t\t\t\tc[\"delete\"] = '<a class=\"close delete-comment\" title=\"Delete\"  href=\"#\"><i class=\"octicon octicon-x\"></i></a>';\n\t\t\t}\n\n\t\t\tif(frappe.user.name == c.sender || (frappe.user.name == 'Administrator')) {\n\t\t\t\tc[\"edit\"] = '<a class=\"edit-comment text-muted\" title=\"Edit\" href=\"#\">Edit</a>';\n\t\t\t}\n\t\t}\n\t\tlet communication_date = c.communication_date || c.creation;\n\t\tc.comment_on_small = comment_when(communication_date, true);\n\t\tc.comment_on = comment_when(communication_date);\n\t\tc.futur_date = communication_date > frappe.datetime.now_datetime() ? true : false;\n\t\tif(!c.fullname) {\n\t\t\tc.fullname = c.sender_full_name || frappe.user.full_name(c.sender);\n\t\t}\n\n\t\tif(c.attachments && typeof c.attachments===\"string\")\n\t\t\tc.attachments = JSON.parse(c.attachments);\n\n\t\tif(c.communication_type==\"Comment\" && !c.comment_type) {\n\t\t\tc.comment_type = \"Comment\";\n\t\t}\n\n\t\tthis.set_icon_and_color(c);\n\n\t\t// label view\n\t\tif(c.comment_type===\"Workflow\" || c.comment_type===\"Label\") {\n\t\t\tc.comment_html = repl('<span class=\"label label-%(style)s\">%(text)s</span>', {\n\t\t\t\tstyle: frappe.utils.guess_style(c.content),\n\t\t\t\ttext: __(c.content)\n\t\t\t});\n\t\t} else {\n\t\t\tif(c.communication_type==\"Communication\" && c.communication_medium==\"Email\") {\n\t\t\t\tc.content = c.content.split(frappe.separator_element)[0];\n\t\t\t\tc.content = frappe.utils.strip_original_content(c.content);\n\n\t\t\t\tc.original_content = c.content;\n\t\t\t\tc.content = frappe.utils.toggle_blockquote(c.content);\n\t\t\t} else if (c.communication_type===\"Feedback\") {\n\t\t\t\tc.content = frappe.utils.strip_original_content(c.content);\n\n\t\t\t\tc.original_content = c.content;\n\t\t\t\tc.content = frappe.utils.toggle_blockquote(c.content);\n\t\t\t}\n\t\t\tif(!frappe.utils.is_html(c.content)) {\n\t\t\t\tc.content_html = frappe.markdown(__(c.content));\n\t\t\t} else {\n\t\t\t\tc.content_html = c.content;\n\t\t\t\tc.content_html = frappe.utils.strip_whitespace(c.content_html);\n\t\t\t\tc.content_html = c.content_html.replace(/&lt;/g,\"<\").replace(/&gt;/g,\">\");\n\t\t\t}\n\n\t\t\t// bold @mentions\n\t\t\tif(c.comment_type===\"Comment\" &&\n\t\t\t\t// avoid adding <b> tag a 2nd time\n\t\t\t\t!c.content_html.match(/(^|\\W)<b>(@[^\\s]+)<\\/b>/)\n\t\t\t) {\n\t\t\t\t/*\n\t\t\t\t\tReplace the email ids by only displaying the string which\n\t\t\t\t\toccurs before the second `@` to enhance the mentions.\n\t\t\t\t\tEg.\n\t\t\t\t\t@abc@a-example.com will be converted to\n\t\t\t\t\t@abc with the below line of code.\n\t\t\t\t*/\n\n\t\t\t\tc.content_html = c.content_html.replace(/(<[a][^>]*>)/g, \"\");\n\t\t\t\t// bold the @mentions\n\t\t\t\tc.content_html = c.content_html.replace(/(@[^\\s@]*)@[^\\s@|<]*/g, \"<b>$1</b>\");\n\t\t\t}\n\n\t\t\tif (this.is_communication_or_comment(c)) {\n\t\t\t\tc.user_content = true;\n\t\t\t\tif (!$.isArray(c._liked_by)) {\n\t\t\t\t\tc._liked_by = JSON.parse(c._liked_by || \"[]\");\n\t\t\t\t}\n\n\t\t\t\tc.liked_by_user = c._liked_by.indexOf(frappe.session.user)!==-1;\n\t\t\t}\n\t\t}\n\n\t\t// basic level of XSS protection\n\t\tc.content_html = frappe.dom.remove_script_and_style(c.content_html);\n\n\t\t// subject\n\t\tc.show_subject = false;\n\t\tif(c.subject && c.communication_type===\"Communication\") {\n\t\t\tif(this.frm.doc.subject && !this.frm.doc.subject.includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t} else if(this.frm.meta.title_field && this.frm.doc[this.frm.meta.title_field]\n\t\t\t\t&& !!this.frm.doc[this.frm.meta.title_field].includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t} else if(!this.frm.doc.name.includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tis_communication_or_comment(c) {\n\t\treturn c.communication_type===\"Communication\"\n\t\t|| c.communication_type===\"Feedback\"\n\t\t|| (c.communication_type===\"Comment\" && (c.comment_type===\"Comment\"||c.comment_type===\"Relinked\"));\n\t}\n\n\tset_icon_and_color(c) {\n\t\tif(c.communication_type == \"Feedback\"){\n\t\t\tc.icon = \"octicon octicon-comment-discussion\"\n\t\t\tc.rating_icons = frappe.render_template(\"rating_icons\", {rating: c.rating, show_label: true})\n\t\t\tc.color = \"#f39c12\"\n\t\t} else {\n\t\t\tc.icon = {\n\t\t\t\t\"Email\": \"octicon octicon-mail\",\n\t\t\t\t\"Chat\": \"octicon octicon-comment-discussion\",\n\t\t\t\t\"Phone\": \"octicon octicon-device-mobile\",\n\t\t\t\t\"SMS\": \"octicon octicon-comment\",\n\t\t\t\t\"Event\": \"fa fa-calendar\",\n\t\t\t\t\"Meeting\": \"octicon octicon-briefcase\",\n\t\t\t\t\"ToDo\": \"fa fa-check\",\n\t\t\t\t\"Created\": \"octicon octicon-plus\",\n\t\t\t\t\"Submitted\": \"octicon octicon-lock\",\n\t\t\t\t\"Cancelled\": \"octicon octicon-x\",\n\t\t\t\t\"Assigned\": \"octicon octicon-person\",\n\t\t\t\t\"Assignment Completed\": \"octicon octicon-check\",\n\t\t\t\t\"Comment\": \"octicon octicon-comment-discussion\",\n\t\t\t\t\"Workflow\": \"octicon octicon-git-branch\",\n\t\t\t\t\"Label\": \"octicon octicon-tag\",\n\t\t\t\t\"Attachment\": \"octicon octicon-cloud-upload\",\n\t\t\t\t\"Attachment Removed\": \"octicon octicon-trashcan\",\n\t\t\t\t\"Shared\": \"octicon octicon-eye\",\n\t\t\t\t\"Unshared\": \"octicon octicon-circle-slash\",\n\t\t\t\t\"Like\": \"octicon octicon-heart\",\n\t\t\t\t\"Edit\": \"octicon octicon-pencil\",\n\t\t\t\t\"Relinked\": \"octicon octicon-check\",\n\t\t\t\t\"Reply\": \"octicon octicon-mail-reply\"\n\t\t\t}[c.comment_type || c.communication_medium]\n\n\t\t\tc.color = {\n\t\t\t\t\"Email\": \"#3498db\",\n\t\t\t\t\"Chat\": \"#3498db\",\n\t\t\t\t\"Phone\": \"#3498db\",\n\t\t\t\t\"SMS\": \"#3498db\",\n\t\t\t\t\"Created\": \"#1abc9c\",\n\t\t\t\t\"Submitted\": \"#1abc9c\",\n\t\t\t\t\"Cancelled\": \"#c0392b\",\n\t\t\t\t\"Assigned\": \"#f39c12\",\n\t\t\t\t\"Assignment Completed\": \"#16a085\",\n\t\t\t\t\"Comment\": \"#f39c12\",\n\t\t\t\t\"Workflow\": \"#2c3e50\",\n\t\t\t\t\"Label\": \"#2c3e50\",\n\t\t\t\t\"Attachment\": \"#7f8c8d\",\n\t\t\t\t\"Attachment Removed\": \"#eee\",\n\t\t\t\t\"Relinked\": \"#16a085\",\n\t\t\t\t\"Reply\": \"#8d99a6\"\n\t\t\t}[c.comment_type || c.communication_medium];\n\n\t\t\tc.icon_fg = {\n\t\t\t\t\"Attachment Removed\": \"#333\",\n\t\t\t}[c.comment_type || c.communication_medium]\n\n\t\t}\n\t\tif(!c.icon_fg)\n\t\t\tc.icon_fg = \"#fff\";\n\t}\n\n\tget_communications(with_versions) {\n\t\tvar docinfo = this.frm.get_docinfo(),\n\t\t\tme = this,\n\t\t\tout = [].concat(docinfo.communications);\n\t\tif(with_versions) {\n\t\t\tthis.build_version_comments(docinfo, out);\n\t\t}\n\n\t\treturn out;\n\t}\n\n\tget_view_logs(){\n\t\tvar docinfo = this.frm.get_docinfo(),\n\t\t\tme = this,\n\t\t\tout = [];\n\t\tfor(let c of docinfo.views){\n\t\t\tc.content = `<a href=\"#Form/View Log/${c.name}\"> ${__(\"viewed\")}</a>`;\n\t\t\tc.comment_type = \"Info\";\n\t\t\tout.push(c);\n\t\t};\n\t\treturn out;\n\t}\n\n\tbuild_version_comments(docinfo, out) {\n\t\tvar me = this;\n\t\tdocinfo.versions.forEach(function(version) {\n\t\t\tif(!version.data) return;\n\t\t\tvar data = JSON.parse(version.data);\n\n\t\t\t// comment\n\t\t\tif(data.comment) {\n\t\t\t\tout.push(me.get_version_comment(version, data.comment, data.comment_type));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// value changed in parent\n\t\t\tif(data.changed && data.changed.length) {\n\t\t\t\tvar parts = [];\n\t\t\t\tdata.changed.every(function(p) {\n\t\t\t\t\tif(p[0]==='docstatus') {\n\t\t\t\t\t\tif(p[2]==1) {\n\t\t\t\t\t\t\tout.push(me.get_version_comment(version, __('submitted this document')));\n\t\t\t\t\t\t} else if (p[2]==2) {\n\t\t\t\t\t\t\tout.push(me.get_version_comment(version, __('cancelled this document')));\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tvar df = frappe.meta.get_docfield(me.frm.doctype, p[0], me.frm.docname);\n\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df, null,\n\t\t\t\t\t\t\t\tme.frm.perm);\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\tparts.push(__('{0} from {1} to {2}', [\n\t\t\t\t\t\t\t\t\t__(df.label),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[1], 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[2], 40) || '\"\"').bold()\n\t\t\t\t\t\t\t\t]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t});\n\t\t\t\tif(parts.length) {\n\t\t\t\t\tout.push(me.get_version_comment(version, __(\"changed value of {0}\", [parts.join(', ')])));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// value changed in table field\n\t\t\tif(data.row_changed && data.row_changed.length) {\n\t\t\t\tvar parts = [], count = 0;\n\t\t\t\tdata.row_changed.every(function(row) {\n\t\t\t\t\trow[3].every(function(p) {\n\t\t\t\t\t\tvar df = me.frm.fields_dict[row[0]] &&\n\t\t\t\t\t\t\tfrappe.meta.get_docfield(me.frm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\t\t\tp[0], me.frm.docname);\n\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df,\n\t\t\t\t\t\t\t\tnull, me.frm.perm);\n\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\tparts.push(__('{0} from {1} to {2} in row #{3}', [\n\t\t\t\t\t\t\t\t\tfrappe.meta.get_label(me.frm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\t\t\t\t\tp[0]),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[1], 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[2], 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\trow[1]\n\t\t\t\t\t\t\t\t]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t\t});\n\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t});\n\t\t\t\tif(parts.length) {\n\t\t\t\t\tout.push(me.get_version_comment(version, __(\"changed values for {0}\",\n\t\t\t\t\t\t[parts.join(', ')])));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// rows added / removed\n\t\t\t// __('added'), __('removed') # for translation, don't remove\n\t\t\t['added', 'removed'].forEach(function(key) {\n\t\t\t\tif(data[key] && data[key].length) {\n\t\t\t\t\tparts = (data[key] || []).map(function(p) {\n\t\t\t\t\t\tvar df = frappe.meta.get_docfield(me.frm.doctype, p[0], me.frm.docname);\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df, null,\n\t\t\t\t\t\t\t\tme.frm.perm);\n\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\treturn frappe.meta.get_label(me.frm.doctype, p[0])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tparts = parts.filter(function(p) { return p; });\n\t\t\t\t\tif(parts.length) {\n\t\t\t\t\t\tout.push(me.get_version_comment(version, __(\"{0} rows for {1}\",\n\t\t\t\t\t\t\t[__(key), parts.join(', ')])));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget_version_comment(version, text, comment_type) {\n\t\tif(!comment_type) {\n\t\t\ttext = '<a href=\"#Form/Version/'+version.name+'\">' + text + '</a>';\n\t\t}\n\t\treturn {\n\t\t\tcomment_type: comment_type || 'Edit',\n\t\t\tcreation: version.creation,\n\t\t\towner: version.owner,\n\t\t\tversion_name: version.name,\n\t\t\tsender: version.owner,\n\t\t\tcomment_by: version.owner,\n\t\t\tcontent: text\n\t\t};\n\t}\n\n\tinsert_comment(comment_type, comment, btn) {\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"frappe.desk.form.utils.add_comment\",\n\t\t\targs: {\n\t\t\t\tdoc:{\n\t\t\t\t\tdoctype: \"Communication\",\n\t\t\t\t\tcommunication_type: \"Comment\",\n\t\t\t\t\tcomment_type: comment_type || \"Comment\",\n\t\t\t\t\treference_doctype: this.frm.doctype,\n\t\t\t\t\treference_name: this.frm.docname,\n\t\t\t\t\tcontent: comment,\n\t\t\t\t\tsender: frappe.session.user\n\t\t\t\t}\n\t\t\t},\n\t\t\tbtn: btn,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tme.comment_area.set_value('');\n\t\t\t\t\tfrappe.utils.play_sound(\"click\");\n\n\t\t\t\t\tvar comment = r.message;\n\t\t\t\t\tvar comments = me.get_communications();\n\t\t\t\t\tvar comment_exists = false;\n\t\t\t\t\tfor (var i=0, l=comments.length; i<l; i++) {\n\t\t\t\t\t\tif (comments[i].name==comment.name) {\n\t\t\t\t\t\t\tcomment_exists = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (comment_exists) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tme.frm.get_docinfo().communications = comments.concat([r.message]);\n\t\t\t\t\tme.refresh(true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\tdelete_comment(name) {\n\t\tvar me = this;\n\n\t\tfrappe.confirm(__('Delete comment?'), function() {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"frappe.client.delete\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Communication\",\n\t\t\t\t\tname: name\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tfrappe.utils.play_sound(\"delete\");\n\n\t\t\t\t\t\tme.frm.get_docinfo().communications =\n\t\t\t\t\t\t\t$.map(me.frm.get_docinfo().communications,\n\t\t\t\t\t\t\t\tfunction(v) {\n\t\t\t\t\t\t\t\t\tif(v.name==name) return null;\n\t\t\t\t\t\t\t\t\telse return v;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tme.refresh(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Update comment\n\t *\n\t * @param {string} name\n\t * @param {string} content\n\t *\n\t * @returns {boolean}\n\t */\n\tupdate_comment(name, content){\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.form.utils.update_comment',\n\t\t\targs: { name, content },\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tfrappe.utils.play_sound('click');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tget_recipient() {\n\t\tif (this.frm.email_field) {\n\t\t\treturn this.frm.doc[this.frm.email_field];\n\t\t} else {\n\t\t\treturn this.frm.doc.email_id || this.frm.doc.email || \"\";\n\t\t}\n\t}\n\n\tget_last_email(from_recipient) {\n\t\tvar last_email = null,\n\t\t\tcommunications = this.frm.get_docinfo().communications,\n\t\t\temail = this.get_recipient();\n\n\t\t$.each(communications && communications.sort(function(a, b) { return a.creation > b.creation ? -1 : 1 }), function(i, c) {\n\t\t\tif(c.communication_type=='Communication' && c.communication_medium==\"Email\") {\n\t\t\t\tif(from_recipient) {\n\t\t\t\t\tif(c.sender.indexOf(email)!==-1) {\n\t\t\t\t\t\tlast_email = c;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlast_email = c;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn last_email;\n\t}\n\n\tget_names_for_mentions() {\n\t\tvar valid_users = Object.keys(frappe.boot.user_info)\n\t\t\t.filter(user => ![\"Administrator\", \"Guest\"].includes(user));\n\n\t\treturn valid_users.map(user => frappe.boot.user_info[user].name);\n\t}\n\n\tsetup_comment_like() {\n\t\tthis.wrapper.on(\"click\", \".comment-likes .octicon-heart\", frappe.ui.click_toggle_like);\n\n\t\tfrappe.ui.setup_like_popover(this.wrapper, \".comment-likes\");\n\t}\n};\n\n$.extend(frappe.timeline, {\n\tnew_communication: function(communication) {\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tif (docinfo && docinfo.communications) {\n\t\t\tvar communications = docinfo.communications;\n\t\t\tvar communication_exists = false;\n\t\t\tfor (var i=0, l=communications.length; i<l; i++) {\n\t\t\t\tif (communications[i].name==communication.name) {\n\t\t\t\t\tcommunication_exists = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!communication_exists) {\n\t\t\t\tdocinfo.communications = communications.concat([communication]);\n\t\t\t}\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tdelete_communication: function(communication) {\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tvar index = frappe.timeline.index_of_communication(communication, docinfo);\n\t\tif (index !== -1) {\n\t\t\t// remove it from communications list\n\t\t\tdocinfo.communications.splice(index, 1);\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tupdate_communication: function(communication) {\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tvar index = frappe.timeline.index_of_communication(communication, docinfo);\n\n\t\tif (index !== -1) {\n\t\t\t// update\n\t\t\t$.extend(docinfo.communications[index], communication);\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tindex_of_communication: function(communication, docinfo) {\n\t\tvar index = -1;\n\n\t\tif (docinfo && docinfo.communications) {\n\t\t\tvar communications = docinfo.communications;\n\n\t\t\tfor (var i=0, l=communications.length; i<l; i++) {\n\t\t\t\tif (communications[i].name==communication.name) {\n\t\t\t\t\tindex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn index;\n\t}\n})","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.AssignTo = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\n\t\t$.extend(this, opts);\n\t\tthis.btn = this.parent.find(\".add-assignment\").on(\"click\", function() { me.add(); });\n\t\tthis.btn_wrapper = this.btn.parent();\n\n\t\tthis.refresh();\n\t},\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.render(this.frm.get_docinfo().assignments);\n\t},\n\trender: function(d) {\n\t\tvar me = this;\n\t\tthis.frm.get_docinfo().assignments = d;\n\t\tthis.parent.find(\".assignment-row\").remove();\n\n\t\tif(me.primary_action) {\n\t\t\tme.primary_action.remove();\n\t\t\tme.primary_action = null;\n\t\t}\n\n\t\tif(this.dialog) {\n\t\t\tthis.dialog.hide();\n\t\t}\n\n\t\tif(d && d.length) {\n\t\t\tfor(var i=0; i<d.length; i++) {\n\t\t\t\tvar info = frappe.user_info(d[i].owner);\n\t\t\t\tinfo.assign_to_name = d[i].name\n\t\t\t\tinfo.owner = d[i].owner;\n\t\t\t\tinfo.avatar = frappe.avatar(d[i].owner);\n\t\t\t\tinfo.description = d[i].description || \"\";\n\n\t\t\t\tinfo._fullname = info.fullname;\n\t\t\t\tif(info.fullname.length > 10) {\n\t\t\t\t\tinfo._fullname = info.fullname.substr(0, 10) + '...';\n\t\t\t\t}\n\n\t\t\t\t$(repl('<li class=\"assignment-row\">\\\n\t\t\t\t\t<a class=\"close\" data-owner=\"%(owner)s\">&times;</a>\\\n\t\t\t\t\t%(avatar)s\\\n\t\t\t\t\t<span><a href=\"#Form/ToDo/%(assign_to_name)s\">%(_fullname)s</a></span>\\\n\t\t\t\t</li>', info))\n\t\t\t\t\t.insertBefore(this.parent.find('.add-assignment'));\n\n\t\t\t\tif(d[i].owner===frappe.session.user) {\n\t\t\t\t\tme.primary_action = this.frm.page.add_menu_item(__(\"Assignment Complete\"), function() {\n\t\t\t\t\t\tme.remove(frappe.session.user);\n\t\t\t\t\t}, \"fa fa-check\", \"btn-success\")\n\t\t\t\t}\n\n\t\t\t\tif(!(d[i].owner === frappe.session.user || me.frm.perm[0].write)) {\n\t\t\t\t\tme.parent.find('a.close').remove();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set remove\n\t\t\tthis.parent.find('a.close').click(function() {\n\t\t\t\tme.remove($(this).attr('data-owner'));\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\t//this.btn_wrapper.addClass(\"hide\");\n\t\t} else {\n\t\t\t//this.btn_wrapper.removeClass(\"hide\");\n\t\t}\n\t},\n\tadd: function() {\n\t\tvar me = this;\n\n\t\tif(this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif(!me.assign_to) {\n\t\t\tme.assign_to = new frappe.ui.form.AssignToDialog({\n\t\t\t\tobj: me,\n\t\t\t\tmethod: 'frappe.desk.form.assign_to.add',\n\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\tdocname: me.frm.docname,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.render(r.message);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tme.assign_to.dialog.clear();\n\n\t\tif(me.frm.meta.title_field) {\n\t\t\tme.assign_to.dialog.set_value(\"description\", me.frm.doc[me.frm.meta.title_field])\n\t\t}\n\n\t\tme.assign_to.dialog.show();\n\t\tme.assign_to = null;\n\t},\n\tremove: function(owner) {\n\t\tvar me = this;\n\n\t\tif(this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before removing assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.call({\n\t\t\tmethod:'frappe.desk.form.assign_to.remove',\n\t\t\targs: {\n\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\tname: me.frm.docname,\n\t\t\t\tassign_to: owner\n\t\t\t},\n\t\t\tcallback:function(r,rt) {\n\t\t\t\tme.render(r.message);\n\t\t\t}\n\t\t});\n\t}\n});\n\n\nfrappe.ui.form.AssignToDialog = Class.extend({\n\tinit: function(opts){\n\t\tvar me = this\n\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Add to To Do'),\n\t\t\tfields: [\n\t\t\t\t{fieldtype: 'Link', fieldname:'assign_to', options:'User',\n\t\t\t\t\tlabel:__(\"Assign To\"), reqd:true, filters: {'user_type': 'System User'}},\n\t\t\t\t{fieldtype:'Check', fieldname:'myself', label:__(\"Assign to me\"), \"default\":0},\n\t\t\t\t{fieldtype:'Small Text', fieldname:'description', label:__(\"Comment\")},\n\t\t\t\t{fieldtype: 'Section Break'},\n\t\t\t\t{fieldtype: 'Column Break'},\n\t\t\t\t{fieldtype:'Date', fieldname:'date', label: __(\"Complete By\")},\n\t\t\t\t{fieldtype:'Check', fieldname:'notify',\n\t\t\t\t\tlabel:__(\"Notify by Email\")},\n\t\t\t\t{fieldtype: 'Column Break'},\n\t\t\t\t{fieldtype:'Select', fieldname:'priority', label: __(\"Priority\"),\n\t\t\t\t\toptions:[\n\t\t\t\t\t\t{value:'Low', label:__('Low')},\n\t\t\t\t\t\t{value:'Medium', label:__('Medium')},\n\t\t\t\t\t\t{value:'High', label:__('High')}],\n\t\t\t\t\t'default':'Medium'},\n\t\t\t],\n\t\t\tprimary_action: function() { frappe.ui.add_assignment(opts, this) },\n\t\t\tprimary_action_label: __(\"Add\")\n\t\t})\n\t\t$.extend(me, dialog);\n\n\t\tme.dialog = dialog;\n\n\t\tme.dialog.fields_dict.assign_to.get_query = \"frappe.core.doctype.user.user.user_query\";\n\n\t\tvar myself = me.dialog.get_input(\"myself\").on(\"click\", function() {\n\t\t\tme.toggle_myself(this);\n\t\t});\n\t\tme.toggle_myself(myself);\n\t},\n\ttoggle_myself: function(myself) {\n\t\tvar me = this;\n\t\tif($(myself).prop(\"checked\")) {\n\t\t\tme.dialog.set_value(\"assign_to\", frappe.session.user);\n\t\t\tme.dialog.set_value(\"notify\", 0);\n\t\t\tme.dialog.get_field(\"notify\").$wrapper.toggle(false);\n\t\t\tme.dialog.get_field(\"assign_to\").$wrapper.toggle(false);\n\t\t} else {\n\t\t\tme.dialog.set_value(\"assign_to\", \"\");\n\t\t\tme.dialog.get_field(\"notify\").$wrapper.toggle(true);\n\t\t\tme.dialog.get_field(\"assign_to\").$wrapper.toggle(true);\n\t\t}\n\t},\n\n});\n\nfrappe.ui.add_assignment = function(opts, dialog) {\n\tvar assign_to = dialog.fields_dict.assign_to.get_value();\n\tvar args = dialog.get_values();\n\tif(args && assign_to) {\n\t\treturn frappe.call({\n\t\t\tmethod: opts.method,\n\t\t\targs: $.extend(args, {\n\t\t\t\tdoctype: opts.doctype,\n\t\t\t\tname: opts.docname,\n\t\t\t\tassign_to: assign_to,\n\t\t\t\tbulk_assign:  opts.bulk_assign || false,\n\t\t\t\tre_assign: opts.re_assign || false\n\t\t\t}),\n\t\t\tcallback: function(r,rt) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tif(opts.callback){\n\t\t\t\t\t\topts.callback(r);\n\t\t\t\t\t}\n\t\t\t\t\tdialog && dialog.hide();\n\t\t\t\t}\n\t\t\t},\n\t\t\tbtn: this\n\t\t});\n\t}\n}\n","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.make_quick_entry = (doctype, after_insert, init_callback, doc) => {\n\tvar trimmed_doctype = doctype.replace(/ /g, '');\n\tvar controller_name = \"QuickEntryForm\";\n\n\tif(frappe.ui.form[trimmed_doctype + \"QuickEntryForm\"]){\n\t\tcontroller_name = trimmed_doctype + \"QuickEntryForm\";\n\t}\n\n\tfrappe.quick_entry = new frappe.ui.form[controller_name](doctype, after_insert, init_callback, doc);\n\treturn frappe.quick_entry.setup();\n};\n\nfrappe.ui.form.QuickEntryForm = Class.extend({\n\tinit: function(doctype, after_insert, init_callback, doc) {\n\t\tthis.doctype = doctype;\n\t\tthis.after_insert = after_insert;\n\t\tthis.init_callback = init_callback;\n\t\tthis.doc = doc;\n\t},\n\n\tsetup: function() {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.model.with_doctype(this.doctype, function() {\n\t\t\t\tme.set_meta_and_mandatory_fields();\n\t\t\t\tif(me.is_quick_entry()) {\n\t\t\t\t\tme.render_dialog();\n\t\t\t\t\tresolve(me);\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.quick_entry = null;\n\t\t\t\t\tfrappe.set_route('Form', me.doctype, me.doc.name)\n\t\t\t\t\t\t.then(() => resolve(me));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tset_meta_and_mandatory_fields: function(){\n\t\tlet fields = frappe.get_meta(this.doctype).fields;\n\t\tif (fields.length < 7) {\n\t\t\t// if less than 7 fields, then show everything\n\t\t\tthis.mandatory = fields;\n\t\t} else {\n\t\t\t// prepare a list of mandatory and bold fields\n\t\t\tthis.mandatory = $.map(fields,\n\t\t\t\tfunction(d) { return ((d.reqd || d.bold || d.allow_in_quick_entry) && !d.read_only) ? $.extend({}, d) : null; });\n\t\t}\n\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\tif (!this.doc) {\n\t\t\tthis.doc = frappe.model.get_new_doc(this.doctype, null, null, true);\n\t\t}\n\t},\n\n\tis_quick_entry: function(){\n\t\tif(this.meta.quick_entry != 1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.validate_for_prompt_autoname();\n\n\t\tif (this.has_child_table()\n\t\t\t|| !this.mandatory.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\ttoo_many_mandatory_fields: function(){\n\t\tif(this.mandatory.length > 7) {\n\t\t\t// too many fields, show form\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\thas_child_table: function(){\n\t\tif($.map(this.mandatory, function(d) {\n\t\t\treturn d.fieldtype==='Table' ? d : null; }).length) {\n\t\t\t// has mandatory table, quit!\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\tvalidate_for_prompt_autoname: function(){\n\t\tif(this.meta.autoname && this.meta.autoname.toLowerCase()==='prompt') {\n\t\t\tthis.mandatory = [{fieldname:'__newname', label:__('{0} Name', [this.meta.name]),\n\t\t\t\treqd: 1, fieldtype:'Data'}].concat(this.mandatory);\n\t\t}\n\t},\n\n\trender_dialog: function(){\n\t\tvar me = this;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"New {0}\", [__(this.doctype)]),\n\t\t\tfields: this.mandatory,\n\t\t});\n\t\tthis.dialog.doc = this.doc;\n\n\t\tthis.register_primary_action();\n\t\tthis.render_edit_in_full_page_link();\n\t\t// ctrl+enter to save\n\t\tthis.dialog.wrapper.keydown(function(e) {\n\t\t\tif((e.ctrlKey || e.metaKey) && e.which==13) {\n\t\t\t\tif(!frappe.request.ajax_count) {\n\t\t\t\t\t// not already working -- double entry\n\t\t\t\t\tme.dialog.get_primary_btn().trigger(\"click\");\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.dialog.onhide = () => frappe.quick_entry = null;\n\t\tthis.dialog.show();\n\t\tthis.dialog.$wrapper.on('shown.bs.modal', function() {\n\t\t\t$(document).trigger('quick-entry-dialog-open');\n\t\t});\n\n\t\tthis.dialog.refresh_dependency();\n\t\tthis.set_defaults();\n\n\t\tif (this.init_callback) {\n\t\t\tthis.init_callback(this.dialog);\n\t\t}\n\t},\n\n\tregister_primary_action: function(){\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__('Save'), function() {\n\t\t\tif(me.dialog.working) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar data = me.dialog.get_values();\n\n\t\t\tif(data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tme.dialog.set_message(__('Saving...'));\n\t\t\t\tme.insert().then(() => {\n\t\t\t\t\tme.dialog.clear_message();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tinsert: function() {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tme.update_doc();\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: me.dialog.doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t// delete the old doc\n\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\tif(frappe._from_link) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(me.after_insert) {\n\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function() {\n\t\t\t\t\tme.open_doc();\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true\n\t\t\t});\n\t\t});\n\t},\n\n\topen_form_if_not_list: function() {\n\t\tlet route = frappe.get_route();\n\t\tlet doc = this.dialog.doc;\n\t\tif (route && !(route[0]==='List' && route[1]===doc.doctype)) {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => frappe.set_route('Form', doc.doctype, doc.name)\n\t\t\t]);\n\t\t}\n\t},\n\n\tupdate_doc: function(){\n\t\tvar me = this;\n\t\tvar data = this.dialog.get_values(true);\n\t\t$.each(data, function(key, value) {\n\t\t\tif(key==='__newname') {\n\t\t\t\tme.dialog.doc.name = value;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif(!is_null(value)) {\n\t\t\t\t\tme.dialog.doc[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn this.dialog.doc;\n\t},\n\n\topen_doc: function(){\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tfrappe.set_route('Form', this.doctype, this.doc.name);\n\t},\n\n\trender_edit_in_full_page_link: function(){\n\t\tvar me = this;\n\t\tvar $link = $('<div style=\"padding-left: 7px; padding-top: 30px; padding-bottom: 10px;\">' +\n\t\t\t'<button class=\"edit-full btn-default btn-sm\">' + __(\"Edit in full page\") + '</button></div>').appendTo(this.dialog.body);\n\n\t\t$link.find('.edit-full').on('click', function() {\n\t\t\t// edit in form\n\t\t\tme.open_doc();\n\t\t});\n\t},\n\n\tset_defaults: function(){\n\t\tvar me = this;\n\t\t// set defaults\n\t\t$.each(this.dialog.fields_dict, function(fieldname, field) {\n\t\t\tfield.doctype = me.doc.doctype;\n\t\t\tfield.docname = me.doc.name;\n\n\t\t\tif(!is_null(me.doc[fieldname])) {\n\t\t\t\tfield.set_input(me.doc[fieldname]);\n\t\t\t}\n\t\t});\n\t}\n});\n","frappe.provide('frappe.ui.form');\nfrappe.provide('frappe.success_action');\n\nfrappe.ui.form.SuccessAction = class SuccessAction {\n\tconstructor(form) {\n\t\tthis.form = form;\n\t\tthis.load_setting();\n\t}\n\n\tload_setting() {\n\t\tthis.setting = frappe.boot.success_action\n\t\t\t.find(setting => setting.ref_doctype === this.form.doctype);\n\t}\n\n\tshow() {\n\t\tif (!this.setting) return;\n\t\tif (this.form.doc.docstatus === 0 && !this.form.is_first_creation()) return;\n\n\t\tthis.prepare_dom();\n\t\tthis.show_alert();\n\t}\n\n\tprepare_dom() {\n\t\tthis.container = $(document.body).find('.success-container');\n\t\tif (!this.container.length) {\n\t\t\tthis.container = $('<div class=\"success-container\">').appendTo(document.body);\n\t\t}\n\t}\n\n\tshow_alert() {\n\t\tfrappe.db.count(this.form.doctype)\n\t\t\t.then(count => {\n\t\t\t\tconst setting = this.setting;\n\t\t\t\tlet message = count === 1 ?\n\t\t\t\t\tsetting.first_success_message :\n\t\t\t\t\tsetting.message;\n\n\t\t\t\tconst $buttons = this.get_actions().map(action => {\n\t\t\t\t\tconst $btn = $(`<button class=\"next-action\"><span>${action.label}</span></button>`);\n\t\t\t\t\t$btn.click(() => action.action(this.form));\n\t\t\t\t\treturn $btn;\n\t\t\t\t});\n\n\t\t\t\tconst next_action_container = $(`<div class=\"next-action-container\"></div>`);\n\t\t\t\tnext_action_container.append($buttons);\n\t\t\t\tconst html = next_action_container;\n\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tbody: html,\n\t\t\t\t\tindicator: 'green',\n\t\t\t\t}, setting.action_timeout);\n\t\t\t});\n\t}\n\n\tget_actions() {\n\t\tconst actions = [];\n\t\tconst checked_actions = this.setting.next_actions.split(\"\\n\");\n\t\tchecked_actions\n\t\t\t.forEach(action => {\n\t\t\t\tif (typeof action === 'string' && this.default_actions[action]) {\n\t\t\t\t\tactions.push(this.default_actions[action]);\n\t\t\t\t} else if (typeof action === 'object') {\n\t\t\t\t\tactions.push(action);\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn actions;\n\t}\n\n\tget default_actions() {\n\t\treturn {\n\t\t\t'new': {\n\t\t\t\tlabel: __('New'),\n\t\t\t\taction: (frm) => frappe.new_doc(frm.doctype)\n\t\t\t},\n\t\t\t'print': {\n\t\t\t\tlabel: __('Print'),\n\t\t\t\taction: (frm) => frm.print_doc()\n\t\t\t},\n\t\t\t'email': {\n\t\t\t\tlabel: __('Email'),\n\t\t\t\taction: (frm) => frm.email_doc()\n\t\t\t},\n\t\t\t'list': {\n\t\t\t\tlabel: __('View All'),\n\t\t\t\taction: (frm) => {\n\t\t\t\t\tfrappe.set_route('List', frm.doctype);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n};\n"],"names":["frappe","provide","views","FormFactory","Factory","[object Object]","route","me","this","dt","formview","show_doc","model","with_doctype","page","container","add_page","frm","_f","Frm","initialized","$","document","on","ui","form","close_grid_form","realtime","data","timeline","new_communication","delete_communication","update_communication","set_viewers","dn","slice","join","new_names","set_route","with_doc","r","locals","load","new_str","__","substr","length","new_name","make_new_doc_and_get_name","show_not_found","change_to","refresh","Controller","Class","extend","init","opts","frms","doctype","parent","in_form","docname","hidden","refresh_if_stale_for","opendocs","custom_buttons","sections","grids","cscript","events","pformat","fetch_dict","tinymce_id_list","setup_meta","event","old_name","rename_notify","prototype","check_doctype_conflict","msgprint","pages","window","location","reload","DocType","setup","fields","fields_dict","state_fieldname","workflow","get_state_fieldname","wrapper","$wrapper","make_app_page","single_column","meta","hide_toolbar","layout_main","main","get","toolbar","Toolbar","setup_print_layout","setup_std_layout","script_manager","ScriptManager","watch_model_updates","footer","Footer","appendTo","attr","setup_drag_drop","setup_done","e","dataTransfer","originalEvent","files","stopPropagation","preventDefault","doc","__islocal","attachments","max_reached","upload","make","args","get_args","callback","attachment","attachment_uploaded","print_preview","PrintPreview","set_primary_action","print_doc","is","hide_print","can_print","refresh_print_options","trigger","set_view","set_user_lang","set_default_print_language","preview","current_view_name","previous_view_name","fieldname","value","name","dirty","layout","refresh_dependency","table_fields","get_children","fieldtype","each","i","df","options","parentfield","grid","set_value","form_wrapper","body","section_style","Layout","with_dashboard","fields_list","document_flow","DocumentFlow","dashboard","Dashboard","states","States","email_doc","message","CommunicationComposer","subject","recipients","email","email_id","contact_email","attach_document_print","real_name","contact_display","contact_name","rename_doc","share_doc","shared","show","old","istable","docfield_copy","in_dialog","re_route","hash","encodeURIComponent","get_doc","perm","get_perm","refresh_header","is_a_different_doc","utils","set_title","issingle","current_status","undefined","is_submittable","submit","is_dirty","is_new","docstatus","add_comment","clear_custom_buttons","show_web_link","__onload","is_website_generator","web_link","remove","published","add_web_link","path","label","sidebar","add_user_action","check_doc_perm","parent_doctype","read","scroll_to","forEach","grid_obj","visible_columns","cur_frm","show_not_permitted","read_only","is_read_only","set_read_only","__unsaved","__last_sync_on","Date","reload_doc","is_onload","render_form","localname","setnewdoc","show_print_first","removeClass","toggleClass","show_if_needs_refresh","__needs_refresh","clear_headline","set_headline_alert","attach_doc_and_docfields","Sidebar","show_message","run_serially","refresh_fields","after_refresh","first","find","in_list","focus","show_empty_form_message","scroll_to_element","refresh_field","fname","primary_button","cleanup_refresh","amended_from","unhide_field","hide_field","trash_reason","autoname","fn","toggle_display","then","after_ajax","trigger_link_fields","breadcrumbs","add","module","track_seen","addClass","__run_link_triggers","field","runscript","scriptname","callingfield","onrefresh","input","set_working","call","method","docs","btn","$input","exc","copy_doc","onload","from_amend","validate_form_action","newdoc","idx","remove_from_locals","validated","Object","defineProperty","console","warn","set","save","save_action","on_error","let","Promise","resolve","reject","prop","activeElement","blur","setTimeout","_save","show_success_action","catch","error","after_save","indexOf","play_sound","fail","savesubmit","handle_fail","confirm","savecancel","savetrash","delete_doc","history","back","amend_doc","amendment_date","datetime","obj_to_str","alert","disable_save","save_disabled","clear_primary_action","enable_save","save_or_update","get_docinfo","docinfo","reload_docinfo","assign_to","permlevel","access_type","set_intro","txt","set_footnote","footnote_area","add_custom_button","group","add_inner_button","clear_inner_toolbar","clear_user_actions","remove_custom_button","remove_inner_button","add_fetch","link_field","src_field","tar_field","columns","push","set_print_heading","action_perm_type_map","Create","Save","Submit","Update","Cancel","Amend","Delete","action","perm_to_check","allowed_for_workflow","perms","throw","has_perm","ptype","route_options","selector","key","repl","get_route","SuccessAction","is_first_creation","modified","split","creation","get_server_fields","arg","table_field","allow_edit","call_back","dom","freeze","isPlainObject","JSON","stringify","$c","unfreeze","d","field_dict","set_multiple","dict","refresh_many","flist","set_field_tip","n","get_docfield","description","comment_area","innerHTML","replace_newlines","log","filter_dict","docfields","grid_rows_by_docname","set_field_options","set_df_property","set_field_permlevel","level","toggle_field","get_field_obj","set_currency_labels","currency","field_label_map","grid_field_label_map","docfield","docfield_map","replace","trim","set_label","field_map","fnames","keys","l","fieldname1","fieldname2","property","toggle_enable","enable","toggle_reqd","mandatory","reqd","call_server","$c_obj","get_files","sort","get_attachments","set_query","opt1","opt2","get_field","get_query","set_value_if_missing","clear_table","add_child","values","unique_keys","map","includes","if_missing","_set","f","v","fieldobj","has_value","isArray","j","child","tasks","original_callback","get_server_module_name","std_field_list","concat","std_fields_list","docperms","print","cancel","get_formatted","format","no_icon","open_grid_row","get_open_grid_form","get_title","title_field","get_selected","selected","get_table_fields","_selected","has_mapper","_has_mapper","__js","search","set_indicator_formatter","get_color","get_text","every","formatter","link_formatters","const","escaped_name","color","can_create","custom_make_buttons","can_make_methods","make_new","make_methods","new_doc","get_new_doc","get_meta","make_quick_entry","update_in_all_rows","table_fieldname","cl","get_sum","sum","add_update_button_on_dirty","setup_editable_title","make_menu","show_title_as_dirty","hide_menu","print_icon","show_menu","title","strip_html","set_title_sub","$title_area","is_title_editable","can_rename","set_indicator","write","allow_rename","prompt","default","get_dropdown_menu","add_dropdown","indicator","get_indicator","clear_indicator","clear_icons","clear_menu","p","cint","print_settings","allow_print_for_draft","allow_print_for_cancelled","add_menu_item","add_action_icon","can_email","show_linked_with","boot","user","allow_copy","add_to_desktop","can_delete","user_roles","doc_type","developer_mode","Feedback","manual_feedback_request","CREATE","can_save","get_docstatus","can_submit","has_workflow","can_update","can_cancel","can_amend","amend","_has_workflow","get_list","document_type","linked_with","LinkedWith","status","get_action_status","set_page_actions","clear_actions","set_secondary_action","click","icon","make_cancel_amend_button","CANCEL","AMEND","clear_actions_menu","section","_form_dashboard","render_template","progress_area","heatmap_area","chart_area","stats_area","stats_area_row","links_area","transactions_area","reset","empty","set_headline","html","text","alert_class","permanent","clear_comment","indicator_color","add_section","add_progress","percent","progress_chart","make_progress_chart","format_percent","progress","show_progress","_progress_map","progress_bar","css","width","progress_class","hide_progress","init_data","transactions","render_links","set_open_count","heatmap","render_heatmap","graph","setup_graph","__dashboard","internal_links","filter_permissions","add_transactions","group_added","Array","items","ref","can_read","data_rendered","open_document_list","$link","show_open","names","get_document_filter","notifications","show_open_count_list","filter","non_standard_fieldnames","item","type","timeline_data","update_heatmap","count","set_badge_count","open_count","link","link_fieldname","dashboard_data","update","Chart","scrub","height","start","moment","subtract","toDate","count_label","discreteDomains","margin","heatmap_message","add_indicator","colspan","indicators","n_indicators","graph_method","graph_method_args","render_graph","colors","chart","hide","doctypes","prependTo","render","get_linked_docs","mark_completed_flow","for_doctype","frm_doctype","frm_docname","workflow_state_fieldname","working_label","toTitle","freeze_message","remove_empty_rows","get_all_docs","is_table","cells","is_empty_row","docfield_list","in_list_view","clear_doc","check_mandatory","has_errors","scroll_set","error_fields","folded","unfold","parenttype","bold","scrollTop","offset","top","_call","is_saving","remove_old_form_route","always","update_calling_link","workflow_state","index","current_route","route_history","arr","splice","_from_link","grid_rows","_from_link_scrollY","get_event_handler_list","handlers","on_change","handler","add_handler","off","ControllerClass","event_name","get_handlers","selected_doc","runner","_function","is_old_style","_promise","after_server_call","new_style","old_style","has_handlers","cs","tmp","eval","__custom_js","stack","setup_add_fetch","fetch_from","parts","get_docfields","__css","set_style","log_error","caller","show_alert","trace","groupEnd","copy_from_first_row","current_row","fieldnames","dialog","make_dialog","Dialog","hide_on_page_refresh","on_page_show","get_linked_doctypes","load_doctypes","links_not_permitted_or_missing","make_html","linked_docs","__linked_docs","linked_doctypes","make_doc_head","make_doc_row","already_loaded","doctypes_to_load","__linked_doctypes","promises","listview_settings","add_fields","all","flag","links","can_get_report","linkinfo","heading","update_fields","get_update_fields","bind","setup_help","add_action_item","state","get_state","workflows","get_transitions","transitions","next_html","allowed","get_document_state","padding","set_default_state","show_actions","added","transition","approval_access","session","allow_self_approval","owner","xcall","sync","btn_primary","default_state","get_default_state","bind_events","add_view","toggle","has_role","which","target","print_formats","get_print_formats","print_letterhead","print_sel","with_letterhead","multilingual_preview","language_sel","lang_code","val","print_old_style","printit","new_page_preview_old_style","new_page_preview","open","urllib","get_full_url","selected_format","print_format","get_print_format","print_format_builder","print_format_name","language","add_options","get_languages","default_print_language","lang","preview_old_style","get_print_html","out","show_footer","style","display","flex-direction","no_letterhead","_lang","with_old_style","only_body","no_heading","require","_p","build","go","default_print_format","print_format_type","print_css","get_print_settings","pdf","letter_head","default_letter_head","defaults","get_default","depends_on","letter_heads","with_letter_head","sidebar_content","ratings","comments","user_actions","image_section","image_wrapper","make_assignments","make_attachments","make_shared","make_viewers","make_tags","make_like","setup_user_image_event","like_icon","toggle_like","refresh_like","viewers","tags","_user_tags","full_name","modified_by","comment_when","setup_ratings","set_user_image","refresh_comments","get_communications","c","communication_type","comment_type","total_comments","TagEditor","user_tags","Attachments","AssignTo","Share","Viewers","like_wrapper","like_count","setup_like_popover","_liked_by","is_liked","parse","refresh_image","_ratings","rating","rating_icons","show_label","image_field","image","title_image","cordova","base_url","background-color","get_palette","get_abbr","make_input","render_sidebar","users","s","everyone","avatar_class","user_info","fullname","abbr","append","render_shared","onhide","can_share","make_user_input","add_share_button","set_edit_share_events","share_with","make_control","filters","user_type","only_input","render_input","get_value","share","notify","parents","permission_to","found","get_viewers","data_updated","new_users","current","username","new","comma_and","past_viewers","past","new_viewers","viewer","set_docinfo","make_comments","Timeline","new_attachment","add_attachment_wrapper","attachments_label","max_attachments","add_attachment","file_name","file_url","get_file_url","fileid","$close","file_path","is_private","insertAfter","remove_btn","remove_attachment","can_write","encodeURI","get_file_id_from_file_url","fid","remove_attachment_by_filename","filename","rt","_server_messages","remove_fileid","communications","get_upload_dialog","max_width","attachment_max_width","max_height","attachment_max_height","from_form","update_attachment","comment","add_to_attachments","form_attachments","new_attachments","no_focus","onchange","gsuite_enabled","related_doctype","gs_template","upload_area","on_select","onerror","separator_element","allow_events_in_timeline","list","mentions","get_names_for_mentions","on_submit","insert_comment","button","setup_email_button","setup_interaction_button","siblings","setup_comment_like","new_communications","more","email_button","is_a_reply","get_recipient","last_email","sender","comment_value","markdown","activity_button","InteractionComposer","$editing_area","editing_area","CommentArea","no_wrapper","destroy","scroll_to_end","last_type","get_view_logs","a","content","b","compare_dates","render_timeline_item","communication_date","change","b_date","c_date","prepare_timeline_item","$timeline_item","delete_comment","hasClass","current_editing_area","$edit_btn","$timeline_content","$timeline_edit","make_editing_area","update_comment","communication_medium","add_reply_btn_event","comment_on_small","comment_on","futur_date","now_datetime","sender_full_name","set_icon_and_color","comment_html","guess_style","strip_original_content","original_content","toggle_blockquote","is_html","content_html","strip_whitespace","match","is_communication_or_comment","user_content","liked_by_user","remove_script_and_style","show_subject","Email","Chat","Phone","SMS","Event","Meeting","ToDo","Created","Submitted","Cancelled","Assigned","Assignment Completed","Comment","Workflow","Label","Attachment","Attachment Removed","Shared","Unshared","Like","Edit","Relinked","Reply","icon_fg","with_versions","build_version_comments","versions","version","get_version_comment","changed","field_display_status","get_field_display_status","ellipsis","row_changed","row","get_label","version_name","comment_by","reference_doctype","reference_name","comment_exists","email_field","from_recipient","click_toggle_like","communication","communication_exists","index_of_communication","btn_wrapper","assignments","primary_action","info","assign_to_name","avatar","_fullname","insertBefore","AssignToDialog","obj","clear","add_assignment","primary_action_label","myself","get_input","toggle_myself","get_values","bulk_assign","re_assign","after_insert","init_callback","trimmed_doctype","controller_name","quick_entry","QuickEntryForm","set_meta_and_mandatory_fields","is_quick_entry","render_dialog","allow_in_quick_entry","validate_for_prompt_autoname","has_child_table","too_many_mandatory_fields","toLowerCase","register_primary_action","render_edit_in_full_page_link","keydown","ctrlKey","metaKey","request","ajax_count","get_primary_btn","set_defaults","working","set_message","insert","clear_message","update_doc","open_form_if_not_list","open_doc","is_null","set_input","load_setting","setting","success_action","ref_doctype","prepare_dom","db","first_success_message","$buttons","get_actions","$btn","next_action_container","action_timeout","actions","next_actions","default_actions"],"mappings":"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"}